(function(se,Fe){typeof exports=="object"&&typeof module<"u"?module.exports=Fe(require("react"),require("react-dom")):typeof define=="function"&&define.amd?define(["react","react-dom"],Fe):(se=typeof globalThis<"u"?globalThis:se||self,se.CallWidget=Fe(se.React,se.ReactDOM))})(this,function(se,Fe){"use strict";var He=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},et={exports:{}},ze={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var en;function Lo(){if(en)return ze;en=1;var l=se,y=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,d=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function v(a,u,P){var A,w={},c=null,m=null;P!==void 0&&(c=""+P),u.key!==void 0&&(c=""+u.key),u.ref!==void 0&&(m=u.ref);for(A in u)s.call(u,A)&&!h.hasOwnProperty(A)&&(w[A]=u[A]);if(a&&a.defaultProps)for(A in u=a.defaultProps,u)w[A]===void 0&&(w[A]=u[A]);return{$$typeof:y,type:a,key:c,ref:m,props:w,_owner:d.current}}return ze.Fragment=o,ze.jsx=v,ze.jsxs=v,ze}var $e={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tn;function Fo(){return tn||(tn=1,process.env.NODE_ENV!=="production"&&function(){var l=se,y=Symbol.for("react.element"),o=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),v=Symbol.for("react.provider"),a=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen"),n=Symbol.iterator,e="@@iterator";function t(k){if(k===null||typeof k!="object")return null;var G=n&&k[n]||k[e];return typeof G=="function"?G:null}var b=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function C(k){{for(var G=arguments.length,V=new Array(G>1?G-1:0),X=1;X<G;X++)V[X-1]=arguments[X];f("error",k,V)}}function f(k,G,V){{var X=b.ReactDebugCurrentFrame,ne=X.getStackAddendum();ne!==""&&(G+="%s",V=V.concat([ne]));var ie=V.map(function(re){return String(re)});ie.unshift("Warning: "+G),Function.prototype.apply.call(console[k],console,ie)}}var r=!1,i=!1,_=!1,S=!1,p=!1,I;I=Symbol.for("react.module.reference");function D(k){return!!(typeof k=="string"||typeof k=="function"||k===s||k===h||p||k===d||k===P||k===A||S||k===m||r||i||_||typeof k=="object"&&k!==null&&(k.$$typeof===c||k.$$typeof===w||k.$$typeof===v||k.$$typeof===a||k.$$typeof===u||k.$$typeof===I||k.getModuleId!==void 0))}function E(k,G,V){var X=k.displayName;if(X)return X;var ne=G.displayName||G.name||"";return ne!==""?V+"("+ne+")":V}function T(k){return k.displayName||"Context"}function M(k){if(k==null)return null;if(typeof k.tag=="number"&&C("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof k=="function")return k.displayName||k.name||null;if(typeof k=="string")return k;switch(k){case s:return"Fragment";case o:return"Portal";case h:return"Profiler";case d:return"StrictMode";case P:return"Suspense";case A:return"SuspenseList"}if(typeof k=="object")switch(k.$$typeof){case a:var G=k;return T(G)+".Consumer";case v:var V=k;return T(V._context)+".Provider";case u:return E(k,k.render,"ForwardRef");case w:var X=k.displayName||null;return X!==null?X:M(k.type)||"Memo";case c:{var ne=k,ie=ne._payload,re=ne._init;try{return M(re(ie))}catch{return null}}}return null}var g=Object.assign,$=0,N,R,O,F,B,q,x;function j(){}j.__reactDisabledLog=!0;function L(){{if($===0){N=console.log,R=console.info,O=console.warn,F=console.error,B=console.group,q=console.groupCollapsed,x=console.groupEnd;var k={configurable:!0,enumerable:!0,value:j,writable:!0};Object.defineProperties(console,{info:k,log:k,warn:k,error:k,group:k,groupCollapsed:k,groupEnd:k})}$++}}function W(){{if($--,$===0){var k={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:g({},k,{value:N}),info:g({},k,{value:R}),warn:g({},k,{value:O}),error:g({},k,{value:F}),group:g({},k,{value:B}),groupCollapsed:g({},k,{value:q}),groupEnd:g({},k,{value:x})})}$<0&&C("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var H=b.ReactCurrentDispatcher,Y;function J(k,G,V){{if(Y===void 0)try{throw Error()}catch(ne){var X=ne.stack.trim().match(/\n( *(at )?)/);Y=X&&X[1]||""}return`
`+Y+k}}var K=!1,z;{var Z=typeof WeakMap=="function"?WeakMap:Map;z=new Z}function Q(k,G){if(!k||K)return"";{var V=z.get(k);if(V!==void 0)return V}var X;K=!0;var ne=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var ie;ie=H.current,H.current=null,L();try{if(G){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(ve){X=ve}Reflect.construct(k,[],re)}else{try{re.call()}catch(ve){X=ve}k.call(re.prototype)}}else{try{throw Error()}catch(ve){X=ve}k()}}catch(ve){if(ve&&X&&typeof ve.stack=="string"){for(var ee=ve.stack.split(`
`),de=X.stack.split(`
`),ue=ee.length-1,ce=de.length-1;ue>=1&&ce>=0&&ee[ue]!==de[ce];)ce--;for(;ue>=1&&ce>=0;ue--,ce--)if(ee[ue]!==de[ce]){if(ue!==1||ce!==1)do if(ue--,ce--,ce<0||ee[ue]!==de[ce]){var be=`
`+ee[ue].replace(" at new "," at ");return k.displayName&&be.includes("<anonymous>")&&(be=be.replace("<anonymous>",k.displayName)),typeof k=="function"&&z.set(k,be),be}while(ue>=1&&ce>=0);break}}}finally{K=!1,H.current=ie,W(),Error.prepareStackTrace=ne}var Ve=k?k.displayName||k.name:"",Le=Ve?J(Ve):"";return typeof k=="function"&&z.set(k,Le),Le}function te(k,G,V){return Q(k,!1)}function ae(k){var G=k.prototype;return!!(G&&G.isReactComponent)}function le(k,G,V){if(k==null)return"";if(typeof k=="function")return Q(k,ae(k));if(typeof k=="string")return J(k);switch(k){case P:return J("Suspense");case A:return J("SuspenseList")}if(typeof k=="object")switch(k.$$typeof){case u:return te(k.render);case w:return le(k.type,G,V);case c:{var X=k,ne=X._payload,ie=X._init;try{return le(ie(ne),G,V)}catch{}}}return""}var oe=Object.prototype.hasOwnProperty,Pe={},De=b.ReactDebugCurrentFrame;function U(k){if(k){var G=k._owner,V=le(k.type,k._source,G?G.type:null);De.setExtraStackFrame(V)}else De.setExtraStackFrame(null)}function Ae(k,G,V,X,ne){{var ie=Function.call.bind(oe);for(var re in k)if(ie(k,re)){var ee=void 0;try{if(typeof k[re]!="function"){var de=Error((X||"React class")+": "+V+" type `"+re+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof k[re]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw de.name="Invariant Violation",de}ee=k[re](G,re,X,V,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(ue){ee=ue}ee&&!(ee instanceof Error)&&(U(ne),C("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",X||"React class",V,re,typeof ee),U(null)),ee instanceof Error&&!(ee.message in Pe)&&(Pe[ee.message]=!0,U(ne),C("Failed %s type: %s",V,ee.message),U(null))}}}var _e=Array.isArray;function xe(k){return _e(k)}function Be(k){{var G=typeof Symbol=="function"&&Symbol.toStringTag,V=G&&k[Symbol.toStringTag]||k.constructor.name||"Object";return V}}function Ge(k){try{return Co(k),!1}catch{return!0}}function Co(k){return""+k}function To(k){if(Ge(k))return C("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Be(k)),Co(k)}var Po=b.ReactCurrentOwner,is={key:!0,ref:!0,__self:!0,__source:!0},Ao,Ro;function os(k){if(oe.call(k,"ref")){var G=Object.getOwnPropertyDescriptor(k,"ref").get;if(G&&G.isReactWarning)return!1}return k.ref!==void 0}function as(k){if(oe.call(k,"key")){var G=Object.getOwnPropertyDescriptor(k,"key").get;if(G&&G.isReactWarning)return!1}return k.key!==void 0}function ss(k,G){typeof k.ref=="string"&&Po.current}function us(k,G){{var V=function(){Ao||(Ao=!0,C("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",G))};V.isReactWarning=!0,Object.defineProperty(k,"key",{get:V,configurable:!0})}}function cs(k,G){{var V=function(){Ro||(Ro=!0,C("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",G))};V.isReactWarning=!0,Object.defineProperty(k,"ref",{get:V,configurable:!0})}}var ls=function(k,G,V,X,ne,ie,re){var ee={$$typeof:y,type:k,key:G,ref:V,props:re,_owner:ie};return ee._store={},Object.defineProperty(ee._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(ee,"_self",{configurable:!1,enumerable:!1,writable:!1,value:X}),Object.defineProperty(ee,"_source",{configurable:!1,enumerable:!1,writable:!1,value:ne}),Object.freeze&&(Object.freeze(ee.props),Object.freeze(ee)),ee};function fs(k,G,V,X,ne){{var ie,re={},ee=null,de=null;V!==void 0&&(To(V),ee=""+V),as(G)&&(To(G.key),ee=""+G.key),os(G)&&(de=G.ref,ss(G,ne));for(ie in G)oe.call(G,ie)&&!is.hasOwnProperty(ie)&&(re[ie]=G[ie]);if(k&&k.defaultProps){var ue=k.defaultProps;for(ie in ue)re[ie]===void 0&&(re[ie]=ue[ie])}if(ee||de){var ce=typeof k=="function"?k.displayName||k.name||"Unknown":k;ee&&us(re,ce),de&&cs(re,ce)}return ls(k,ee,de,ne,X,Po.current,re)}}var Kr=b.ReactCurrentOwner,Io=b.ReactDebugCurrentFrame;function We(k){if(k){var G=k._owner,V=le(k.type,k._source,G?G.type:null);Io.setExtraStackFrame(V)}else Io.setExtraStackFrame(null)}var Xr;Xr=!1;function Qr(k){return typeof k=="object"&&k!==null&&k.$$typeof===y}function ko(){{if(Kr.current){var k=M(Kr.current.type);if(k)return`

Check the render method of \``+k+"`."}return""}}function ds(k){return""}var Oo={};function ps(k){{var G=ko();if(!G){var V=typeof k=="string"?k:k.displayName||k.name;V&&(G=`

Check the top-level render call using <`+V+">.")}return G}}function Do(k,G){{if(!k._store||k._store.validated||k.key!=null)return;k._store.validated=!0;var V=ps(G);if(Oo[V])return;Oo[V]=!0;var X="";k&&k._owner&&k._owner!==Kr.current&&(X=" It was passed a child from "+M(k._owner.type)+"."),We(k),C('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',V,X),We(null)}}function xo(k,G){{if(typeof k!="object")return;if(xe(k))for(var V=0;V<k.length;V++){var X=k[V];Qr(X)&&Do(X,G)}else if(Qr(k))k._store&&(k._store.validated=!0);else if(k){var ne=t(k);if(typeof ne=="function"&&ne!==k.entries)for(var ie=ne.call(k),re;!(re=ie.next()).done;)Qr(re.value)&&Do(re.value,G)}}}function hs(k){{var G=k.type;if(G==null||typeof G=="string")return;var V;if(typeof G=="function")V=G.propTypes;else if(typeof G=="object"&&(G.$$typeof===u||G.$$typeof===w))V=G.propTypes;else return;if(V){var X=M(G);Ae(V,k.props,"prop",X,k)}else if(G.PropTypes!==void 0&&!Xr){Xr=!0;var ne=M(G);C("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",ne||"Unknown")}typeof G.getDefaultProps=="function"&&!G.getDefaultProps.isReactClassApproved&&C("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function vs(k){{for(var G=Object.keys(k.props),V=0;V<G.length;V++){var X=G[V];if(X!=="children"&&X!=="key"){We(k),C("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",X),We(null);break}}k.ref!==null&&(We(k),C("Invalid attribute `ref` supplied to `React.Fragment`."),We(null))}}var jo={};function Mo(k,G,V,X,ne,ie){{var re=D(k);if(!re){var ee="";(k===void 0||typeof k=="object"&&k!==null&&Object.keys(k).length===0)&&(ee+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var de=ds();de?ee+=de:ee+=ko();var ue;k===null?ue="null":xe(k)?ue="array":k!==void 0&&k.$$typeof===y?(ue="<"+(M(k.type)||"Unknown")+" />",ee=" Did you accidentally export a JSX literal instead of a component?"):ue=typeof k,C("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",ue,ee)}var ce=fs(k,G,V,ne,ie);if(ce==null)return ce;if(re){var be=G.children;if(be!==void 0)if(X)if(xe(be)){for(var Ve=0;Ve<be.length;Ve++)xo(be[Ve],k);Object.freeze&&Object.freeze(be)}else C("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else xo(be,k)}if(oe.call(G,"key")){var Le=M(k),ve=Object.keys(G).filter(function(Ss){return Ss!=="key"}),Zr=ve.length>0?"{key: someKey, "+ve.join(": ..., ")+": ...}":"{key: someKey}";if(!jo[Le+Zr]){var bs=ve.length>0?"{"+ve.join(": ..., ")+": ...}":"{}";C(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Zr,Le,bs,Le),jo[Le+Zr]=!0}}return k===s?vs(ce):hs(ce),ce}}function ms(k,G,V){return Mo(k,G,V,!0)}function gs(k,G,V){return Mo(k,G,V,!1)}var ys=gs,_s=ms;$e.Fragment=s,$e.jsx=ys,$e.jsxs=_s}()),$e}var rn;function No(){return rn||(rn=1,process.env.NODE_ENV==="production"?et.exports=Lo():et.exports=Fo()),et.exports}var fe=No(),je={},tt={exports:{}},nn;function me(){if(nn)return tt.exports;nn=1;var l=typeof Reflect=="object"?Reflect:null,y=l&&typeof l.apply=="function"?l.apply:function(i,_,S){return Function.prototype.apply.call(i,_,S)},o;l&&typeof l.ownKeys=="function"?o=l.ownKeys:Object.getOwnPropertySymbols?o=function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:o=function(i){return Object.getOwnPropertyNames(i)};function s(r){console&&console.warn&&console.warn(r)}var d=Number.isNaN||function(i){return i!==i};function h(){h.init.call(this)}tt.exports=h,tt.exports.once=b,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var v=10;function a(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(r){if(typeof r!="number"||r<0||d(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");v=r}}),h.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(i){if(typeof i!="number"||i<0||d(i))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+i+".");return this._maxListeners=i,this};function u(r){return r._maxListeners===void 0?h.defaultMaxListeners:r._maxListeners}h.prototype.getMaxListeners=function(){return u(this)},h.prototype.emit=function(i){for(var _=[],S=1;S<arguments.length;S++)_.push(arguments[S]);var p=i==="error",I=this._events;if(I!==void 0)p=p&&I.error===void 0;else if(!p)return!1;if(p){var D;if(_.length>0&&(D=_[0]),D instanceof Error)throw D;var E=new Error("Unhandled error."+(D?" ("+D.message+")":""));throw E.context=D,E}var T=I[i];if(T===void 0)return!1;if(typeof T=="function")y(T,this,_);else for(var M=T.length,g=n(T,M),S=0;S<M;++S)y(g[S],this,_);return!0};function P(r,i,_,S){var p,I,D;if(a(_),I=r._events,I===void 0?(I=r._events=Object.create(null),r._eventsCount=0):(I.newListener!==void 0&&(r.emit("newListener",i,_.listener?_.listener:_),I=r._events),D=I[i]),D===void 0)D=I[i]=_,++r._eventsCount;else if(typeof D=="function"?D=I[i]=S?[_,D]:[D,_]:S?D.unshift(_):D.push(_),p=u(r),p>0&&D.length>p&&!D.warned){D.warned=!0;var E=new Error("Possible EventEmitter memory leak detected. "+D.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit");E.name="MaxListenersExceededWarning",E.emitter=r,E.type=i,E.count=D.length,s(E)}return r}h.prototype.addListener=function(i,_){return P(this,i,_,!1)},h.prototype.on=h.prototype.addListener,h.prototype.prependListener=function(i,_){return P(this,i,_,!0)};function A(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function w(r,i,_){var S={fired:!1,wrapFn:void 0,target:r,type:i,listener:_},p=A.bind(S);return p.listener=_,S.wrapFn=p,p}h.prototype.once=function(i,_){return a(_),this.on(i,w(this,i,_)),this},h.prototype.prependOnceListener=function(i,_){return a(_),this.prependListener(i,w(this,i,_)),this},h.prototype.removeListener=function(i,_){var S,p,I,D,E;if(a(_),p=this._events,p===void 0)return this;if(S=p[i],S===void 0)return this;if(S===_||S.listener===_)--this._eventsCount===0?this._events=Object.create(null):(delete p[i],p.removeListener&&this.emit("removeListener",i,S.listener||_));else if(typeof S!="function"){for(I=-1,D=S.length-1;D>=0;D--)if(S[D]===_||S[D].listener===_){E=S[D].listener,I=D;break}if(I<0)return this;I===0?S.shift():e(S,I),S.length===1&&(p[i]=S[0]),p.removeListener!==void 0&&this.emit("removeListener",i,E||_)}return this},h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=function(i){var _,S,p;if(S=this._events,S===void 0)return this;if(S.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):S[i]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete S[i]),this;if(arguments.length===0){var I=Object.keys(S),D;for(p=0;p<I.length;++p)D=I[p],D!=="removeListener"&&this.removeAllListeners(D);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(_=S[i],typeof _=="function")this.removeListener(i,_);else if(_!==void 0)for(p=_.length-1;p>=0;p--)this.removeListener(i,_[p]);return this};function c(r,i,_){var S=r._events;if(S===void 0)return[];var p=S[i];return p===void 0?[]:typeof p=="function"?_?[p.listener||p]:[p]:_?t(p):n(p,p.length)}h.prototype.listeners=function(i){return c(this,i,!0)},h.prototype.rawListeners=function(i){return c(this,i,!1)},h.listenerCount=function(r,i){return typeof r.listenerCount=="function"?r.listenerCount(i):m.call(r,i)},h.prototype.listenerCount=m;function m(r){var i=this._events;if(i!==void 0){var _=i[r];if(typeof _=="function")return 1;if(_!==void 0)return _.length}return 0}h.prototype.eventNames=function(){return this._eventsCount>0?o(this._events):[]};function n(r,i){for(var _=new Array(i),S=0;S<i;++S)_[S]=r[S];return _}function e(r,i){for(;i+1<r.length;i++)r[i]=r[i+1];r.pop()}function t(r){for(var i=new Array(r.length),_=0;_<i.length;++_)i[_]=r[_].listener||r[_];return i}function b(r,i){return new Promise(function(_,S){function p(D){r.removeListener(i,I),S(D)}function I(){typeof r.removeListener=="function"&&r.removeListener("error",p),_([].slice.call(arguments))}f(r,i,I,{once:!0}),i!=="error"&&C(r,p,{once:!0})})}function C(r,i,_){typeof r.on=="function"&&f(r,"error",i,_)}function f(r,i,_,S){if(typeof r.on=="function")S.once?r.once(i,_):r.on(i,_);else if(typeof r.addEventListener=="function")r.addEventListener(i,function p(I){S.once&&r.removeEventListener(i,p),_(I)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}return tt.exports}var Re={},we={},Ne={},pe={},Je={},on;function Uo(){return on||(on=1,function(l){var y=Je&&Je.__extends||function(){var u=function(P,A){return u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,c){w.__proto__=c}||function(w,c){for(var m in c)c.hasOwnProperty(m)&&(w[m]=c[m])},u(P,A)};return function(P,A){u(P,A);function w(){this.constructor=P}P.prototype=A===null?Object.create(A):(w.prototype=A.prototype,new w)}}();Object.defineProperty(l,"__esModule",{value:!0});function o(u,P,A){typeof P=="string"?(u.message=P,A instanceof Error&&(u.originalError=A)):P instanceof Error&&(u.originalError=P)}var s;(function(u){var P=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=[],t.code=20101,t.description="Invalid access token",t.explanation="Twilio was unable to validate your Access Token",t.solutions=[],Object.setPrototypeOf(t,u.AccessTokenInvalid.prototype),o(t,n,e),t}return m}(Error);u.AccessTokenInvalid=P;var A=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=[],t.code=20104,t.description="Access token expired or expiration date invalid",t.explanation="The Access Token provided to the Twilio API has expired, the expiration time specified in the token was invalid, or the expiration time specified was too far in the future",t.solutions=[],Object.setPrototypeOf(t,u.AccessTokenExpired.prototype),o(t,n,e),t}return m}(Error);u.AccessTokenExpired=A;var w=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=[],t.code=20151,t.description="Authentication Failed",t.explanation="The Authentication with the provided JWT failed",t.solutions=[],Object.setPrototypeOf(t,u.AuthenticationFailed.prototype),o(t,n,e),t}return m}(Error);u.AuthenticationFailed=w})(s=l.AuthorizationErrors||(l.AuthorizationErrors={}));var d;(function(u){var P=function(A){y(w,A);function w(c,m){var n=A.call(this,"")||this;return n.causes=[],n.code=31400,n.description="Bad Request (HTTP/SIP)",n.explanation="The request could not be understood due to malformed syntax.",n.solutions=[],Object.setPrototypeOf(n,u.BadRequest.prototype),o(n,c,m),n}return w}(Error);u.BadRequest=P})(d=l.ClientErrors||(l.ClientErrors={}));var h;(function(u){var P=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=[],t.code=31e3,t.description="Unknown Error",t.explanation="An unknown error has occurred. See error details for more information.",t.solutions=[],Object.setPrototypeOf(t,u.UnknownError.prototype),o(t,n,e),t}return m}(Error);u.UnknownError=P;var A=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=[],t.code=31005,t.description="Connection error",t.explanation="A connection error occurred during the call",t.solutions=[],Object.setPrototypeOf(t,u.ConnectionError.prototype),o(t,n,e),t}return m}(Error);u.ConnectionError=A;var w=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=[],t.code=31009,t.description="Transport error",t.explanation="No transport available to send or receive messages",t.solutions=[],Object.setPrototypeOf(t,u.TransportError.prototype),o(t,n,e),t}return m}(Error);u.TransportError=w})(h=l.GeneralErrors||(l.GeneralErrors={}));var v;(function(u){var P=function(w){y(c,w);function c(m,n){var e=w.call(this,"")||this;return e.causes=[],e.code=53e3,e.description="Signaling connection error",e.explanation="Raised whenever a signaling connection error occurs that is not covered by a more specific error code.",e.solutions=[],Object.setPrototypeOf(e,u.ConnectionError.prototype),o(e,m,n),e}return c}(Error);u.ConnectionError=P;var A=function(w){y(c,w);function c(m,n){var e=w.call(this,"")||this;return e.causes=["The device running your application lost its Internet connection."],e.code=53001,e.description="Signaling connection disconnected",e.explanation="Raised whenever the signaling connection is unexpectedly disconnected.",e.solutions=["Ensure the device running your application has access to a stable Internet connection."],Object.setPrototypeOf(e,u.ConnectionDisconnected.prototype),o(e,m,n),e}return c}(Error);u.ConnectionDisconnected=A})(v=l.SignalingErrors||(l.SignalingErrors={}));var a;(function(u){var P=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=["The Client may not be using a supported WebRTC implementation.","The Client may not have the necessary resources to create or apply a new media description."],t.code=53400,t.description="Client is unable to create or apply a local media description",t.explanation="Raised whenever a Client is unable to create or apply a local media description.",t.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(t,u.ClientLocalDescFailed.prototype),o(t,n,e),t}return m}(Error);u.ClientLocalDescFailed=P;var A=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=["The Client may not be using a supported WebRTC implementation.","The Client may be connecting peer-to-peer with another Participant that is not using a supported WebRTC implementation.","The Client may not have the necessary resources to apply a new media description."],t.code=53402,t.description="Client is unable to apply a remote media description",t.explanation="Raised whenever the Client receives a remote media description but is unable to apply it.",t.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(t,u.ClientRemoteDescFailed.prototype),o(t,n,e),t}return m}(Error);u.ClientRemoteDescFailed=A;var w=function(c){y(m,c);function m(n,e){var t=c.call(this,"")||this;return t.causes=["The Client was unable to establish a media connection.","A media connection which was active failed liveliness checks."],t.code=53405,t.description="Media connection failed",t.explanation="Raised by the Client or Server whenever a media connection fails.",t.solutions=["If the problem persists, try connecting to another region.","Check your Client's network connectivity.","If you've provided custom ICE Servers then ensure that the URLs and credentials are valid."],Object.setPrototypeOf(t,u.ConnectionError.prototype),o(t,n,e),t}return m}(Error);u.ConnectionError=w})(a=l.MediaErrors||(l.MediaErrors={})),l.errorsByCode=new Map([[20101,s.AccessTokenInvalid],[20104,s.AccessTokenExpired],[20151,s.AuthenticationFailed],[31400,d.BadRequest],[31e3,h.UnknownError],[31005,h.ConnectionError],[31009,h.TransportError],[53e3,v.ConnectionError],[53001,v.ConnectionDisconnected],[53400,a.ClientLocalDescFailed],[53402,a.ClientRemoteDescFailed],[53405,a.ConnectionError]]),Object.freeze(l.errorsByCode)}(Je)),Je}var an;function he(){if(an)return pe;an=1;var l=pe&&pe.__extends||function(){var v=function(a,u){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(P,A){P.__proto__=A}||function(P,A){for(var w in A)A.hasOwnProperty(w)&&(P[w]=A[w])},v(a,u)};return function(a,u){v(a,u);function P(){this.constructor=a}a.prototype=u===null?Object.create(u):(P.prototype=u.prototype,new P)}}();Object.defineProperty(pe,"__esModule",{value:!0});var y=Uo();pe.AuthorizationErrors=y.AuthorizationErrors,pe.ClientErrors=y.ClientErrors,pe.GeneralErrors=y.GeneralErrors,pe.MediaErrors=y.MediaErrors,pe.SignalingErrors=y.SignalingErrors;var o=function(v){l(a,v);function a(u){var P=v.call(this,u)||this;return P.name="InvalidArgumentError",P}return a}(Error);pe.InvalidArgumentError=o;var s=function(v){l(a,v);function a(u){var P=v.call(this,u)||this;return P.name="InvalidStateError",P}return a}(Error);pe.InvalidStateError=s;var d=function(v){l(a,v);function a(u){var P=v.call(this,u)||this;return P.name="NotSupportedError",P}return a}(Error);pe.NotSupportedError=d;function h(v){var a=y.errorsByCode.get(v);if(!a)throw new o("Error code "+v+" not found");return a}return pe.getErrorByCode=h,pe}var rt={},nt={exports:{}},qo=nt.exports,sn;function Bo(){return sn||(sn=1,function(l){(function(y,o){l.exports?l.exports=o():y.log=o()})(qo,function(){var y=function(){},o="undefined",s=typeof window!==o&&typeof window.navigator!==o&&/Trident\/|MSIE /.test(window.navigator.userAgent),d=["trace","debug","info","warn","error"];function h(e,t){var b=e[t];if(typeof b.bind=="function")return b.bind(e);try{return Function.prototype.bind.call(b,e)}catch{return function(){return Function.prototype.apply.apply(b,[e,arguments])}}}function v(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(e){return e==="debug"&&(e="log"),typeof console===o?!1:e==="trace"&&s?v:console[e]!==void 0?h(console,e):console.log!==void 0?h(console,"log"):y}function u(e,t){for(var b=0;b<d.length;b++){var C=d[b];this[C]=b<e?y:this.methodFactory(C,e,t)}this.log=this.debug}function P(e,t,b){return function(){typeof console!==o&&(u.call(this,t,b),this[e].apply(this,arguments))}}function A(e,t,b){return a(e)||P.apply(this,arguments)}function w(e,t,b){var C=this,f,r="loglevel";e&&(r+=":"+e);function i(p){var I=(d[p]||"silent").toUpperCase();if(typeof window!==o){try{window.localStorage[r]=I;return}catch{}try{window.document.cookie=encodeURIComponent(r)+"="+I+";"}catch{}}}function _(){var p;if(typeof window!==o){try{p=window.localStorage[r]}catch{}if(typeof p===o)try{var I=window.document.cookie,D=I.indexOf(encodeURIComponent(r)+"=");D!==-1&&(p=/^([^;]+)/.exec(I.slice(D))[1])}catch{}return C.levels[p]===void 0&&(p=void 0),p}}C.name=e,C.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},C.methodFactory=b||A,C.getLevel=function(){return f},C.setLevel=function(p,I){if(typeof p=="string"&&C.levels[p.toUpperCase()]!==void 0&&(p=C.levels[p.toUpperCase()]),typeof p=="number"&&p>=0&&p<=C.levels.SILENT){if(f=p,I!==!1&&i(p),u.call(C,p,e),typeof console===o&&p<C.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+p},C.setDefaultLevel=function(p){_()||C.setLevel(p,!1)},C.enableAll=function(p){C.setLevel(C.levels.TRACE,p)},C.disableAll=function(p){C.setLevel(C.levels.SILENT,p)};var S=_();S==null&&(S=t??"WARN"),C.setLevel(S,!1)}var c=new w,m={};c.getLogger=function(t){if(typeof t!="string"||t==="")throw new TypeError("You must supply a name when creating a logger.");var b=m[t];return b||(b=m[t]=new w(t,c.getLevel(),c.methodFactory)),b};var n=typeof window!==o?window.log:void 0;return c.noConflict=function(){return typeof window!==o&&window.log===c&&(window.log=n),c},c.getLoggers=function(){return m},c})}(nt)),nt.exports}var Ie={},un;function Ue(){if(un)return Ie;un=1;var l="twilio-client",y="1.15.1",o="https://sdk.twilio.com/js/client/sounds/releases/1.0.0";return Ie.COWBELL_AUDIO_URL=o+"/cowbell.mp3?cache="+y,Ie.ECHO_TEST_DURATION=2e4,Ie.PACKAGE_NAME=l,Ie.RELEASE_VERSION=y,Ie.SOUNDS_BASE_URL=o,Ie.USED_ERRORS=["AuthorizationErrors.AccessTokenExpired","AuthorizationErrors.AccessTokenInvalid","AuthorizationErrors.AuthenticationFailed","ClientErrors.BadRequest","GeneralErrors.ConnectionError","GeneralErrors.TransportError","GeneralErrors.UnknownError","MediaErrors.ClientLocalDescFailed","MediaErrors.ClientRemoteDescFailed","MediaErrors.ConnectionError","SignalingErrors.ConnectionDisconnected","SignalingErrors.ConnectionError"],Ie}var cn;function Me(){if(cn)return rt;cn=1,Object.defineProperty(rt,"__esModule",{value:!0});var l=Bo(),y=Ue(),o=function(){function s(d){try{this._log=(d&&d.LogLevelModule?d.LogLevelModule:l).getLogger(y.PACKAGE_NAME)}catch{console.warn("Cannot create custom logger"),this._log=console}}return s.getInstance=function(){return s.instance||(s.instance=new s),s.instance},s.prototype.debug=function(){for(var d,h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];(d=this._log).debug.apply(d,h)},s.prototype.error=function(){for(var d,h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];(d=this._log).error.apply(d,h)},s.prototype.info=function(){for(var d,h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];(d=this._log).info.apply(d,h)},s.prototype.setDefaultLevel=function(d){this._log.setDefaultLevel?this._log.setDefaultLevel(d):console.warn("Logger cannot setDefaultLevel")},s.prototype.warn=function(){for(var d,h=[],v=0;v<arguments.length;v++)h[v]=arguments[v];(d=this._log).warn.apply(d,h)},s.levels=l.levels,s}();return rt.default=o,rt}var it={},ln;function Go(){if(ln)return it;ln=1,Object.defineProperty(it,"__esModule",{value:!0});var l=Ue(),y=he(),o=l.SOUNDS_BASE_URL+"/outgoing.mp3",s=function(){function d(h,v,a,u){this._name=h,this._availableDevices=v,this._beforeChange=a,this._isSupported=u,this._activeDevices=new Set}return d.prototype.delete=function(h){var v=!!this._activeDevices.delete(h),a=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&a&&this._activeDevices.add(a);var u=Array.from(this._activeDevices.values()).map(function(P){return P.deviceId});return this._beforeChange(this._name,u),!!v},d.prototype.get=function(){return this._activeDevices},d.prototype.set=function(h){var v=this;if(!this._isSupported)return Promise.reject(new y.NotSupportedError("This browser does not support audio output selection"));var a=Array.isArray(h)?h:[h];if(!a.length)return Promise.reject(new y.InvalidArgumentError("Must specify at least one device to set"));var u=[],P=a.map(function(A){var w=v._availableDevices.get(A);return w||u.push(A),w});return u.length?Promise.reject(new y.InvalidArgumentError("Devices not found: "+u.join(", "))):new Promise(function(A){A(v._beforeChange(v._name,a))}).then(function(){v._activeDevices.clear(),P.forEach(v._activeDevices.add,v._activeDevices)})},d.prototype.test=function(h){return h===void 0&&(h=o),this._isSupported?this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map(function(v){var a;return new Promise(function(u){a=new Audio(h),a.oncanplay=u}).then(function(){return a.setSinkId(v.deviceId).then(function(){return a.play()})})})):Promise.reject(new y.InvalidStateError("No active output devices to test")):Promise.reject(new y.NotSupportedError("This browser does not support audio output selection"))},d}();return it.default=s,it}var ge={},fn;function ke(){if(fn)return ge;fn=1;function l(w){if(!(this instanceof l))return new l(w);this.message=w}l.prototype.toString=function(){return"Twilio.Exception: "+this.message};function y(w){return w&&w.length?w.reduce(function(c,m){return c+m})/w.length:0}function o(w,c,m){m=m||function(e){return e};var n=new Set(c.map(m));return w.filter(function(e){return!n.has(m(e))})}function s(w){return!!w.userAgent.match("Electron")}function d(w,c){var m=!!c.userAgent.match("CriOS"),n=!!c.userAgent.match("HeadlessChrome"),e=typeof w.chrome<"u"&&c.vendor==="Google Inc."&&c.userAgent.indexOf("OPR")===-1&&c.userAgent.indexOf("Edge")===-1;return m||s(c)||e||n}function h(w){return w=w||(typeof window>"u"?He.navigator:window.navigator),!!w&&typeof w.userAgent=="string"&&/firefox|fxios/i.test(w.userAgent)}function v(w){return w=w||(typeof window>"u"?He.navigator:window.navigator),!!w&&typeof w.userAgent=="string"&&/edge\/\d+/i.test(w.userAgent)}function a(w){return!!w.vendor&&w.vendor.indexOf("Apple")!==-1&&w.userAgent&&w.userAgent.indexOf("CriOS")===-1&&w.userAgent.indexOf("FxiOS")===-1}function u(w,c,m,n){if(typeof w>"u"||typeof c>"u"||typeof m>"u"||typeof n>"u"||typeof m.prototype>"u"||typeof n.prototype>"u")return!1;if(d(w,c)&&m.prototype.addTransceiver){var e=new m,t=!0;try{e.addTransceiver("audio")}catch{t=!1}return e.close(),t}else{if(h(c))return!0;if(a(c))return"currentDirection"in n.prototype}return!1}function P(w){return w?w.split("&").reduce(function(c,m){var n=m.split("="),e=n[0],t=decodeURIComponent((n[1]||"").replace(/\+/g,"%20"));return e&&(c[e]=t),c},{}):""}function A(w,c){var m=w instanceof Map||w instanceof Set?Array.from(w.values()):w;return c=c||function(n){return n},m.reduce(function(n,e){var t=c(e);return n.concat(t)},[])}return ge.Exception=l,ge.average=y,ge.difference=o,ge.isElectron=s,ge.isChrome=d,ge.isFirefox=h,ge.isLegacyEdge=v,ge.isSafari=a,ge.isUnifiedPlanDefault=u,ge.queryToJson=P,ge.flatMap=A,ge}var vt,dn;function Wo(){if(dn)return vt;dn=1;function l(o,s){if(!(o instanceof s))throw new TypeError("Cannot call a class as a function")}var y=function o(s){l(this,o),Object.defineProperties(this,{deviceId:{get:function(){return s.deviceId}},groupId:{get:function(){return s.groupId}},kind:{get:function(){return s.kind}},label:{get:function(){return s.label}}})};return vt=y,vt}var pn;function Vo(){if(pn)return Ne;pn=1;var l=Ne&&Ne.__extends||function(){var P=function(A,w){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,m){c.__proto__=m}||function(c,m){for(var n in m)m.hasOwnProperty(n)&&(c[n]=m[n])},P(A,w)};return function(A,w){P(A,w);function c(){this.constructor=A}A.prototype=w===null?Object.create(w):(c.prototype=w.prototype,new c)}}();Object.defineProperty(Ne,"__esModule",{value:!0});var y=me(),o=he(),s=Me(),d=Go(),h=ke(),v=Wo(),a={audioinput:"Audio Input",audiooutput:"Audio Output"},u=function(P){l(A,P);function A(w,c,m,n){var e=P.call(this)||this;e.availableInputDevices=new Map,e.availableOutputDevices=new Map,e._audioConstraints=null,e._inputDevice=null,e._inputStream=null,e._isPollingInputVolume=!1,e._log=s.default.getInstance(),e._unknownDeviceIndexes={audioinput:{},audiooutput:{}},e._updateAvailableDevices=function(){return!e._mediaDevices||!e._enumerateDevices?Promise.reject("Enumeration not supported"):e._enumerateDevices().then(function(f){e._updateDevices(f.filter(function(i){return i.kind==="audiooutput"}),e.availableOutputDevices,e._removeLostOutput),e._updateDevices(f.filter(function(i){return i.kind==="audioinput"}),e.availableInputDevices,e._removeLostInput);var r=e.availableOutputDevices.get("default")||Array.from(e.availableOutputDevices.values())[0];[e.speakerDevices,e.ringtoneDevices].forEach(function(i){!i.get().size&&e.availableOutputDevices.size&&e.isOutputSelectionSupported&&i.set(r.deviceId).catch(function(_){e._log.warn("Unable to set audio output devices. "+_)})})})},e._removeLostInput=function(f){if(!e.inputDevice||e.inputDevice.deviceId!==f.deviceId)return!1;e._replaceStream(null),e._inputDevice=null,e._maybeStopPollingVolume();var r=e.availableInputDevices.get("default")||Array.from(e.availableInputDevices.values())[0];return r&&e.setInputDevice(r.deviceId),!0},e._removeLostOutput=function(f){var r=e.speakerDevices.delete(f),i=e.ringtoneDevices.delete(f);return r||i},n=Object.assign({AudioContext:typeof AudioContext<"u"&&AudioContext,setSinkId:typeof HTMLAudioElement<"u"&&HTMLAudioElement.prototype.setSinkId},n),e._getUserMedia=m,e._mediaDevices=n.mediaDevices||navigator.mediaDevices,e._onActiveInputChanged=c,e._enumerateDevices=typeof n.enumerateDevices=="function"?n.enumerateDevices:e._mediaDevices&&e._mediaDevices.enumerateDevices.bind(e._mediaDevices);var t=!!(n.AudioContext||n.audioContext),b=!!e._enumerateDevices,C=typeof n.setSinkId=="function";return e.isOutputSelectionSupported=b&&C,e.isVolumeSupported=t,n.enabledSounds&&e._addEnabledSounds(n.enabledSounds),e.isVolumeSupported&&(e._audioContext=n.audioContext||n.AudioContext&&new n.AudioContext,e._audioContext&&(e._inputVolumeAnalyser=e._audioContext.createAnalyser(),e._inputVolumeAnalyser.fftSize=32,e._inputVolumeAnalyser.smoothingTimeConstant=.3)),e.ringtoneDevices=new d.default("ringtone",e.availableOutputDevices,w,e.isOutputSelectionSupported),e.speakerDevices=new d.default("speaker",e.availableOutputDevices,w,e.isOutputSelectionSupported),e.addListener("newListener",function(f){f==="inputVolume"&&e._maybeStartPollingVolume()}),e.addListener("removeListener",function(f){f==="inputVolume"&&e._maybeStopPollingVolume()}),e.once("newListener",function(){e.isOutputSelectionSupported||e._log.warn("Warning: This browser does not support audio output selection."),e.isVolumeSupported||e._log.warn("Warning: This browser does not support Twilio's volume indicator feature.")}),b&&e._initializeEnumeration(),e}return Object.defineProperty(A.prototype,"audioConstraints",{get:function(){return this._audioConstraints},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"inputDevice",{get:function(){return this._inputDevice},enumerable:!0,configurable:!0}),Object.defineProperty(A.prototype,"inputStream",{get:function(){return this._inputStream},enumerable:!0,configurable:!0}),A.prototype._maybeStartPollingVolume=function(){var w=this;if(!(!this.isVolumeSupported||!this._inputStream)&&(this._updateVolumeSource(),!(this._isPollingInputVolume||!this._inputVolumeAnalyser))){var c=this._inputVolumeAnalyser.frequencyBinCount,m=new Uint8Array(c);this._isPollingInputVolume=!0;var n=function(){if(w._isPollingInputVolume){if(w._inputVolumeAnalyser){w._inputVolumeAnalyser.getByteFrequencyData(m);var e=h.average(m);w.emit("inputVolume",e/255)}requestAnimationFrame(n)}};requestAnimationFrame(n)}},A.prototype._maybeStopPollingVolume=function(){this.isVolumeSupported&&(!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),delete this._inputVolumeSource),this._isPollingInputVolume=!1))},A.prototype._unbind=function(){if(!this._mediaDevices||!this._enumerateDevices)throw new o.NotSupportedError("Enumeration is not supported");this._mediaDevices.removeEventListener&&this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices)},A.prototype.setAudioConstraints=function(w){return this._audioConstraints=Object.assign({},w),delete this._audioConstraints.deviceId,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},A.prototype.setInputDevice=function(w){return h.isFirefox()?Promise.reject(new o.NotSupportedError(`Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.
Related BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324`)):this._setInputDevice(w,!1)},A.prototype.unsetAudioConstraints=function(){return this._audioConstraints=null,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},A.prototype.unsetInputDevice=function(){var w=this;return this.inputDevice?this._onActiveInputChanged(null).then(function(){w._replaceStream(null),w._inputDevice=null,w._maybeStopPollingVolume()}):Promise.resolve()},A.prototype._addEnabledSounds=function(w){var c=this;function m(n,e){return typeof e<"u"&&(w[n]=e),w[n]}Object.keys(w).forEach(function(n){c[n]=m.bind(null,n)})},A.prototype._getUnknownDeviceIndex=function(w){var c=w.deviceId,m=w.kind,n=this._unknownDeviceIndexes[m][c];return n||(n=Object.keys(this._unknownDeviceIndexes[m]).length+1,this._unknownDeviceIndexes[m][c]=n),n},A.prototype._initializeEnumeration=function(){var w=this;if(!this._mediaDevices||!this._enumerateDevices)throw new o.NotSupportedError("Enumeration is not supported");this._mediaDevices.addEventListener&&this._mediaDevices.addEventListener("devicechange",this._updateAvailableDevices),this._updateAvailableDevices().then(function(){w.isOutputSelectionSupported&&Promise.all([w.speakerDevices.set("default"),w.ringtoneDevices.set("default")]).catch(function(c){w._log.warn("Warning: Unable to set audio output devices. "+c)})})},A.prototype._replaceStream=function(w){this._inputStream&&this._inputStream.getTracks().forEach(function(c){c.stop()}),this._inputStream=w},A.prototype._setInputDevice=function(w,c){var m=this;if(typeof w!="string")return Promise.reject(new o.InvalidArgumentError("Must specify the device to set"));var n=this.availableInputDevices.get(w);if(!n)return Promise.reject(new o.InvalidArgumentError("Device not found: "+w));if(this._inputDevice&&this._inputDevice.deviceId===w&&this._inputStream){if(!c)return Promise.resolve();this._inputStream.getTracks().forEach(function(t){t.stop()})}var e={audio:Object.assign({deviceId:{exact:w}},this.audioConstraints)};return this._getUserMedia(e).then(function(t){return m._onActiveInputChanged(t).then(function(){m._replaceStream(t),m._inputDevice=n,m._maybeStartPollingVolume()})})},A.prototype._updateDevices=function(w,c,m){var n=this,e=w.map(function(r){return r.deviceId}),t=Array.from(c.values()).map(function(r){return r.deviceId}),b=[],C=h.difference(t,e);C.forEach(function(r){var i=c.get(r);i&&(c.delete(r),m(i)&&b.push(i))});var f=!1;w.forEach(function(r){var i=c.get(r.deviceId),_=n._wrapMediaDeviceInfo(r);(!i||i.label!==_.label)&&(c.set(r.deviceId,_),f=!0)}),(f||C.length)&&(this.inputDevice!==null&&this.inputDevice.deviceId==="default"&&(this._log.warn("Calling getUserMedia after device change to ensure that the           tracks of the active device (default) have not gone stale."),this._setInputDevice(this.inputDevice.deviceId,!0)),this.emit("deviceChange",b))},A.prototype._updateVolumeSource=function(){if(!(!this._inputStream||!this._audioContext||!this._inputVolumeAnalyser)){this._inputVolumeSource&&this._inputVolumeSource.disconnect();try{this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser)}catch(w){this._log.warn("Unable to update volume source",w),delete this._inputVolumeSource}}},A.prototype._wrapMediaDeviceInfo=function(w){var c={deviceId:w.deviceId,groupId:w.groupId,kind:w.kind,label:w.label};if(!c.label)if(c.deviceId==="default")c.label="Default";else{var m=this._getUnknownDeviceIndex(w);c.label="Unknown "+a[c.kind]+" Device "+m}return new v(c)},A}(y.EventEmitter);return u||(u={}),Ne.default=u,Ne}var ot={},hn;function Ho(){if(hn)return ot;hn=1,Object.defineProperty(ot,"__esModule",{value:!0});var l=he(),y={dtmf0:[1360,960],dtmf1:[1230,720],dtmf2:[1360,720],dtmf3:[1480,720],dtmf4:[1230,790],dtmf5:[1360,790],dtmf6:[1480,790],dtmf7:[1230,870],dtmf8:[1360,870],dtmf9:[1480,870],dtmfh:[1480,960],dtmfs:[1230,960]},o=function(){function s(d){var h=this;this._context=d,this._gainNodes=[],this._gainNodes=[this._context.createGain(),this._context.createGain()],this._gainNodes.forEach(function(v){v.connect(h._context.destination),v.gain.value=.1,h._gainNodes.push(v)})}return s.prototype.cleanup=function(){this._gainNodes.forEach(function(d){d.disconnect()})},s.prototype.play=function(d){var h=this,v=y[d];if(!v)throw new l.InvalidArgumentError("Invalid DTMF sound name");var a=[this._context.createOscillator(),this._context.createOscillator()];a.forEach(function(u,P){u.type="sine",u.frequency.value=v[P],u.connect(h._gainNodes[P]),u.start(),u.stop(h._context.currentTime+.1),u.addEventListener("ended",function(){return u.disconnect()})})},s}();return ot.default=o,ot}var Se={},mt,vn;function zo(){if(vn)return mt;vn=1;var l=32767,y=typeof window<"u"?window.RTCStatsReport:void 0;function o(f){if(!(this instanceof o))return new o(f);var r=this;Object.defineProperties(this,{size:{enumerable:!0,get:function(){return r._map.size}},_map:{value:f}}),this[Symbol.iterator]=f[Symbol.iterator]}y&&(o.prototype=Object.create(y.prototype),o.prototype.constructor=o),["entries","forEach","get","has","keys","values"].forEach(function(f){o.prototype[f]=function(){for(var r,i=[],_=0;_<arguments.length;_++)i[_]=arguments[_];return(r=this._map)[f].apply(r,i)}}),o.fromArray=function(r){return new o(r.reduce(function(i,_){return i.set(_.id,_),i},new Map))},o.fromRTCStatsResponse=function(r){var i,_=new Map,S=r.result().reduce(function(I,D){var E=D.id;switch(D.type){case"googCertificate":I.set(E,w(D));break;case"datachannel":I.set(E,c(D));break;case"googCandidatePair":b(D,"googActiveConnection")&&(i=E),I.set(E,A(D));break;case"localcandidate":I.set(E,P(D,!1));break;case"remotecandidate":I.set(E,P(D,!0));break;case"ssrc":C(D,"packetsReceived")?I.set("rtp-"+E,a(D)):I.set("rtp-"+E,u(D)),I.set("track-"+E,h(D)),I.set("codec-"+E,d(D));break;case"googComponent":var T=s(D);_.set(T.selectedCandidatePairId,E),I.set(E,s(D));break}return I},new Map);if(i){var p=_.get(i);p&&(S.get(p).dtlsState="connected")}return new o(S)};function s(f){return{type:"transport",id:f.id,timestamp:Date.parse(f.timestamp),bytesSent:void 0,bytesReceived:void 0,rtcpTransportStatsId:void 0,dtlsState:void 0,selectedCandidatePairId:f.stat("selectedCandidatePairId"),localCertificateId:f.stat("localCertificateId"),remoteCertificateId:f.stat("remoteCertificateId")}}function d(f){return{type:"codec",id:f.id,timestamp:Date.parse(f.timestamp),payloadType:void 0,mimeType:f.stat("mediaType")+"/"+f.stat("googCodecName"),clockRate:void 0,channels:void 0,sdpFmtpLine:void 0,implementation:void 0}}function h(f){return{type:"track",id:f.id,timestamp:Date.parse(f.timestamp),trackIdentifier:f.stat("googTrackId"),remoteSource:void 0,ended:void 0,kind:f.stat("mediaType"),detached:void 0,ssrcIds:void 0,frameWidth:C(f,"googFrameWidthReceived")?e(f,"googFrameWidthReceived"):e(f,"googFrameWidthSent"),frameHeight:C(f,"googFrameHeightReceived")?e(f,"googFrameHeightReceived"):e(f,"googFrameHeightSent"),framesPerSecond:void 0,framesSent:e(f,"framesEncoded"),framesReceived:void 0,framesDecoded:e(f,"framesDecoded"),framesDropped:void 0,framesCorrupted:void 0,partialFramesLost:void 0,fullFramesLost:void 0,audioLevel:C(f,"audioOutputLevel")?e(f,"audioOutputLevel")/l:(e(f,"audioInputLevel")||0)/l,echoReturnLoss:t(f,"googEchoCancellationReturnLoss"),echoReturnLossEnhancement:t(f,"googEchoCancellationReturnLossEnhancement")}}function v(f,r){return{id:f.id,timestamp:Date.parse(f.timestamp),ssrc:f.stat("ssrc"),associateStatsId:void 0,isRemote:void 0,mediaType:f.stat("mediaType"),trackId:"track-"+f.id,transportId:f.stat("transportId"),codecId:"codec-"+f.id,firCount:r?e(f,"googFirsSent"):void 0,pliCount:r?e(f,"googPlisSent"):e(f,"googPlisReceived"),nackCount:r?e(f,"googNacksSent"):e(f,"googNacksReceived"),sliCount:void 0,qpSum:e(f,"qpSum")}}function a(f){var r=v(f,!0);return Object.assign(r,{type:"inbound-rtp",packetsReceived:e(f,"packetsReceived"),bytesReceived:e(f,"bytesReceived"),packetsLost:e(f,"packetsLost"),jitter:m(f.stat("googJitterReceived")),fractionLost:void 0,roundTripTime:m(f.stat("googRtt")),packetsDiscarded:void 0,packetsRepaired:void 0,burstPacketsLost:void 0,burstPacketsDiscarded:void 0,burstLossCount:void 0,burstDiscardCount:void 0,burstLossRate:void 0,burstDiscardRate:void 0,gapLossRate:void 0,gapDiscardRate:void 0,framesDecoded:e(f,"framesDecoded")}),r}function u(f){var r=v(f,!1);return Object.assign(r,{type:"outbound-rtp",remoteTimestamp:void 0,packetsSent:e(f,"packetsSent"),bytesSent:e(f,"bytesSent"),targetBitrate:void 0,framesEncoded:e(f,"framesEncoded")}),r}function P(f,r){return{type:r?"remote-candidate":"local-candidate",id:f.id,timestamp:Date.parse(f.timestamp),transportId:void 0,isRemote:r,ip:f.stat("ipAddress"),port:e(f,"portNumber"),protocol:f.stat("transport"),candidateType:n(f.stat("candidateType")),priority:t(f,"priority"),url:void 0,relayProtocol:void 0,deleted:void 0}}function A(f){return{type:"candidate-pair",id:f.id,timestamp:Date.parse(f.timestamp),transportId:f.stat("googChannelId"),localCandidateId:f.stat("localCandidateId"),remoteCandidateId:f.stat("remoteCandidateId"),state:void 0,priority:void 0,nominated:void 0,writable:b(f,"googWritable"),readable:void 0,bytesSent:e(f,"bytesSent"),bytesReceived:e(f,"bytesReceived"),lastPacketSentTimestamp:void 0,lastPacketReceivedTimestamp:void 0,totalRoundTripTime:void 0,currentRoundTripTime:m(f.stat("googRtt")),availableOutgoingBitrate:void 0,availableIncomingBitrate:void 0,requestsReceived:e(f,"requestsReceived"),requestsSent:e(f,"requestsSent"),responsesReceived:e(f,"responsesReceived"),responsesSent:e(f,"responsesSent"),retransmissionsReceived:void 0,retransmissionsSent:void 0,consentRequestsSent:e(f,"consentRequestsSent")}}function w(f){return{type:"certificate",id:f.id,timestamp:Date.parse(f.timestamp),fingerprint:f.stat("googFingerprint"),fingerprintAlgorithm:f.stat("googFingerprintAlgorithm"),base64Certificate:f.stat("googDerBase64"),issuerCertificateId:f.stat("googIssuerId")}}function c(f){return{type:"data-channel",id:f.id,timestamp:Date.parse(f.timestamp),label:f.stat("label"),protocol:f.stat("protocol"),datachannelid:f.stat("datachannelid"),transportId:f.stat("transportId"),state:f.stat("state"),messagesSent:void 0,bytesSent:void 0,messagesReceived:void 0,bytesReceived:void 0}}function m(f){return isNaN(f)||f===""?void 0:parseInt(f,10)/1e3}function n(f){switch(f){case"peerreflexive":return"prflx";case"serverreflexive":return"srflx";case"host":case"relay":default:return f}}function e(f,r){var i=f.stat(r);return C(f,r)?parseInt(i,10):void 0}function t(f,r){var i=f.stat(r);return C(f,r)?parseFloat(i):void 0}function b(f,r){var i=f.stat(r);return C(f,r)?i==="true"||i===!0:void 0}function C(f,r){var i=f.stat(r);return typeof i<"u"&&i!==""}return mt=o,mt}var Ye,mn;function gn(){if(mn)return Ye;mn=1;var l=Ye&&Ye.__spreadArrays||function(){for(var m=0,n=0,e=arguments.length;n<e;n++)m+=arguments[n].length;for(var t=Array(m),b=0,n=0;n<e;n++)for(var C=arguments[n],f=0,r=C.length;f<r;f++,b++)t[b]=C[f];return t},y=he(),o=y.NotSupportedError,s=y.InvalidArgumentError,d=zo(),h="PeerConnection is null",v="WebRTC statistics are unsupported";function a(m,n){return typeof m.get=="function"?m.get(n):m.find(function(e){return e.id===n})}function u(m){if(!m)return Promise.reject(new s(h));if(typeof m.getStats!="function")return Promise.reject(new o(v));var n;try{n=m.getStats()}catch{n=new Promise(function(t){return m.getStats(t)}).then(d.fromRTCStatsResponse)}return n}function P(m,n){return n=Object.assign({createRTCSample:c},n),u(m).then(n.createRTCSample)}function A(m){return u(m).then(function(n){var e=Array.from(n.values()).reduce(function(_,S){switch(["candidatePairs","localCandidates","remoteCandidates"].forEach(function(p){_[p]||(_[p]=[])}),S.type){case"candidate-pair":_.candidatePairs.push(S);break;case"local-candidate":_.localCandidates.push(S);break;case"remote-candidate":_.remoteCandidates.push(S);break;case"transport":S.selectedCandidatePairId&&(_.transport=S);break}return _},{}),t=e.candidatePairs,b=e.localCandidates,C=e.remoteCandidates,f=e.transport,r=t.find(function(_){return _.selected||f&&_.id===f.selectedCandidatePairId}),i;return r&&(i={localCandidate:b.find(function(_){return _.id===r.localCandidateId}),remoteCandidate:C.find(function(_){return _.id===r.remoteCandidateId})}),{iceCandidateStats:l(b,C),selectedIceCandidatePairStats:i}})}function w(){}function c(m){var n=null,e=new w,t;Array.from(m.values()).forEach(function(i){if(!i.isRemote){var _=i.type.replace("-","");if(t=t||i.timestamp,i.remoteId){var S=a(m,i.remoteId);S&&S.roundTripTime&&(e.rtt=S.roundTripTime*1e3)}switch(_){case"inboundrtp":e.timestamp=e.timestamp||i.timestamp,e.jitter=i.jitter*1e3,e.packetsLost=i.packetsLost,e.packetsReceived=i.packetsReceived,e.bytesReceived=i.bytesReceived;break;case"outboundrtp":if(e.timestamp=i.timestamp,e.packetsSent=i.packetsSent,e.bytesSent=i.bytesSent,i.codecId){var p=a(m,i.codecId);e.codecName=p?p.mimeType&&p.mimeType.match(/(.*\/)?(.*)/)[2]:i.codecId}break;case"transport":n=i.id;break}}}),e.timestamp||(e.timestamp=t);var b=a(m,n);if(!b)return e;var C=a(m,b.selectedCandidatePairId);if(!C)return e;var f=a(m,C.localCandidateId),r=a(m,C.remoteCandidateId);return e.rtt||(e.rtt=C&&C.currentRoundTripTime*1e3),Object.assign(e,{localAddress:f&&f.ip,remoteAddress:r&&r.ip}),e}return Ye={getRTCStats:P,getRTCIceCandidateStatsReport:A},Ye}var yn;function _n(){return yn||(yn=1,function(l){var y=Se&&Se.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,C){b.__proto__=C}||function(b,C){for(var f in C)C.hasOwnProperty(f)&&(b[f]=C[f])},n(e,t)};return function(e,t){n(e,t);function b(){this.constructor=e}e.prototype=t===null?Object.create(t):(b.prototype=t.prototype,new b)}}(),o=Se&&Se.__assign||function(){return o=Object.assign||function(n){for(var e,t=1,b=arguments.length;t<b;t++){e=arguments[t];for(var C in e)Object.prototype.hasOwnProperty.call(e,C)&&(n[C]=e[C])}return n},o.apply(this,arguments)},s=Se&&Se.__awaiter||function(n,e,t,b){function C(f){return f instanceof t?f:new t(function(r){r(f)})}return new(t||(t=Promise))(function(f,r){function i(p){try{S(b.next(p))}catch(I){r(I)}}function _(p){try{S(b.throw(p))}catch(I){r(I)}}function S(p){p.done?f(p.value):C(p.value).then(i,_)}S((b=b.apply(n,e||[])).next())})},d=Se&&Se.__generator||function(n,e){var t={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},b,C,f,r;return r={next:i(0),throw:i(1),return:i(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function i(S){return function(p){return _([S,p])}}function _(S){if(b)throw new TypeError("Generator is already executing.");for(;t;)try{if(b=1,C&&(f=S[0]&2?C.return:S[0]?C.throw||((f=C.return)&&f.call(C),0):C.next)&&!(f=f.call(C,S[1])).done)return f;switch(C=0,f&&(S=[S[0]&2,f.value]),S[0]){case 0:case 1:f=S;break;case 4:return t.label++,{value:S[1],done:!1};case 5:t.label++,C=S[1],S=[0];continue;case 7:S=t.ops.pop(),t.trys.pop();continue;default:if(f=t.trys,!(f=f.length>0&&f[f.length-1])&&(S[0]===6||S[0]===2)){t=0;continue}if(S[0]===3&&(!f||S[1]>f[0]&&S[1]<f[3])){t.label=S[1];break}if(S[0]===6&&t.label<f[1]){t.label=f[1],f=S;break}if(f&&t.label<f[2]){t.label=f[2],t.ops.push(S);break}f[2]&&t.ops.pop(),t.trys.pop();continue}S=e.call(n,t)}catch(p){S=[6,p],C=0}finally{b=f=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}};Object.defineProperty(l,"__esModule",{value:!0});var h=me(),v=Yr(),a=$r(),u=he(),P=gn(),A=Ue(),w=A.COWBELL_AUDIO_URL,c=A.ECHO_TEST_DURATION,m=function(n){y(e,n);function e(t,b){var C=n.call(this)||this;return C._hasInsightsErrored=!1,C._networkTiming={},C._options={codecPreferences:[v.default.Codec.PCMU,v.default.Codec.Opus],debug:!1,edge:"roaming",fakeMicInput:!1,signalingTimeoutMs:1e4},C._status=e.Status.Connecting,Object.assign(C._options,b),C._samples=[],C._warnings=[],C._startTime=Date.now(),C._initDevice(t,o(o({},C._options),{fileInputStream:C._options.fakeMicInput?C._getStreamFromFile():void 0})),C}return e.prototype.stop=function(){var t=this,b={code:31008,message:"Call cancelled"};this._device?(this._device.once("offline",function(){return t._onFailed(b)}),this._device.destroy()):this._onFailed(b)},e.prototype._emitWarning=function(t,b,C){var f={name:t,description:b};C&&(f.rtcWarning=C),this._warnings.push(f),this.emit(e.Events.Warning,f)},e.prototype._getCallQuality=function(t){return t>4.2?e.CallQuality.Excellent:t>=4.1&&t<=4.2?e.CallQuality.Great:t>=3.7&&t<=4?e.CallQuality.Good:t>=3.1&&t<=3.6?e.CallQuality.Fair:e.CallQuality.Degraded},e.prototype._getReport=function(){var t=this._getRTCStats(),b={start:this._startTime};this._endTime&&(b.end=this._endTime,b.duration=this._endTime-this._startTime);var C={callSid:this._callSid,edge:this._edge,iceCandidateStats:this._rtcIceCandidateStatsReport.iceCandidateStats,networkTiming:this._networkTiming,samples:this._samples,selectedEdge:this._options.edge,stats:t,testTiming:b,totals:this._getRTCSampleTotals(),warnings:this._warnings},f=this._rtcIceCandidateStatsReport.selectedIceCandidatePairStats;return f&&(C.selectedIceCandidatePairStats=f,C.isTurnRequired=f.localCandidate.candidateType==="relay"||f.remoteCandidate.candidateType==="relay"),t&&(C.callQuality=this._getCallQuality(t.mos.average)),C},e.prototype._getRTCSampleTotals=function(){if(this._latestSample)return o({},this._latestSample.totals)},e.prototype._getRTCStats=function(){var t=this._samples.findIndex(function(C){return typeof C.mos=="number"&&C.mos>0}),b=t>=0?this._samples.slice(t):[];if(!(!b||!b.length))return["jitter","mos","rtt"].reduce(function(C,f){var r,i=b.map(function(_){return _[f]});return o(o({},C),(r={},r[f]={average:Number((i.reduce(function(_,S){return _+S})/i.length).toPrecision(5)),max:Math.max.apply(Math,i),min:Math.min.apply(Math,i)},r))},{})},e.prototype._getStreamFromFile=function(){var t=this._options.audioContext;if(!t)throw new u.NotSupportedError("Cannot fake input audio stream: AudioContext is not supported by this browser.");var b=new Audio(w);b.addEventListener("canplaythrough",function(){return b.play()}),typeof b.setAttribute=="function"&&b.setAttribute("crossorigin","anonymous");var C=t.createMediaElementSource(b),f=t.createMediaStreamDestination();return C.connect(f),f.stream},e.prototype._initDevice=function(t,b){var C=this;try{this._device=new(b.deviceFactory||a.default)(t,{codecPreferences:b.codecPreferences,debug:b.debug,edge:b.edge,fileInputStream:b.fileInputStream,iceServers:b.iceServers,preflight:!0,rtcConfiguration:b.rtcConfiguration})}catch(f){setTimeout(function(){C._onFailed(f)});return}this._device.once("ready",function(){C._onDeviceReady()}),this._device.once("error",function(f){C._onDeviceError(f)}),this._signalingTimeoutTimer=setTimeout(function(){C._onDeviceError({code:31901,message:"WebSocket - Connection Timeout"})},b.signalingTimeoutMs)},e.prototype._onDeviceError=function(t){this._device.destroy(),this._onFailed(t)},e.prototype._onDeviceReady=function(){var t=this;if(clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),this._connection=this._device.connect(),this._networkTiming.signaling={start:Date.now()},this._setupConnectionHandlers(this._connection),this._edge=this._device.edge||void 0,this._options.fakeMicInput){this._echoTimer=setTimeout(function(){return t._device.disconnectAll()},c);var b=this._device.audio;b&&(b.disconnect(!1),b.outgoing(!1))}this._device.once("disconnect",function(){t._device.once("offline",function(){return t._onOffline()}),t._device.destroy()});var C=this._connection._publisher;C.on("error",function(){t._hasInsightsErrored||t._emitWarning("insights-connection-error","Received an error when attempting to connect to Insights gateway"),t._hasInsightsErrored=!0})},e.prototype._onFailed=function(t){clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),this._releaseHandlers(),this._endTime=Date.now(),this._status=e.Status.Failed,this.emit(e.Events.Failed,t)},e.prototype._onOffline=function(){var t=this;setTimeout(function(){t._status!==e.Status.Failed&&(clearTimeout(t._echoTimer),clearTimeout(t._signalingTimeoutTimer),t._releaseHandlers(),t._endTime=Date.now(),t._status=e.Status.Completed,t._report=t._getReport(),t.emit(e.Events.Completed,t._report))},10)},e.prototype._releaseHandlers=function(){[this._device,this._connection].forEach(function(t){t&&t.eventNames().forEach(function(b){return t.removeAllListeners(b)})})},e.prototype._setupConnectionHandlers=function(t){var b=this;this._options.fakeMicInput&&t.once("volume",function(){t.mediaStream.outputs.forEach(function(C){return C.audio.muted=!0})}),t.on("warning",function(C,f){b._emitWarning(C,"Received an RTCWarning. See .rtcWarning for the RTCWarning",f)}),t.once("accept",function(){b._callSid=t.mediaStream.callSid,b._status=e.Status.Connected,b.emit(e.Events.Connected)}),t.on("sample",function(C){return s(b,void 0,void 0,function(){var f;return d(this,function(r){switch(r.label){case 0:return this._latestSample?[3,2]:(f=this,[4,(this._options.getRTCIceCandidateStatsReport||P.getRTCIceCandidateStatsReport)(t.mediaStream.version.pc)]);case 1:f._rtcIceCandidateStatsReport=r.sent(),r.label=2;case 2:return this._latestSample=C,this._samples.push(C),this.emit(e.Events.Sample,C),[2]}})})}),[{reportLabel:"peerConnection",type:"pcconnection"},{reportLabel:"ice",type:"iceconnection"},{reportLabel:"dtls",type:"dtlstransport"},{reportLabel:"signaling",type:"signaling"}].forEach(function(C){var f=C.type,r=C.reportLabel,i="on"+f+"statechange",_=t.mediaStream[i];t.mediaStream[i]=function(S){var p=b._networkTiming[r]=b._networkTiming[r]||{start:0};S==="connecting"||S==="checking"?p.start=Date.now():(S==="connected"||S==="stable")&&!p.duration&&(p.end=Date.now(),p.duration=p.end-p.start),_(S)}})},Object.defineProperty(e.prototype,"callSid",{get:function(){return this._callSid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endTime",{get:function(){return this._endTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"latestSample",{get:function(){return this._latestSample},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),e}(h.EventEmitter);l.PreflightTest=m,function(n){(function(e){e.Excellent="excellent",e.Great="great",e.Good="good",e.Fair="fair",e.Degraded="degraded"})(n.CallQuality||(n.CallQuality={})),function(e){e.Completed="completed",e.Connected="connected",e.Failed="failed",e.Sample="sample",e.Warning="warning"}(n.Events||(n.Events={})),function(e){e.Connecting="connecting",e.Connected="connected",e.Completed="completed",e.Failed="failed"}(n.Status||(n.Status={}))}(m=l.PreflightTest||(l.PreflightTest={})),l.PreflightTest=m}(Se)),Se}var gt={},bn;function $o(){return bn||(bn=1,function(l){var y,o,s,d;Object.defineProperty(l,"__esModule",{value:!0});var h=he(),v;(function(m){m.Au="au",m.Br="br",m.Ie="ie",m.Jp="jp",m.Sg="sg",m.UsOr="us-or",m.UsVa="us-va"})(v=l.DeprecatedRegion||(l.DeprecatedRegion={}));var a;(function(m){m.Sydney="sydney",m.SaoPaulo="sao-paulo",m.Dublin="dublin",m.Frankfurt="frankfurt",m.Tokyo="tokyo",m.Singapore="singapore",m.Ashburn="ashburn",m.Umatilla="umatilla",m.Roaming="roaming",m.AshburnIx="ashburn-ix",m.SanJoseIx="san-jose-ix",m.LondonIx="london-ix",m.FrankfurtIx="frankfurt-ix",m.SingaporeIx="singapore-ix",m.SydneyIx="sydney-ix",m.TokyoIx="tokyo-ix"})(a=l.Edge||(l.Edge={}));var u;(function(m){m.Au1="au1",m.Au1Ix="au1-ix",m.Br1="br1",m.De1="de1",m.De1Ix="de1-ix",m.Gll="gll",m.Ie1="ie1",m.Ie1Ix="ie1-ix",m.Ie1Tnx="ie1-tnx",m.Jp1="jp1",m.Jp1Ix="jp1-ix",m.Sg1="sg1",m.Sg1Ix="sg1-ix",m.Sg1Tnx="sg1-tnx",m.Us1="us1",m.Us1Ix="us1-ix",m.Us1Tnx="us1-tnx",m.Us2="us2",m.Us2Ix="us2-ix",m.Us2Tnx="us2-tnx"})(u=l.Region||(l.Region={})),l.deprecatedRegions=(y={},y[v.Au]=u.Au1,y[v.Br]=u.Br1,y[v.Ie]=u.Ie1,y[v.Jp]=u.Jp1,y[v.Sg]=u.Sg1,y[v.UsOr]=u.Us1,y[v.UsVa]=u.Us1,y),l.regionShortcodes={ASIAPAC_SINGAPORE:u.Sg1,ASIAPAC_SYDNEY:u.Au1,ASIAPAC_TOKYO:u.Jp1,EU_FRANKFURT:u.De1,EU_IRELAND:u.Ie1,SOUTH_AMERICA_SAO_PAULO:u.Br1,US_EAST_VIRGINIA:u.Us1,US_WEST_OREGON:u.Us2},o={},o[u.Au1]="chunderw-vpc-gll-au1.twilio.com",o[u.Au1Ix]="chunderw-vpc-gll-au1-ix.twilio.com",o[u.Br1]="chunderw-vpc-gll-br1.twilio.com",o[u.De1]="chunderw-vpc-gll-de1.twilio.com",o[u.De1Ix]="chunderw-vpc-gll-de1-ix.twilio.com",o[u.Gll]="chunderw-vpc-gll.twilio.com",o[u.Ie1]="chunderw-vpc-gll-ie1.twilio.com",o[u.Ie1Ix]="chunderw-vpc-gll-ie1-ix.twilio.com",o[u.Ie1Tnx]="chunderw-vpc-gll-ie1-tnx.twilio.com",o[u.Jp1]="chunderw-vpc-gll-jp1.twilio.com",o[u.Jp1Ix]="chunderw-vpc-gll-jp1-ix.twilio.com",o[u.Sg1]="chunderw-vpc-gll-sg1.twilio.com",o[u.Sg1Ix]="chunderw-vpc-gll-sg1-ix.twilio.com",o[u.Sg1Tnx]="chunderw-vpc-gll-sg1-tnx.twilio.com",o[u.Us1]="chunderw-vpc-gll-us1.twilio.com",o[u.Us1Ix]="chunderw-vpc-gll-us1-ix.twilio.com",o[u.Us1Tnx]="chunderw-vpc-gll-us1-tnx.twilio.com",o[u.Us2]="chunderw-vpc-gll-us2.twilio.com",o[u.Us2Ix]="chunderw-vpc-gll-us2-ix.twilio.com",o[u.Us2Tnx]="chunderw-vpc-gll-us2-tnx.twilio.com",l.edgeToRegion=(s={},s[a.Sydney]=u.Au1,s[a.SaoPaulo]=u.Br1,s[a.Dublin]=u.Ie1,s[a.Frankfurt]=u.De1,s[a.Tokyo]=u.Jp1,s[a.Singapore]=u.Sg1,s[a.Ashburn]=u.Us1,s[a.Umatilla]=u.Us2,s[a.Roaming]=u.Gll,s[a.AshburnIx]=u.Us1Ix,s[a.SanJoseIx]=u.Us2Ix,s[a.LondonIx]=u.Ie1Ix,s[a.FrankfurtIx]=u.De1Ix,s[a.SingaporeIx]=u.Sg1Ix,s[a.SydneyIx]=u.Au1Ix,s[a.TokyoIx]=u.Jp1Ix,s),l.regionToEdge=(d={},d[u.Au1]=a.Sydney,d[u.Br1]=a.SaoPaulo,d[u.Ie1]=a.Dublin,d[u.De1]=a.Frankfurt,d[u.Jp1]=a.Tokyo,d[u.Sg1]=a.Singapore,d[u.Us1]=a.Ashburn,d[u.Us2]=a.Umatilla,d[u.Gll]=a.Roaming,d[u.Us1Ix]=a.AshburnIx,d[u.Us2Ix]=a.SanJoseIx,d[u.Ie1Ix]=a.LondonIx,d[u.De1Ix]=a.FrankfurtIx,d[u.Sg1Ix]=a.SingaporeIx,d[u.Au1Ix]=a.SydneyIx,d[u.Jp1Ix]=a.TokyoIx,d[u.Us1Tnx]=a.AshburnIx,d[u.Us2Tnx]=a.AshburnIx,d[u.Ie1Tnx]=a.LondonIx,d[u.Sg1Tnx]=a.SingaporeIx,d),l.defaultRegion="gll",l.defaultEdge=a.Roaming,l.defaultChunderRegionURI="chunderw-vpc-gll.twilio.com";function P(m){return m===l.defaultRegion?l.defaultChunderRegionURI:"chunderw-vpc-gll-"+m+".twilio.com"}function A(m){return"voice-js."+m+".twilio.com"}function w(m,n,e){if(n&&typeof n!="string")throw new h.InvalidArgumentError("If `region` is provided, it must be of type `string`.");if(m&&typeof m!="string"&&!Array.isArray(m))throw new h.InvalidArgumentError("If `edge` is provided, it must be of type `string` or an array of strings.");var t=[],b;if(n&&m)throw new h.InvalidArgumentError("You cannot specify `region` when `edge` is specified in`Twilio.Device.Options`.");if(n){var C=n;t.push("Regions are deprecated in favor of edges. Please see this page for documentation: https://www.twilio.com/docs/voice/client/edges.");var f=Object.values(v).includes(C);f&&(C=l.deprecatedRegions[C]);var r=Object.values(u).includes(C);if(r){var i=l.regionToEdge[C];t.push('Region "'+C+'" is deprecated, please use `edge` '+('"'+i+'".'))}b=[P(C)]}else if(m){var _=Object.values(a),S=Array.isArray(m)?m:[m];b=S.map(function(p){return _.includes(p)?P(l.edgeToRegion[p]):A(p)})}else b=[l.defaultChunderRegionURI];return e&&t.length&&setTimeout(function(){return e(t.join(`
`))}),b}l.getChunderURIs=w;function c(m){return l.regionShortcodes[m]||null}l.getRegionShortcode=c}(gt)),gt}var yt,Sn;function Jo(){return Sn||(Sn=1,yt={XMLHttpRequest}),yt}var _t,wn;function Yo(){if(wn)return _t;wn=1;var l=Jo().XMLHttpRequest;function y(s,d,h){var v={};v.XMLHttpRequest=v.XMLHttpRequest||l;var a=new v.XMLHttpRequest;a.open(s,d.url,!0),a.onreadystatechange=function(){if(a.readyState===4){if(200<=a.status&&a.status<300){h(null,a.responseText);return}h(new Error(a.responseText))}};for(var u in d.headers)a.setRequestHeader(u,d.headers[u]);a.send(JSON.stringify(d.body))}var o=y;return o.get=function(d,h){return new this("GET",d,h)},o.post=function(d,h){return new this("POST",d,h)},_t=o,_t}var bt={},St={},wt,En;function Cn(){return En||(En=1,wt=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var y={},o=Symbol("test"),s=Object(o);if(typeof o=="string"||Object.prototype.toString.call(o)!=="[object Symbol]"||Object.prototype.toString.call(s)!=="[object Symbol]")return!1;var d=42;y[o]=d;for(var h in y)return!1;if(typeof Object.keys=="function"&&Object.keys(y).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(y).length!==0)return!1;var v=Object.getOwnPropertySymbols(y);if(v.length!==1||v[0]!==o||!Object.prototype.propertyIsEnumerable.call(y,o))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(y,o);if(a.value!==d||a.enumerable!==!0)return!1}return!0}),wt}var Et,Tn;function at(){if(Tn)return Et;Tn=1;var l=Cn();return Et=function(){return l()&&!!Symbol.toStringTag},Et}var Ct,Pn;function An(){return Pn||(Pn=1,Ct=Object),Ct}var Tt,Rn;function Ko(){return Rn||(Rn=1,Tt=Error),Tt}var Pt,In;function Xo(){return In||(In=1,Pt=EvalError),Pt}var At,kn;function Qo(){return kn||(kn=1,At=RangeError),At}var Rt,On;function Zo(){return On||(On=1,Rt=ReferenceError),Rt}var It,Dn;function xn(){return Dn||(Dn=1,It=SyntaxError),It}var kt,jn;function Ke(){return jn||(jn=1,kt=TypeError),kt}var Ot,Mn;function ea(){return Mn||(Mn=1,Ot=URIError),Ot}var Dt,Ln;function ta(){return Ln||(Ln=1,Dt=Math.abs),Dt}var xt,Fn;function ra(){return Fn||(Fn=1,xt=Math.floor),xt}var jt,Nn;function na(){return Nn||(Nn=1,jt=Math.max),jt}var Mt,Un;function ia(){return Un||(Un=1,Mt=Math.min),Mt}var Lt,qn;function oa(){return qn||(qn=1,Lt=Math.pow),Lt}var Ft,Bn;function aa(){return Bn||(Bn=1,Ft=Math.round),Ft}var Nt,Gn;function sa(){return Gn||(Gn=1,Nt=Number.isNaN||function(y){return y!==y}),Nt}var Ut,Wn;function ua(){if(Wn)return Ut;Wn=1;var l=sa();return Ut=function(o){return l(o)||o===0?o:o<0?-1:1},Ut}var qt,Vn;function ca(){return Vn||(Vn=1,qt=Object.getOwnPropertyDescriptor),qt}var Bt,Hn;function qe(){if(Hn)return Bt;Hn=1;var l=ca();if(l)try{l([],"length")}catch{l=null}return Bt=l,Bt}var Gt,zn;function st(){if(zn)return Gt;zn=1;var l=Object.defineProperty||!1;if(l)try{l({},"a",{value:1})}catch{l=!1}return Gt=l,Gt}var Wt,$n;function la(){if($n)return Wt;$n=1;var l=typeof Symbol<"u"&&Symbol,y=Cn();return Wt=function(){return typeof l!="function"||typeof Symbol!="function"||typeof l("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:y()},Wt}var Vt,Jn;function Yn(){return Jn||(Jn=1,Vt=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Vt}var Ht,Kn;function Xn(){if(Kn)return Ht;Kn=1;var l=An();return Ht=l.getPrototypeOf||null,Ht}var zt,Qn;function fa(){if(Qn)return zt;Qn=1;var l="Function.prototype.bind called on incompatible ",y=Object.prototype.toString,o=Math.max,s="[object Function]",d=function(u,P){for(var A=[],w=0;w<u.length;w+=1)A[w]=u[w];for(var c=0;c<P.length;c+=1)A[c+u.length]=P[c];return A},h=function(u,P){for(var A=[],w=P,c=0;w<u.length;w+=1,c+=1)A[c]=u[w];return A},v=function(a,u){for(var P="",A=0;A<a.length;A+=1)P+=a[A],A+1<a.length&&(P+=u);return P};return zt=function(u){var P=this;if(typeof P!="function"||y.apply(P)!==s)throw new TypeError(l+P);for(var A=h(arguments,1),w,c=function(){if(this instanceof w){var b=P.apply(this,d(A,arguments));return Object(b)===b?b:this}return P.apply(u,d(A,arguments))},m=o(0,P.length-A.length),n=[],e=0;e<m;e++)n[e]="$"+e;if(w=Function("binder","return function ("+v(n,",")+"){ return binder.apply(this,arguments); }")(c),P.prototype){var t=function(){};t.prototype=P.prototype,w.prototype=new t,t.prototype=null}return w},zt}var $t,Zn;function Xe(){if(Zn)return $t;Zn=1;var l=fa();return $t=Function.prototype.bind||l,$t}var Jt,ei;function Yt(){return ei||(ei=1,Jt=Function.prototype.call),Jt}var Kt,ti;function Xt(){return ti||(ti=1,Kt=Function.prototype.apply),Kt}var Qt,ri;function da(){return ri||(ri=1,Qt=typeof Reflect<"u"&&Reflect&&Reflect.apply),Qt}var Zt,ni;function ii(){if(ni)return Zt;ni=1;var l=Xe(),y=Xt(),o=Yt(),s=da();return Zt=s||l.call(o,y),Zt}var er,oi;function tr(){if(oi)return er;oi=1;var l=Xe(),y=Ke(),o=Yt(),s=ii();return er=function(h){if(h.length<1||typeof h[0]!="function")throw new y("a function is required");return s(l,o,h)},er}var rr,ai;function pa(){if(ai)return rr;ai=1;var l=tr(),y=qe(),o;try{o=[].__proto__===Array.prototype}catch(v){if(!v||typeof v!="object"||!("code"in v)||v.code!=="ERR_PROTO_ACCESS")throw v}var s=!!o&&y&&y(Object.prototype,"__proto__"),d=Object,h=d.getPrototypeOf;return rr=s&&typeof s.get=="function"?l([s.get]):typeof h=="function"?function(a){return h(a==null?a:d(a))}:!1,rr}var nr,si;function ir(){if(si)return nr;si=1;var l=Yn(),y=Xn(),o=pa();return nr=l?function(d){return l(d)}:y?function(d){if(!d||typeof d!="object"&&typeof d!="function")throw new TypeError("getProto: not an object");return y(d)}:o?function(d){return o(d)}:null,nr}var or,ui;function ci(){if(ui)return or;ui=1;var l=Function.prototype.call,y=Object.prototype.hasOwnProperty,o=Xe();return or=o.call(l,y),or}var ar,li;function fi(){if(li)return ar;li=1;var l,y=An(),o=Ko(),s=Xo(),d=Qo(),h=Zo(),v=xn(),a=Ke(),u=ea(),P=ta(),A=ra(),w=na(),c=ia(),m=oa(),n=aa(),e=ua(),t=Function,b=function(K){try{return t('"use strict"; return ('+K+").constructor;")()}catch{}},C=qe(),f=st(),r=function(){throw new a},i=C?function(){try{return arguments.callee,r}catch{try{return C(arguments,"callee").get}catch{return r}}}():r,_=la()(),S=ir(),p=Xn(),I=Yn(),D=Xt(),E=Yt(),T={},M=typeof Uint8Array>"u"||!S?l:S(Uint8Array),g={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?l:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?l:ArrayBuffer,"%ArrayIteratorPrototype%":_&&S?S([][Symbol.iterator]()):l,"%AsyncFromSyncIteratorPrototype%":l,"%AsyncFunction%":T,"%AsyncGenerator%":T,"%AsyncGeneratorFunction%":T,"%AsyncIteratorPrototype%":T,"%Atomics%":typeof Atomics>"u"?l:Atomics,"%BigInt%":typeof BigInt>"u"?l:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?l:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?l:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?l:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":o,"%eval%":eval,"%EvalError%":s,"%Float16Array%":typeof Float16Array>"u"?l:Float16Array,"%Float32Array%":typeof Float32Array>"u"?l:Float32Array,"%Float64Array%":typeof Float64Array>"u"?l:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?l:FinalizationRegistry,"%Function%":t,"%GeneratorFunction%":T,"%Int8Array%":typeof Int8Array>"u"?l:Int8Array,"%Int16Array%":typeof Int16Array>"u"?l:Int16Array,"%Int32Array%":typeof Int32Array>"u"?l:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":_&&S?S(S([][Symbol.iterator]())):l,"%JSON%":typeof JSON=="object"?JSON:l,"%Map%":typeof Map>"u"?l:Map,"%MapIteratorPrototype%":typeof Map>"u"||!_||!S?l:S(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":y,"%Object.getOwnPropertyDescriptor%":C,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?l:Promise,"%Proxy%":typeof Proxy>"u"?l:Proxy,"%RangeError%":d,"%ReferenceError%":h,"%Reflect%":typeof Reflect>"u"?l:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?l:Set,"%SetIteratorPrototype%":typeof Set>"u"||!_||!S?l:S(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?l:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":_&&S?S(""[Symbol.iterator]()):l,"%Symbol%":_?Symbol:l,"%SyntaxError%":v,"%ThrowTypeError%":i,"%TypedArray%":M,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?l:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?l:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?l:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?l:Uint32Array,"%URIError%":u,"%WeakMap%":typeof WeakMap>"u"?l:WeakMap,"%WeakRef%":typeof WeakRef>"u"?l:WeakRef,"%WeakSet%":typeof WeakSet>"u"?l:WeakSet,"%Function.prototype.call%":E,"%Function.prototype.apply%":D,"%Object.defineProperty%":f,"%Object.getPrototypeOf%":p,"%Math.abs%":P,"%Math.floor%":A,"%Math.max%":w,"%Math.min%":c,"%Math.pow%":m,"%Math.round%":n,"%Math.sign%":e,"%Reflect.getPrototypeOf%":I};if(S)try{null.error}catch(K){var $=S(S(K));g["%Error.prototype%"]=$}var N=function K(z){var Z;if(z==="%AsyncFunction%")Z=b("async function () {}");else if(z==="%GeneratorFunction%")Z=b("function* () {}");else if(z==="%AsyncGeneratorFunction%")Z=b("async function* () {}");else if(z==="%AsyncGenerator%"){var Q=K("%AsyncGeneratorFunction%");Q&&(Z=Q.prototype)}else if(z==="%AsyncIteratorPrototype%"){var te=K("%AsyncGenerator%");te&&S&&(Z=S(te.prototype))}return g[z]=Z,Z},R={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},O=Xe(),F=ci(),B=O.call(E,Array.prototype.concat),q=O.call(D,Array.prototype.splice),x=O.call(E,String.prototype.replace),j=O.call(E,String.prototype.slice),L=O.call(E,RegExp.prototype.exec),W=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,H=/\\(\\)?/g,Y=function(z){var Z=j(z,0,1),Q=j(z,-1);if(Z==="%"&&Q!=="%")throw new v("invalid intrinsic syntax, expected closing `%`");if(Q==="%"&&Z!=="%")throw new v("invalid intrinsic syntax, expected opening `%`");var te=[];return x(z,W,function(ae,le,oe,Pe){te[te.length]=oe?x(Pe,H,"$1"):le||ae}),te},J=function(z,Z){var Q=z,te;if(F(R,Q)&&(te=R[Q],Q="%"+te[0]+"%"),F(g,Q)){var ae=g[Q];if(ae===T&&(ae=N(Q)),typeof ae>"u"&&!Z)throw new a("intrinsic "+z+" exists, but is not available. Please file an issue!");return{alias:te,name:Q,value:ae}}throw new v("intrinsic "+z+" does not exist!")};return ar=function(z,Z){if(typeof z!="string"||z.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Z!="boolean")throw new a('"allowMissing" argument must be a boolean');if(L(/^%?[^%]*%?$/,z)===null)throw new v("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var Q=Y(z),te=Q.length>0?Q[0]:"",ae=J("%"+te+"%",Z),le=ae.name,oe=ae.value,Pe=!1,De=ae.alias;De&&(te=De[0],q(Q,B([0,1],De)));for(var U=1,Ae=!0;U<Q.length;U+=1){var _e=Q[U],xe=j(_e,0,1),Be=j(_e,-1);if((xe==='"'||xe==="'"||xe==="`"||Be==='"'||Be==="'"||Be==="`")&&xe!==Be)throw new v("property names with quotes must have matching quotes");if((_e==="constructor"||!Ae)&&(Pe=!0),te+="."+_e,le="%"+te+"%",F(g,le))oe=g[le];else if(oe!=null){if(!(_e in oe)){if(!Z)throw new a("base intrinsic for "+z+" exists, but the property is not available.");return}if(C&&U+1>=Q.length){var Ge=C(oe,_e);Ae=!!Ge,Ae&&"get"in Ge&&!("originalValue"in Ge.get)?oe=Ge.get:oe=oe[_e]}else Ae=F(oe,_e),oe=oe[_e];Ae&&!Pe&&(g[le]=oe)}}return oe},ar}var sr,di;function Qe(){if(di)return sr;di=1;var l=fi(),y=tr(),o=y([l("%String.prototype.indexOf%")]);return sr=function(d,h){var v=l(d,!!h);return typeof v=="function"&&o(d,".prototype.")>-1?y([v]):v},sr}var ur,pi;function ha(){if(pi)return ur;pi=1;var l=at()(),y=Qe(),o=y("Object.prototype.toString"),s=function(a){return l&&a&&typeof a=="object"&&Symbol.toStringTag in a?!1:o(a)==="[object Arguments]"},d=function(a){return s(a)?!0:a!==null&&typeof a=="object"&&"length"in a&&typeof a.length=="number"&&a.length>=0&&o(a)!=="[object Array]"&&"callee"in a&&o(a.callee)==="[object Function]"},h=function(){return s(arguments)}();return s.isLegacyArguments=d,ur=h?s:d,ur}var cr,hi;function va(){if(hi)return cr;hi=1;var l=Qe(),y=at()(),o=ci(),s=qe(),d;if(y){var h=l("RegExp.prototype.exec"),v={},a=function(){throw v},u={toString:a,valueOf:a};typeof Symbol.toPrimitive=="symbol"&&(u[Symbol.toPrimitive]=a),d=function(c){if(!c||typeof c!="object")return!1;var m=s(c,"lastIndex"),n=m&&o(m,"value");if(!n)return!1;try{h(c,u)}catch(e){return e===v}}}else{var P=l("Object.prototype.toString"),A="[object RegExp]";d=function(c){return!c||typeof c!="object"&&typeof c!="function"?!1:P(c)===A}}return cr=d,cr}var lr,vi;function ma(){if(vi)return lr;vi=1;var l=Qe(),y=va(),o=l("RegExp.prototype.exec"),s=Ke();return lr=function(h){if(!y(h))throw new s("`regex` must be a RegExp");return function(a){return o(h,a)!==null}},lr}var fr,mi;function ga(){if(mi)return fr;mi=1;var l=Qe(),y=ma(),o=y(/^\s*(?:function)?\*/),s=at()(),d=ir(),h=l("Object.prototype.toString"),v=l("Function.prototype.toString"),a=function(){if(!s)return!1;try{return Function("return function*() {}")()}catch{}},u;return fr=function(A){if(typeof A!="function")return!1;if(o(v(A)))return!0;if(!s){var w=h(A);return w==="[object GeneratorFunction]"}if(!d)return!1;if(typeof u>"u"){var c=a();u=c?d(c):!1}return d(A)===u},fr}var dr,gi;function ya(){if(gi)return dr;gi=1;var l=Function.prototype.toString,y=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,o,s;if(typeof y=="function"&&typeof Object.defineProperty=="function")try{o=Object.defineProperty({},"length",{get:function(){throw s}}),s={},y(function(){throw 42},null,o)}catch(C){C!==s&&(y=null)}else y=null;var d=/^\s*class\b/,h=function(f){try{var r=l.call(f);return d.test(r)}catch{return!1}},v=function(f){try{return h(f)?!1:(l.call(f),!0)}catch{return!1}},a=Object.prototype.toString,u="[object Object]",P="[object Function]",A="[object GeneratorFunction]",w="[object HTMLAllCollection]",c="[object HTML document.all class]",m="[object HTMLCollection]",n=typeof Symbol=="function"&&!!Symbol.toStringTag,e=!(0 in[,]),t=function(){return!1};if(typeof document=="object"){var b=document.all;a.call(b)===a.call(document.all)&&(t=function(f){if((e||!f)&&(typeof f>"u"||typeof f=="object"))try{var r=a.call(f);return(r===w||r===c||r===m||r===u)&&f("")==null}catch{}return!1})}return dr=y?function(f){if(t(f))return!0;if(!f||typeof f!="function"&&typeof f!="object")return!1;try{y(f,null,o)}catch(r){if(r!==s)return!1}return!h(f)&&v(f)}:function(f){if(t(f))return!0;if(!f||typeof f!="function"&&typeof f!="object")return!1;if(n)return v(f);if(h(f))return!1;var r=a.call(f);return r!==P&&r!==A&&!/^\[object HTML/.test(r)?!1:v(f)},dr}var pr,yi;function _a(){if(yi)return pr;yi=1;var l=ya(),y=Object.prototype.toString,o=Object.prototype.hasOwnProperty,s=function(u,P,A){for(var w=0,c=u.length;w<c;w++)o.call(u,w)&&(A==null?P(u[w],w,u):P.call(A,u[w],w,u))},d=function(u,P,A){for(var w=0,c=u.length;w<c;w++)A==null?P(u.charAt(w),w,u):P.call(A,u.charAt(w),w,u)},h=function(u,P,A){for(var w in u)o.call(u,w)&&(A==null?P(u[w],w,u):P.call(A,u[w],w,u))};function v(a){return y.call(a)==="[object Array]"}return pr=function(u,P,A){if(!l(P))throw new TypeError("iterator must be a function");var w;arguments.length>=3&&(w=A),v(u)?s(u,P,w):typeof u=="string"?d(u,P,w):h(u,P,w)},pr}var hr,_i;function ba(){return _i||(_i=1,hr=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),hr}var vr,bi;function Sa(){if(bi)return vr;bi=1;var l=ba(),y=typeof globalThis>"u"?He:globalThis;return vr=function(){for(var s=[],d=0;d<l.length;d++)typeof y[l[d]]=="function"&&(s[s.length]=l[d]);return s},vr}var mr={exports:{}},gr,Si;function wa(){if(Si)return gr;Si=1;var l=st(),y=xn(),o=Ke(),s=qe();return gr=function(h,v,a){if(!h||typeof h!="object"&&typeof h!="function")throw new o("`obj` must be an object or a function`");if(typeof v!="string"&&typeof v!="symbol")throw new o("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new o("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new o("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new o("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new o("`loose`, if provided, must be a boolean");var u=arguments.length>3?arguments[3]:null,P=arguments.length>4?arguments[4]:null,A=arguments.length>5?arguments[5]:null,w=arguments.length>6?arguments[6]:!1,c=!!s&&s(h,v);if(l)l(h,v,{configurable:A===null&&c?c.configurable:!A,enumerable:u===null&&c?c.enumerable:!u,value:a,writable:P===null&&c?c.writable:!P});else if(w||!u&&!P&&!A)h[v]=a;else throw new y("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},gr}var yr,wi;function Ea(){if(wi)return yr;wi=1;var l=st(),y=function(){return!!l};return y.hasArrayLengthDefineBug=function(){if(!l)return null;try{return l([],"length",{value:1}).length!==1}catch{return!0}},yr=y,yr}var _r,Ei;function Ca(){if(Ei)return _r;Ei=1;var l=fi(),y=wa(),o=Ea()(),s=qe(),d=Ke(),h=l("%Math.floor%");return _r=function(a,u){if(typeof a!="function")throw new d("`fn` is not a function");if(typeof u!="number"||u<0||u>4294967295||h(u)!==u)throw new d("`length` must be a positive 32-bit integer");var P=arguments.length>2&&!!arguments[2],A=!0,w=!0;if("length"in a&&s){var c=s(a,"length");c&&!c.configurable&&(A=!1),c&&!c.writable&&(w=!1)}return(A||w||!P)&&(o?y(a,"length",u,!0,!0):y(a,"length",u)),a},_r}var br,Ci;function Ta(){if(Ci)return br;Ci=1;var l=Xe(),y=Xt(),o=ii();return br=function(){return o(l,y,arguments)},br}var Ti;function Pa(){return Ti||(Ti=1,function(l){var y=Ca(),o=st(),s=tr(),d=Ta();l.exports=function(v){var a=s(arguments),u=v.length-(arguments.length-1);return y(a,1+(u>0?u:0),!0)},o?o(l.exports,"apply",{value:d}):l.exports.apply=d}(mr)),mr.exports}var Sr,Pi;function Ai(){if(Pi)return Sr;Pi=1;var l=_a(),y=Sa(),o=Pa(),s=Qe(),d=qe(),h=ir(),v=s("Object.prototype.toString"),a=at()(),u=typeof globalThis>"u"?He:globalThis,P=y(),A=s("String.prototype.slice"),w=s("Array.prototype.indexOf",!0)||function(t,b){for(var C=0;C<t.length;C+=1)if(t[C]===b)return C;return-1},c={__proto__:null};a&&d&&h?l(P,function(e){var t=new u[e];if(Symbol.toStringTag in t&&h){var b=h(t),C=d(b,Symbol.toStringTag);if(!C&&b){var f=h(b);C=d(f,Symbol.toStringTag)}c["$"+e]=o(C.get)}}):l(P,function(e){var t=new u[e],b=t.slice||t.set;b&&(c["$"+e]=o(b))});var m=function(t){var b=!1;return l(c,function(C,f){if(!b)try{"$"+C(t)===f&&(b=A(f,1))}catch{}}),b},n=function(t){var b=!1;return l(c,function(C,f){if(!b)try{C(t),b=A(f,1)}catch{}}),b};return Sr=function(t){if(!t||typeof t!="object")return!1;if(!a){var b=A(v(t),8,-1);return w(P,b)>-1?b:b!=="Object"?!1:n(t)}return d?m(t):null},Sr}var wr,Ri;function Aa(){if(Ri)return wr;Ri=1;var l=Ai();return wr=function(o){return!!l(o)},wr}var Ii;function Ra(){return Ii||(Ii=1,function(l){var y=ha(),o=ga(),s=Ai(),d=Aa();function h(U){return U.call.bind(U)}var v=typeof BigInt<"u",a=typeof Symbol<"u",u=h(Object.prototype.toString),P=h(Number.prototype.valueOf),A=h(String.prototype.valueOf),w=h(Boolean.prototype.valueOf);if(v)var c=h(BigInt.prototype.valueOf);if(a)var m=h(Symbol.prototype.valueOf);function n(U,Ae){if(typeof U!="object")return!1;try{return Ae(U),!0}catch{return!1}}l.isArgumentsObject=y,l.isGeneratorFunction=o,l.isTypedArray=d;function e(U){return typeof Promise<"u"&&U instanceof Promise||U!==null&&typeof U=="object"&&typeof U.then=="function"&&typeof U.catch=="function"}l.isPromise=e;function t(U){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(U):d(U)||j(U)}l.isArrayBufferView=t;function b(U){return s(U)==="Uint8Array"}l.isUint8Array=b;function C(U){return s(U)==="Uint8ClampedArray"}l.isUint8ClampedArray=C;function f(U){return s(U)==="Uint16Array"}l.isUint16Array=f;function r(U){return s(U)==="Uint32Array"}l.isUint32Array=r;function i(U){return s(U)==="Int8Array"}l.isInt8Array=i;function _(U){return s(U)==="Int16Array"}l.isInt16Array=_;function S(U){return s(U)==="Int32Array"}l.isInt32Array=S;function p(U){return s(U)==="Float32Array"}l.isFloat32Array=p;function I(U){return s(U)==="Float64Array"}l.isFloat64Array=I;function D(U){return s(U)==="BigInt64Array"}l.isBigInt64Array=D;function E(U){return s(U)==="BigUint64Array"}l.isBigUint64Array=E;function T(U){return u(U)==="[object Map]"}T.working=typeof Map<"u"&&T(new Map);function M(U){return typeof Map>"u"?!1:T.working?T(U):U instanceof Map}l.isMap=M;function g(U){return u(U)==="[object Set]"}g.working=typeof Set<"u"&&g(new Set);function $(U){return typeof Set>"u"?!1:g.working?g(U):U instanceof Set}l.isSet=$;function N(U){return u(U)==="[object WeakMap]"}N.working=typeof WeakMap<"u"&&N(new WeakMap);function R(U){return typeof WeakMap>"u"?!1:N.working?N(U):U instanceof WeakMap}l.isWeakMap=R;function O(U){return u(U)==="[object WeakSet]"}O.working=typeof WeakSet<"u"&&O(new WeakSet);function F(U){return O(U)}l.isWeakSet=F;function B(U){return u(U)==="[object ArrayBuffer]"}B.working=typeof ArrayBuffer<"u"&&B(new ArrayBuffer);function q(U){return typeof ArrayBuffer>"u"?!1:B.working?B(U):U instanceof ArrayBuffer}l.isArrayBuffer=q;function x(U){return u(U)==="[object DataView]"}x.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&x(new DataView(new ArrayBuffer(1),0,1));function j(U){return typeof DataView>"u"?!1:x.working?x(U):U instanceof DataView}l.isDataView=j;var L=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function W(U){return u(U)==="[object SharedArrayBuffer]"}function H(U){return typeof L>"u"?!1:(typeof W.working>"u"&&(W.working=W(new L)),W.working?W(U):U instanceof L)}l.isSharedArrayBuffer=H;function Y(U){return u(U)==="[object AsyncFunction]"}l.isAsyncFunction=Y;function J(U){return u(U)==="[object Map Iterator]"}l.isMapIterator=J;function K(U){return u(U)==="[object Set Iterator]"}l.isSetIterator=K;function z(U){return u(U)==="[object Generator]"}l.isGeneratorObject=z;function Z(U){return u(U)==="[object WebAssembly.Module]"}l.isWebAssemblyCompiledModule=Z;function Q(U){return n(U,P)}l.isNumberObject=Q;function te(U){return n(U,A)}l.isStringObject=te;function ae(U){return n(U,w)}l.isBooleanObject=ae;function le(U){return v&&n(U,c)}l.isBigIntObject=le;function oe(U){return a&&n(U,m)}l.isSymbolObject=oe;function Pe(U){return Q(U)||te(U)||ae(U)||le(U)||oe(U)}l.isBoxedPrimitive=Pe;function De(U){return typeof Uint8Array<"u"&&(q(U)||H(U))}l.isAnyArrayBuffer=De,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(U){Object.defineProperty(l,U,{enumerable:!1,value:function(){throw new Error(U+" is not supported in userland")}})})}(St)),St}var Er,ki;function Ia(){return ki||(ki=1,Er=function(y){return y&&typeof y=="object"&&typeof y.copy=="function"&&typeof y.fill=="function"&&typeof y.readUInt8=="function"}),Er}var ut={exports:{}},Oi;function ka(){return Oi||(Oi=1,typeof Object.create=="function"?ut.exports=function(y,o){o&&(y.super_=o,y.prototype=Object.create(o.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}))}:ut.exports=function(y,o){if(o){y.super_=o;var s=function(){};s.prototype=o.prototype,y.prototype=new s,y.prototype.constructor=y}}),ut.exports}var Di;function Ce(){return Di||(Di=1,function(l){var y=Object.getOwnPropertyDescriptors||function(j){for(var L=Object.keys(j),W={},H=0;H<L.length;H++)W[L[H]]=Object.getOwnPropertyDescriptor(j,L[H]);return W},o=/%[sdj%]/g;l.format=function(x){if(!i(x)){for(var j=[],L=0;L<arguments.length;L++)j.push(v(arguments[L]));return j.join(" ")}for(var L=1,W=arguments,H=W.length,Y=String(x).replace(o,function(K){if(K==="%%")return"%";if(L>=H)return K;switch(K){case"%s":return String(W[L++]);case"%d":return Number(W[L++]);case"%j":try{return JSON.stringify(W[L++])}catch{return"[Circular]"}default:return K}}),J=W[L];L<H;J=W[++L])C(J)||!I(J)?Y+=" "+J:Y+=" "+v(J);return Y},l.deprecate=function(x,j){if(typeof process<"u"&&process.noDeprecation===!0)return x;if(typeof process>"u")return function(){return l.deprecate(x,j).apply(this,arguments)};var L=!1;function W(){if(!L){if(process.throwDeprecation)throw new Error(j);process.traceDeprecation?console.trace(j):console.error(j),L=!0}return x.apply(this,arguments)}return W};var s={},d=/^$/;if(process.env.NODE_DEBUG){var h=process.env.NODE_DEBUG;h=h.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),d=new RegExp("^"+h+"$","i")}l.debuglog=function(x){if(x=x.toUpperCase(),!s[x])if(d.test(x)){var j=process.pid;s[x]=function(){var L=l.format.apply(l,arguments);console.error("%s %d: %s",x,j,L)}}else s[x]=function(){};return s[x]};function v(x,j){var L={seen:[],stylize:u};return arguments.length>=3&&(L.depth=arguments[2]),arguments.length>=4&&(L.colors=arguments[3]),b(j)?L.showHidden=j:j&&l._extend(L,j),S(L.showHidden)&&(L.showHidden=!1),S(L.depth)&&(L.depth=2),S(L.colors)&&(L.colors=!1),S(L.customInspect)&&(L.customInspect=!0),L.colors&&(L.stylize=a),A(L,x,L.depth)}l.inspect=v,v.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},v.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function a(x,j){var L=v.styles[j];return L?"\x1B["+v.colors[L][0]+"m"+x+"\x1B["+v.colors[L][1]+"m":x}function u(x,j){return x}function P(x){var j={};return x.forEach(function(L,W){j[L]=!0}),j}function A(x,j,L){if(x.customInspect&&j&&T(j.inspect)&&j.inspect!==l.inspect&&!(j.constructor&&j.constructor.prototype===j)){var W=j.inspect(L,x);return i(W)||(W=A(x,W,L)),W}var H=w(x,j);if(H)return H;var Y=Object.keys(j),J=P(Y);if(x.showHidden&&(Y=Object.getOwnPropertyNames(j)),E(j)&&(Y.indexOf("message")>=0||Y.indexOf("description")>=0))return c(j);if(Y.length===0){if(T(j)){var K=j.name?": "+j.name:"";return x.stylize("[Function"+K+"]","special")}if(p(j))return x.stylize(RegExp.prototype.toString.call(j),"regexp");if(D(j))return x.stylize(Date.prototype.toString.call(j),"date");if(E(j))return c(j)}var z="",Z=!1,Q=["{","}"];if(t(j)&&(Z=!0,Q=["[","]"]),T(j)){var te=j.name?": "+j.name:"";z=" [Function"+te+"]"}if(p(j)&&(z=" "+RegExp.prototype.toString.call(j)),D(j)&&(z=" "+Date.prototype.toUTCString.call(j)),E(j)&&(z=" "+c(j)),Y.length===0&&(!Z||j.length==0))return Q[0]+z+Q[1];if(L<0)return p(j)?x.stylize(RegExp.prototype.toString.call(j),"regexp"):x.stylize("[Object]","special");x.seen.push(j);var ae;return Z?ae=m(x,j,L,J,Y):ae=Y.map(function(le){return n(x,j,L,J,le,Z)}),x.seen.pop(),e(ae,z,Q)}function w(x,j){if(S(j))return x.stylize("undefined","undefined");if(i(j)){var L="'"+JSON.stringify(j).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return x.stylize(L,"string")}if(r(j))return x.stylize(""+j,"number");if(b(j))return x.stylize(""+j,"boolean");if(C(j))return x.stylize("null","null")}function c(x){return"["+Error.prototype.toString.call(x)+"]"}function m(x,j,L,W,H){for(var Y=[],J=0,K=j.length;J<K;++J)O(j,String(J))?Y.push(n(x,j,L,W,String(J),!0)):Y.push("");return H.forEach(function(z){z.match(/^\d+$/)||Y.push(n(x,j,L,W,z,!0))}),Y}function n(x,j,L,W,H,Y){var J,K,z;if(z=Object.getOwnPropertyDescriptor(j,H)||{value:j[H]},z.get?z.set?K=x.stylize("[Getter/Setter]","special"):K=x.stylize("[Getter]","special"):z.set&&(K=x.stylize("[Setter]","special")),O(W,H)||(J="["+H+"]"),K||(x.seen.indexOf(z.value)<0?(C(L)?K=A(x,z.value,null):K=A(x,z.value,L-1),K.indexOf(`
`)>-1&&(Y?K=K.split(`
`).map(function(Z){return"  "+Z}).join(`
`).slice(2):K=`
`+K.split(`
`).map(function(Z){return"   "+Z}).join(`
`))):K=x.stylize("[Circular]","special")),S(J)){if(Y&&H.match(/^\d+$/))return K;J=JSON.stringify(""+H),J.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(J=J.slice(1,-1),J=x.stylize(J,"name")):(J=J.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),J=x.stylize(J,"string"))}return J+": "+K}function e(x,j,L){var W=x.reduce(function(H,Y){return Y.indexOf(`
`)>=0,H+Y.replace(/\u001b\[\d\d?m/g,"").length+1},0);return W>60?L[0]+(j===""?"":j+`
 `)+" "+x.join(`,
  `)+" "+L[1]:L[0]+j+" "+x.join(", ")+" "+L[1]}l.types=Ra();function t(x){return Array.isArray(x)}l.isArray=t;function b(x){return typeof x=="boolean"}l.isBoolean=b;function C(x){return x===null}l.isNull=C;function f(x){return x==null}l.isNullOrUndefined=f;function r(x){return typeof x=="number"}l.isNumber=r;function i(x){return typeof x=="string"}l.isString=i;function _(x){return typeof x=="symbol"}l.isSymbol=_;function S(x){return x===void 0}l.isUndefined=S;function p(x){return I(x)&&g(x)==="[object RegExp]"}l.isRegExp=p,l.types.isRegExp=p;function I(x){return typeof x=="object"&&x!==null}l.isObject=I;function D(x){return I(x)&&g(x)==="[object Date]"}l.isDate=D,l.types.isDate=D;function E(x){return I(x)&&(g(x)==="[object Error]"||x instanceof Error)}l.isError=E,l.types.isNativeError=E;function T(x){return typeof x=="function"}l.isFunction=T;function M(x){return x===null||typeof x=="boolean"||typeof x=="number"||typeof x=="string"||typeof x=="symbol"||typeof x>"u"}l.isPrimitive=M,l.isBuffer=Ia();function g(x){return Object.prototype.toString.call(x)}function $(x){return x<10?"0"+x.toString(10):x.toString(10)}var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function R(){var x=new Date,j=[$(x.getHours()),$(x.getMinutes()),$(x.getSeconds())].join(":");return[x.getDate(),N[x.getMonth()],j].join(" ")}l.log=function(){console.log("%s - %s",R(),l.format.apply(l,arguments))},l.inherits=ka(),l._extend=function(x,j){if(!j||!I(j))return x;for(var L=Object.keys(j),W=L.length;W--;)x[L[W]]=j[L[W]];return x};function O(x,j){return Object.prototype.hasOwnProperty.call(x,j)}var F=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;l.promisify=function(j){if(typeof j!="function")throw new TypeError('The "original" argument must be of type Function');if(F&&j[F]){var L=j[F];if(typeof L!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(L,F,{value:L,enumerable:!1,writable:!1,configurable:!0}),L}function L(){for(var W,H,Y=new Promise(function(z,Z){W=z,H=Z}),J=[],K=0;K<arguments.length;K++)J.push(arguments[K]);J.push(function(z,Z){z?H(z):W(Z)});try{j.apply(this,J)}catch(z){H(z)}return Y}return Object.setPrototypeOf(L,Object.getPrototypeOf(j)),F&&Object.defineProperty(L,F,{value:L,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(L,y(j))},l.promisify.custom=F;function B(x,j){if(!x){var L=new Error("Promise was rejected with a falsy value");L.reason=x,x=L}return j(x)}function q(x){if(typeof x!="function")throw new TypeError('The "original" argument must be of type Function');function j(){for(var L=[],W=0;W<arguments.length;W++)L.push(arguments[W]);var H=L.pop();if(typeof H!="function")throw new TypeError("The last argument must be of type Function");var Y=this,J=function(){return H.apply(Y,arguments)};x.apply(this,L).then(function(K){process.nextTick(J.bind(null,null,K))},function(K){process.nextTick(B.bind(null,K,J))})}return Object.setPrototypeOf(j,Object.getPrototypeOf(x)),Object.defineProperties(j,y(x)),j}l.callbackify=q}(bt)),bt}var Cr,xi;function Oa(){if(xi)return Cr;xi=1;var l=me().EventEmitter,y=Yo(),o=Ce();function s(h,v,a){if(!(this instanceof s))return new s(h,v,a);a=Object.assign({defaultPayload:function(){return{}},host:"eventgw.twilio.com"},a);var u=a.defaultPayload;typeof u!="function"&&(u=function(){return Object.assign({},a.defaultPayload)});var P=!0,A=Object.assign({app_name:void 0,app_version:void 0},a.metadata);Object.defineProperties(this,{_defaultPayload:{value:u},_isEnabled:{get:function(){return P},set:function(c){P=c}},_host:{value:a.host},_request:{value:a.request||y,writable:!0},_token:{value:v,writable:!0},isEnabled:{enumerable:!0,get:function(){return P}},metadata:{enumerable:!0,get:function(){return A}},productName:{enumerable:!0,value:h},token:{enumerable:!0,get:function(){return this._token}}})}o.inherits(s,l),s.prototype._post=function(v,a,u,P,A,w,c){var m=this;if(!this.isEnabled&&!c||!w||(!w.parameters||!w.parameters.CallSid)&&!w.outboundConnectionId)return Promise.resolve();var n={publisher:this.productName,group:u,name:P,timestamp:new Date().toISOString(),level:a.toUpperCase(),payload_type:"application/json",private:!1,payload:A&&A.forEach?A.slice(0):Object.assign(this._defaultPayload(w),A)};this.metadata&&(n.publisher_metadata=this.metadata);var e={url:"https://"+this._host+"/v4/"+v,body:n,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token}},t=this;return new Promise(function(b,C){t._request.post(e,function(f){f?(m.emit("error",f),C(f)):b()})})},s.prototype.post=function(v,a,u,P,A,w){return this._post("EndpointEvents",v,a,u,P,A,w)},s.prototype.debug=function(v,a,u,P){return this.post("debug",v,a,u,P)},s.prototype.info=function(v,a,u,P){return this.post("info",v,a,u,P)},s.prototype.warn=function(v,a,u,P){return this.post("warning",v,a,u,P)},s.prototype.error=function(v,a,u,P){return this.post("error",v,a,u,P)},s.prototype.postMetrics=function(v,a,u,P,A){var w=this;return new Promise(function(c){var m=u.map(d).map(function(n){return Object.assign(n,P)});c(w._post("EndpointMetrics","info",v,a,m,A))})},s.prototype.setToken=function(v){this._token=v},s.prototype.enable=function(){this._isEnabled=!0},s.prototype.disable=function(){this._isEnabled=!1};function d(h){return{timestamp:new Date(h.timestamp).toISOString(),total_packets_received:h.totals.packetsReceived,total_packets_lost:h.totals.packetsLost,total_packets_sent:h.totals.packetsSent,total_bytes_received:h.totals.bytesReceived,total_bytes_sent:h.totals.bytesSent,packets_received:h.packetsReceived,packets_lost:h.packetsLost,packets_lost_fraction:h.packetsLostFraction&&Math.round(h.packetsLostFraction*100)/100,bytes_received:h.bytesReceived,bytes_sent:h.bytesSent,audio_codec:h.codecName,audio_level_in:h.audioInputLevel,audio_level_out:h.audioOutputLevel,call_volume_input:h.inputVolume,call_volume_output:h.outputVolume,jitter:h.jitter,rtt:h.rtt,mos:h.mos&&Math.round(h.mos*100)/100}}return Cr=s,Cr}var Ze={},Tr,ji;function Da(){return ji||(ji=1,Tr=WebSocket),Tr}var Te={},ye={exports:{}},ct={},Mi;function xa(){if(Mi)return ct;Mi=1;var l=Ce();function y(s){Error.call(this,s),this.message=s}l.inherits(y,Error),y.prototype.name="IllegalArgumentError";function o(s){Error.call(this,s),this.message=s}return l.inherits(o,Error),o.prototype.name="IllegalStateError",ct.IllegalStateError=o,ct.IllegalArgumentError=y,ct}var Li;function ja(){if(Li)return ye.exports;Li=1;var l=Ce(),y=ye.exports=xa();function o(a,u,P,A){P=P||"";var w=l.format.apply(this,[P].concat(A)),c=new a(w);throw Error.captureStackTrace(c,u),c}function s(a,u,P){o(y.IllegalArgumentError,a,u,P)}function d(a,u,P){o(y.IllegalStateError,a,u,P)}ye.exports.checkArgument=function(a,u){a||s(arguments.callee,u,Array.prototype.slice.call(arguments,2))},ye.exports.checkState=function(a,u){a||d(arguments.callee,u,Array.prototype.slice.call(arguments,2))},ye.exports.checkIsDef=function(a,u){if(a!==void 0)return a;s(arguments.callee,u||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},ye.exports.checkIsDefAndNotNull=function(a,u){if(a!=null)return a;s(arguments.callee,u||'Expected value to be defined and not null but got "'+h(a)+'".',Array.prototype.slice.call(arguments,2))};function h(a){var u=typeof a;if(u=="object")if(a){if(a instanceof Array)return"array"}else return"null";return u}function v(a){return function(u,P){var A=h(u);if(A==a)return u;s(arguments.callee,P||'Expected "'+a+'" but got "'+A+'".',Array.prototype.slice.call(arguments,2))}}return ye.exports.checkIsString=v("string"),ye.exports.checkIsArray=v("array"),ye.exports.checkIsNumber=v("number"),ye.exports.checkIsBoolean=v("boolean"),ye.exports.checkIsFunction=v("function"),ye.exports.checkIsObject=v("object"),ye.exports}var Pr,Fi;function Ar(){return Fi||(Fi=1,Pr=ja()),Pr}var Rr,Ni;function Ui(){if(Ni)return Rr;Ni=1;var l=me(),y=Ar(),o=Ce();function s(d){l.EventEmitter.call(this),this.backoffStrategy_=d,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}return o.inherits(s,l.EventEmitter),s.prototype.failAfter=function(d){y.checkArgument(d>0,"Expected a maximum number of retry greater than 0 but got %s.",d),this.maxNumberOfRetry_=d},s.prototype.backoff=function(d){y.checkState(this.timeoutID_===-1,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",d),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,d))},s.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},s.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1},Rr=s,Rr}var Ir,qi;function Bi(){if(qi)return Ir;qi=1,me(),Ce();function l(o){return o!=null}function y(o){if(o=o||{},l(o.initialDelay)&&o.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(l(o.maxDelay)&&o.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=o.initialDelay||100,this.maxDelay_=o.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(l(o.randomisationFactor)&&(o.randomisationFactor<0||o.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=o.randomisationFactor||0}return y.prototype.getMaxDelay=function(){return this.maxDelay_},y.prototype.getInitialDelay=function(){return this.initialDelay_},y.prototype.next=function(){var o=this.next_(),s=1+Math.random()*this.randomisationFactor_,d=Math.round(o*s);return d},y.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},y.prototype.reset=function(){this.reset_()},y.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")},Ir=y,Ir}var kr,Gi;function Ma(){if(Gi)return kr;Gi=1;var l=Ce(),y=Ar(),o=Bi();function s(d){o.call(this,d),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=s.DEFAULT_FACTOR,d&&d.factor!==void 0&&(y.checkArgument(d.factor>1,"Exponential factor should be greater than 1 but got %s.",d.factor),this.factor_=d.factor)}return l.inherits(s,o),s.DEFAULT_FACTOR=2,s.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},s.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()},kr=s,kr}var Or,Wi;function Vi(){if(Wi)return Or;Wi=1;var l=Ce(),y=Bi();function o(s){y.call(this,s),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}return l.inherits(o,y),o.prototype.next_=function(){var s=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=s,s},o.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0},Or=o,Or}var Dr,Hi;function La(){if(Hi)return Dr;Hi=1;var l=me(),y=Ar(),o=Ce(),s=Ui(),d=Vi();function h(v,a,u){l.EventEmitter.call(this),y.checkIsFunction(v,"Expected fn to be a function."),y.checkIsArray(a,"Expected args to be an array."),y.checkIsFunction(u,"Expected callback to be a function."),this.function_=v,this.arguments_=a,this.callback_=u,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=h.DEFAULT_RETRY_PREDICATE_,this.state_=h.State_.PENDING}return o.inherits(h,l.EventEmitter),h.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},h.DEFAULT_RETRY_PREDICATE_=function(v){return!0},h.prototype.isPending=function(){return this.state_==h.State_.PENDING},h.prototype.isRunning=function(){return this.state_==h.State_.RUNNING},h.prototype.isCompleted=function(){return this.state_==h.State_.COMPLETED},h.prototype.isAborted=function(){return this.state_==h.State_.ABORTED},h.prototype.setStrategy=function(v){return y.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=v,this},h.prototype.retryIf=function(v){return y.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=v,this},h.prototype.getLastResult=function(){return this.lastResult_.concat()},h.prototype.getNumRetries=function(){return this.numRetries_},h.prototype.failAfter=function(v){return y.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=v,this},h.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=h.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},h.prototype.start=function(v){y.checkState(!this.isAborted(),"FunctionCall is aborted."),y.checkState(this.isPending(),"FunctionCall already started.");var a=this.strategy_||new d;this.backoff_=v?v(a):new s(a),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=h.State_.RUNNING,this.doCall_(!1)},h.prototype.doCall_=function(v){v&&this.numRetries_++;var a=["call"].concat(this.arguments_);l.EventEmitter.prototype.emit.apply(this,a);var u=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(u))},h.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},h.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var v=Array.prototype.slice.call(arguments);this.lastResult_=v,l.EventEmitter.prototype.emit.apply(this,["callback"].concat(v));var a=v[0];a&&this.retryPredicate_(a)?this.backoff_.backoff(a):(this.state_=h.State_.COMPLETED,this.doCallback_())}},h.prototype.handleBackoff_=function(v,a,u){this.emit("backoff",v,a,u)},Dr=h,Dr}var zi;function $i(){if(zi)return Te;zi=1;var l=Ui(),y=Ma(),o=Vi(),s=La();return Te.Backoff=l,Te.FunctionCall=s,Te.FibonacciStrategy=o,Te.ExponentialStrategy=y,Te.fibonacci=function(d){return new l(new o(d))},Te.exponential=function(d){return new l(new y(d))},Te.call=function(d,h,v){var a=Array.prototype.slice.call(arguments);return d=a[0],h=a.slice(1,a.length-1),v=a[a.length-1],new s(d,h,v)},Te}var Ji;function Fa(){return Ji||(Ji=1,function(l){var y=Ze&&Ze.__extends||function(){var c=function(m,n){return c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var b in t)t.hasOwnProperty(b)&&(e[b]=t[b])},c(m,n)};return function(m,n){c(m,n);function e(){this.constructor=m}m.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}}();Object.defineProperty(l,"__esModule",{value:!0});var o=me(),s=Da(),d=he(),h=Me(),v=$i(),a=1e4,u=5e3,P=15e3,A;(function(c){c.Connecting="connecting",c.Closed="closed",c.Open="open"})(A=l.WSTransportState||(l.WSTransportState={}));var w=function(c){y(m,c);function m(n,e){e===void 0&&(e={});var t=c.call(this)||this;t.state=A.Closed,t._log=h.default.getInstance(),t._shouldFallback=!1,t._uriIndex=0,t._moveUriIndex=function(){t._uriIndex++,t._uriIndex>=t._uris.length&&(t._uriIndex=0)},t._onSocketClose=function(f){if(t._log.info("Received websocket close event code: "+f.code+". Reason: "+f.reason),f.code===1006||f.code===1015){t.emit("error",{code:31005,message:f.reason||"Websocket connection to Twilio's signaling servers were unexpectedly ended. If this is happening consistently, there may be an issue resolving the hostname provided. If a region or an edge is being specified in Device setup, ensure it is valid.",twilioError:new d.SignalingErrors.ConnectionError});var r=t.state===A.Open||t._previousState===A.Open;(t._shouldFallback||!r)&&t._moveUriIndex(),t._shouldFallback=!0}t._closeSocket()},t._onSocketError=function(f){t._log.info("WebSocket received error: "+f.message),t.emit("error",{code:31e3,message:f.message||"WSTransport socket error",twilioError:new d.SignalingErrors.ConnectionDisconnected})},t._onSocketMessage=function(f){if(t._setHeartbeatTimeout(),t._socket&&f.data===`
`){t._socket.send(`
`);return}t.emit("message",f)},t._onSocketOpen=function(){t._log.info("WebSocket opened successfully."),t._timeOpened=Date.now(),t._shouldFallback=!1,t._setState(A.Open),clearTimeout(t._connectTimeout),t._setHeartbeatTimeout(),t.emit("open")},t._connectTimeoutMs=e.connectTimeoutMs||u;var b=100;n&&n.length>1&&(b=Math.floor(Math.random()*4001)+1e3);var C={factor:2,initialDelay:b,maxDelay:typeof e.backoffMaxMs=="number"?Math.max(e.backoffMaxMs,3e3):2e4,randomisationFactor:.4};return t._log.info("Initializing transport backoff using config: ",C),t._backoff=v.exponential(C),t._uris=n,t._WebSocket=e.WebSocket||s,t._backoff.on("backoff",function(f,r){t.state!==A.Closed&&t._log.info("Will attempt to reconnect WebSocket in "+r+"ms")}),t._backoff.on("ready",function(f){t.state!==A.Closed&&t._connect(f+1)}),t}return m.prototype.close=function(){this._log.info("WSTransport.close() called..."),this._close()},m.prototype.open=function(){if(this._log.info("WSTransport.open() called..."),this._socket&&(this._socket.readyState===s.CONNECTING||this._socket.readyState===s.OPEN)){this._log.info("WebSocket already open.");return}this._connect()},m.prototype.send=function(n){if(!this._socket||this._socket.readyState!==s.OPEN)return!1;try{this._socket.send(n)}catch(e){return this._log.info("Error while sending message:",e.message),this._closeSocket(),!1}return!0},m.prototype._close=function(){this._setState(A.Closed),this._closeSocket()},m.prototype._closeSocket=function(){if(clearTimeout(this._connectTimeout),clearTimeout(this._heartbeatTimeout),this._log.info("Closing and cleaning up WebSocket..."),!this._socket){this._log.info("No WebSocket to clean up.");return}this._socket.removeEventListener("close",this._onSocketClose),this._socket.removeEventListener("error",this._onSocketError),this._socket.removeEventListener("message",this._onSocketMessage),this._socket.removeEventListener("open",this._onSocketOpen),(this._socket.readyState===s.CONNECTING||this._socket.readyState===s.OPEN)&&this._socket.close(),this._timeOpened&&Date.now()-this._timeOpened>a&&this._backoff.reset(),this._backoff.backoff(),delete this._socket,this.emit("close")},m.prototype._connect=function(n){var e=this;n?this._log.info("Attempting to reconnect (retry #"+n+")..."):this._log.info("Attempting to connect..."),this._closeSocket(),this._setState(A.Connecting);var t=null;try{t=new this._WebSocket(this._uris[this._uriIndex])}catch(b){this._log.info("Could not connect to endpoint:",b.message),this._close(),this.emit("error",{code:31e3,message:b.message||"Could not connect to "+this._uris[this._uriIndex],twilioError:new d.SignalingErrors.ConnectionDisconnected});return}delete this._timeOpened,this._connectTimeout=setTimeout(function(){e._log.info("WebSocket connection attempt timed out."),e._moveUriIndex(),e._closeSocket()},this._connectTimeoutMs),t.addEventListener("close",this._onSocketClose),t.addEventListener("error",this._onSocketError),t.addEventListener("message",this._onSocketMessage),t.addEventListener("open",this._onSocketOpen),this._socket=t},m.prototype._setHeartbeatTimeout=function(){var n=this;clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=setTimeout(function(){n._log.info("No messages received in "+P/1e3+" seconds. Reconnecting..."),n._shouldFallback=!0,n._closeSocket()},P)},m.prototype._setState=function(n){this._previousState=this.state,this.state=n},Object.defineProperty(m.prototype,"uri",{get:function(){return this._uris[this._uriIndex]},enumerable:!0,configurable:!0}),m}(o.EventEmitter);l.default=w}(Ze)),Ze}var xr,Yi;function Ki(){if(Yi)return xr;Yi=1;function l(c){if(Array.isArray(c)){for(var m=0,n=Array(c.length);m<c.length;m++)n[m]=c[m];return n}else return Array.from(c)}var y=Ue(),o=me().EventEmitter,s=Me().default,d=Ce(),h=Fa().default,v=he(),a=v.GeneralErrors,u=v.SignalingErrors,P="1.5";function A(c,m,n){if(!(this instanceof A))return new A(c,m,n);var e={TransportFactory:h};n=n||{};for(var t in e)t in n||(n[t]=e[t]);this.options=n,this.token=c||"",this.status="disconnected",this.gateway=null,this.region=null,this._messageQueue=[],this._uris=m,this._handleTransportClose=this._handleTransportClose.bind(this),this._handleTransportError=this._handleTransportError.bind(this),this._handleTransportMessage=this._handleTransportMessage.bind(this),this._handleTransportOpen=this._handleTransportOpen.bind(this),this._log=s.getInstance(),this.on("error",function(){});var b=this;return this.addListener("ready",function(){b.status="ready"}),this.addListener("offline",function(){b.status="offline"}),this.addListener("close",function(){b._log.info('Received "close" from server. Destroying PStream...'),b._destroy()}),this.transport=new this.options.TransportFactory(this._uris,{backoffMaxMs:this.options.backoffMaxMs}),Object.defineProperties(this,{uri:{enumerable:!0,get:function(){return this.transport.uri}}}),this.transport.on("close",this._handleTransportClose),this.transport.on("error",this._handleTransportError),this.transport.on("message",this._handleTransportMessage),this.transport.on("open",this._handleTransportOpen),this.transport.open(),this}d.inherits(A,o),A.prototype._handleTransportClose=function(){this.emit("transportClose"),this.status!=="disconnected"&&(this.status!=="offline"&&this.emit("offline",this),this.status="disconnected")},A.prototype._handleTransportError=function(c){if(!c){this.emit("error",{error:{code:31e3,message:"Websocket closed without a provided reason",twilioError:new u.ConnectionDisconnected}});return}this.emit("error",typeof c.code<"u"?{error:c}:c)},A.prototype._handleTransportMessage=function(c){if(!(!c||!c.data||typeof c.data!="string")){var m=JSON.parse(c.data),n=m.type,e=m.payload,t=e===void 0?{}:e;this.gateway=t.gateway||this.gateway,this.region=t.region||this.region,n==="error"&&t.error&&(t.error.twilioError=new u.ConnectionError),this.emit(n,t)}},A.prototype._handleTransportOpen=function(){var c=this;this.status="connected",this.setToken(this.token);var m=this._messageQueue.splice(0,this._messageQueue.length);m.forEach(function(n){return c._publish.apply(c,l(n))})},A.toString=function(){return"[Twilio.PStream class]"},A.prototype.toString=function(){return"[Twilio.PStream instance]"},A.prototype.setToken=function(c){this._log.info("Setting token and publishing listen"),this.token=c;var m={token:c,browserinfo:w()};this._publish("listen",m)},A.prototype.register=function(c){var m={media:c};this._publish("register",m,!0)},A.prototype.invite=function(c,m,n,e){var t={callsid:m,sdp:c,preflight:!!n,twilio:e?{params:e}:{}};this._publish("invite",t,!0)},A.prototype.answer=function(c,m){this._publish("answer",{sdp:c,callsid:m},!0)},A.prototype.dtmf=function(c,m){this._publish("dtmf",{callsid:c,dtmf:m},!0)},A.prototype.hangup=function(c,m){var n=m?{callsid:c,message:m}:{callsid:c};this._publish("hangup",n,!0)},A.prototype.reject=function(c){this._publish("reject",{callsid:c},!0)},A.prototype.reinvite=function(c,m){this._publish("reinvite",{sdp:c,callsid:m},!1)},A.prototype._destroy=function(){this.transport.removeListener("close",this._handleTransportClose),this.transport.removeListener("error",this._handleTransportError),this.transport.removeListener("message",this._handleTransportMessage),this.transport.removeListener("open",this._handleTransportOpen),this.transport.close(),this.emit("offline",this)},A.prototype.destroy=function(){return this._log.info("PStream.destroy() called..."),this._destroy(),this},A.prototype.publish=function(c,m){return this._publish(c,m,!0)},A.prototype._publish=function(c,m,n){var e=JSON.stringify({type:c,version:P,payload:m}),t=!!this.transport.send(e);t||(this.emit("error",{error:{code:31009,message:"No transport available to send or receive messages",twilioError:new a.TransportError}}),n&&this._messageQueue.push([c,m,!0]))};function w(){var c=typeof navigator<"u"?navigator:{},m={p:"browser",v:y.RELEASE_VERSION,browser:{userAgent:c.userAgent||"unknown",platform:c.platform||"unknown"},plugin:"rtc"};return m}return xr=A,xr}var jr={exports:{}},Xi;function Na(){return Xi||(Xi=1,function(l){var y={};y.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},y.localCName=y.generateIdentifier(),y.splitLines=function(o){return o.trim().split(`
`).map(function(s){return s.trim()})},y.splitSections=function(o){var s=o.split(`
m=`);return s.map(function(d,h){return(h>0?"m="+d:d).trim()+`\r
`})},y.getDescription=function(o){var s=y.splitSections(o);return s&&s[0]},y.getMediaSections=function(o){var s=y.splitSections(o);return s.shift(),s},y.matchPrefix=function(o,s){return y.splitLines(o).filter(function(d){return d.indexOf(s)===0})},y.parseCandidate=function(o){var s;o.indexOf("a=candidate:")===0?s=o.substring(12).split(" "):s=o.substring(10).split(" ");for(var d={foundation:s[0],component:parseInt(s[1],10),protocol:s[2].toLowerCase(),priority:parseInt(s[3],10),ip:s[4],address:s[4],port:parseInt(s[5],10),type:s[7]},h=8;h<s.length;h+=2)switch(s[h]){case"raddr":d.relatedAddress=s[h+1];break;case"rport":d.relatedPort=parseInt(s[h+1],10);break;case"tcptype":d.tcpType=s[h+1];break;case"ufrag":d.ufrag=s[h+1],d.usernameFragment=s[h+1];break;default:d[s[h]]=s[h+1];break}return d},y.writeCandidate=function(o){var s=[];s.push(o.foundation),s.push(o.component),s.push(o.protocol.toUpperCase()),s.push(o.priority),s.push(o.address||o.ip),s.push(o.port);var d=o.type;return s.push("typ"),s.push(d),d!=="host"&&o.relatedAddress&&o.relatedPort&&(s.push("raddr"),s.push(o.relatedAddress),s.push("rport"),s.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(s.push("tcptype"),s.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(s.push("ufrag"),s.push(o.usernameFragment||o.ufrag)),"candidate:"+s.join(" ")},y.parseIceOptions=function(o){return o.substr(14).split(" ")},y.parseRtpMap=function(o){var s=o.substr(9).split(" "),d={payloadType:parseInt(s.shift(),10)};return s=s[0].split("/"),d.name=s[0],d.clockRate=parseInt(s[1],10),d.channels=s.length===3?parseInt(s[2],10):1,d.numChannels=d.channels,d},y.writeRtpMap=function(o){var s=o.payloadType;o.preferredPayloadType!==void 0&&(s=o.preferredPayloadType);var d=o.channels||o.numChannels||1;return"a=rtpmap:"+s+" "+o.name+"/"+o.clockRate+(d!==1?"/"+d:"")+`\r
`},y.parseExtmap=function(o){var s=o.substr(9).split(" ");return{id:parseInt(s[0],10),direction:s[0].indexOf("/")>0?s[0].split("/")[1]:"sendrecv",uri:s[1]}},y.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+`\r
`},y.parseFmtp=function(o){for(var s={},d,h=o.substr(o.indexOf(" ")+1).split(";"),v=0;v<h.length;v++)d=h[v].trim().split("="),s[d[0].trim()]=d[1];return s},y.writeFmtp=function(o){var s="",d=o.payloadType;if(o.preferredPayloadType!==void 0&&(d=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){var h=[];Object.keys(o.parameters).forEach(function(v){o.parameters[v]?h.push(v+"="+o.parameters[v]):h.push(v)}),s+="a=fmtp:"+d+" "+h.join(";")+`\r
`}return s},y.parseRtcpFb=function(o){var s=o.substr(o.indexOf(" ")+1).split(" ");return{type:s.shift(),parameter:s.join(" ")}},y.writeRtcpFb=function(o){var s="",d=o.payloadType;return o.preferredPayloadType!==void 0&&(d=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(function(h){s+="a=rtcp-fb:"+d+" "+h.type+(h.parameter&&h.parameter.length?" "+h.parameter:"")+`\r
`}),s},y.parseSsrcMedia=function(o){var s=o.indexOf(" "),d={ssrc:parseInt(o.substr(7,s-7),10)},h=o.indexOf(":",s);return h>-1?(d.attribute=o.substr(s+1,h-s-1),d.value=o.substr(h+1)):d.attribute=o.substr(s+1),d},y.parseSsrcGroup=function(o){var s=o.substr(13).split(" ");return{semantics:s.shift(),ssrcs:s.map(function(d){return parseInt(d,10)})}},y.getMid=function(o){var s=y.matchPrefix(o,"a=mid:")[0];if(s)return s.substr(6)},y.parseFingerprint=function(o){var s=o.substr(14).split(" ");return{algorithm:s[0].toLowerCase(),value:s[1]}},y.getDtlsParameters=function(o,s){var d=y.matchPrefix(o+s,"a=fingerprint:");return{role:"auto",fingerprints:d.map(y.parseFingerprint)}},y.writeDtlsParameters=function(o,s){var d="a=setup:"+s+`\r
`;return o.fingerprints.forEach(function(h){d+="a=fingerprint:"+h.algorithm+" "+h.value+`\r
`}),d},y.parseCryptoLine=function(o){var s=o.substr(9).split(" ");return{tag:parseInt(s[0],10),cryptoSuite:s[1],keyParams:s[2],sessionParams:s.slice(3)}},y.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?y.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},y.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;var s=o.substr(7).split("|");return{keyMethod:"inline",keySalt:s[0],lifeTime:s[1],mkiValue:s[2]?s[2].split(":")[0]:void 0,mkiLength:s[2]?s[2].split(":")[1]:void 0}},y.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},y.getCryptoParameters=function(o,s){var d=y.matchPrefix(o+s,"a=crypto:");return d.map(y.parseCryptoLine)},y.getIceParameters=function(o,s){var d=y.matchPrefix(o+s,"a=ice-ufrag:")[0],h=y.matchPrefix(o+s,"a=ice-pwd:")[0];return d&&h?{usernameFragment:d.substr(12),password:h.substr(10)}:null},y.writeIceParameters=function(o){return"a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`},y.parseRtpParameters=function(o){for(var s={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},d=y.splitLines(o),h=d[0].split(" "),v=3;v<h.length;v++){var a=h[v],u=y.matchPrefix(o,"a=rtpmap:"+a+" ")[0];if(u){var P=y.parseRtpMap(u),A=y.matchPrefix(o,"a=fmtp:"+a+" ");switch(P.parameters=A.length?y.parseFmtp(A[0]):{},P.rtcpFeedback=y.matchPrefix(o,"a=rtcp-fb:"+a+" ").map(y.parseRtcpFb),s.codecs.push(P),P.name.toUpperCase()){case"RED":case"ULPFEC":s.fecMechanisms.push(P.name.toUpperCase());break}}}return y.matchPrefix(o,"a=extmap:").forEach(function(w){s.headerExtensions.push(y.parseExtmap(w))}),s},y.writeRtpDescription=function(o,s){var d="";d+="m="+o+" ",d+=s.codecs.length>0?"9":"0",d+=" UDP/TLS/RTP/SAVPF ",d+=s.codecs.map(function(v){return v.preferredPayloadType!==void 0?v.preferredPayloadType:v.payloadType}).join(" ")+`\r
`,d+=`c=IN IP4 0.0.0.0\r
`,d+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,s.codecs.forEach(function(v){d+=y.writeRtpMap(v),d+=y.writeFmtp(v),d+=y.writeRtcpFb(v)});var h=0;return s.codecs.forEach(function(v){v.maxptime>h&&(h=v.maxptime)}),h>0&&(d+="a=maxptime:"+h+`\r
`),d+=`a=rtcp-mux\r
`,s.headerExtensions&&s.headerExtensions.forEach(function(v){d+=y.writeExtmap(v)}),d},y.parseRtpEncodingParameters=function(o){var s=[],d=y.parseRtpParameters(o),h=d.fecMechanisms.indexOf("RED")!==-1,v=d.fecMechanisms.indexOf("ULPFEC")!==-1,a=y.matchPrefix(o,"a=ssrc:").map(function(c){return y.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"}),u=a.length>0&&a[0].ssrc,P,A=y.matchPrefix(o,"a=ssrc-group:FID").map(function(c){var m=c.substr(17).split(" ");return m.map(function(n){return parseInt(n,10)})});A.length>0&&A[0].length>1&&A[0][0]===u&&(P=A[0][1]),d.codecs.forEach(function(c){if(c.name.toUpperCase()==="RTX"&&c.parameters.apt){var m={ssrc:u,codecPayloadType:parseInt(c.parameters.apt,10)};u&&P&&(m.rtx={ssrc:P}),s.push(m),h&&(m=JSON.parse(JSON.stringify(m)),m.fec={ssrc:u,mechanism:v?"red+ulpfec":"red"},s.push(m))}}),s.length===0&&u&&s.push({ssrc:u});var w=y.matchPrefix(o,"b=");return w.length&&(w[0].indexOf("b=TIAS:")===0?w=parseInt(w[0].substr(7),10):w[0].indexOf("b=AS:")===0?w=parseInt(w[0].substr(5),10)*1e3*.95-50*40*8:w=void 0,s.forEach(function(c){c.maxBitrate=w})),s},y.parseRtcpParameters=function(o){var s={},d=y.matchPrefix(o,"a=ssrc:").map(function(a){return y.parseSsrcMedia(a)}).filter(function(a){return a.attribute==="cname"})[0];d&&(s.cname=d.value,s.ssrc=d.ssrc);var h=y.matchPrefix(o,"a=rtcp-rsize");s.reducedSize=h.length>0,s.compound=h.length===0;var v=y.matchPrefix(o,"a=rtcp-mux");return s.mux=v.length>0,s},y.parseMsid=function(o){var s,d=y.matchPrefix(o,"a=msid:");if(d.length===1)return s=d[0].substr(7).split(" "),{stream:s[0],track:s[1]};var h=y.matchPrefix(o,"a=ssrc:").map(function(v){return y.parseSsrcMedia(v)}).filter(function(v){return v.attribute==="msid"});if(h.length>0)return s=h[0].value.split(" "),{stream:s[0],track:s[1]}},y.parseSctpDescription=function(o){var s=y.parseMLine(o),d=y.matchPrefix(o,"a=max-message-size:"),h;d.length>0&&(h=parseInt(d[0].substr(19),10)),isNaN(h)&&(h=65536);var v=y.matchPrefix(o,"a=sctp-port:");if(v.length>0)return{port:parseInt(v[0].substr(12),10),protocol:s.fmt,maxMessageSize:h};var a=y.matchPrefix(o,"a=sctpmap:");if(a.length>0){var u=y.matchPrefix(o,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(u[0],10),protocol:u[1],maxMessageSize:h}}},y.writeSctpDescription=function(o,s){var d=[];return o.protocol!=="DTLS/SCTP"?d=["m="+o.kind+" 9 "+o.protocol+" "+s.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+s.port+`\r
`]:d=["m="+o.kind+" 9 "+o.protocol+" "+s.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+s.port+" "+s.protocol+` 65535\r
`],s.maxMessageSize!==void 0&&d.push("a=max-message-size:"+s.maxMessageSize+`\r
`),d.join("")},y.generateSessionId=function(){return Math.random().toString().substr(2,21)},y.writeSessionBoilerplate=function(o,s,d){var h,v=s!==void 0?s:2;o?h=o:h=y.generateSessionId();var a=d||"thisisadapterortc";return`v=0\r
o=`+a+" "+h+" "+v+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},y.writeMediaSection=function(o,s,d,h){var v=y.writeRtpDescription(o.kind,s);if(v+=y.writeIceParameters(o.iceGatherer.getLocalParameters()),v+=y.writeDtlsParameters(o.dtlsTransport.getLocalParameters(),d==="offer"?"actpass":"active"),v+="a=mid:"+o.mid+`\r
`,o.direction?v+="a="+o.direction+`\r
`:o.rtpSender&&o.rtpReceiver?v+=`a=sendrecv\r
`:o.rtpSender?v+=`a=sendonly\r
`:o.rtpReceiver?v+=`a=recvonly\r
`:v+=`a=inactive\r
`,o.rtpSender){var a="msid:"+h.id+" "+o.rtpSender.track.id+`\r
`;v+="a="+a,v+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" "+a,o.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" "+a,v+="a=ssrc-group:FID "+o.sendEncodingParameters[0].ssrc+" "+o.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return v+="a=ssrc:"+o.sendEncodingParameters[0].ssrc+" cname:"+y.localCName+`\r
`,o.rtpSender&&o.sendEncodingParameters[0].rtx&&(v+="a=ssrc:"+o.sendEncodingParameters[0].rtx.ssrc+" cname:"+y.localCName+`\r
`),v},y.getDirection=function(o,s){for(var d=y.splitLines(o),h=0;h<d.length;h++)switch(d[h]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return d[h].substr(2)}return s?y.getDirection(s):"sendrecv"},y.getKind=function(o){var s=y.splitLines(o),d=s[0].split(" ");return d[0].substr(2)},y.isRejected=function(o){return o.split(" ",2)[1]==="0"},y.parseMLine=function(o){var s=y.splitLines(o),d=s[0].substr(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},y.parseOLine=function(o){var s=y.matchPrefix(o,"o=")[0],d=s.substr(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},y.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;for(var s=y.splitLines(o),d=0;d<s.length;d++)if(s[d].length<2||s[d].charAt(1)!=="=")return!1;return!0},l.exports=y}(jr)),jr.exports}var Mr,Qi;function Ua(){if(Qi)return Mr;Qi=1;var l=Na();function y(a,u,P,A,w){var c=l.writeRtpDescription(a.kind,u);if(c+=l.writeIceParameters(a.iceGatherer.getLocalParameters()),c+=l.writeDtlsParameters(a.dtlsTransport.getLocalParameters(),P==="offer"?"actpass":w||"active"),c+="a=mid:"+a.mid+`\r
`,a.rtpSender&&a.rtpReceiver?c+=`a=sendrecv\r
`:a.rtpSender?c+=`a=sendonly\r
`:a.rtpReceiver?c+=`a=recvonly\r
`:c+=`a=inactive\r
`,a.rtpSender){var m=a.rtpSender._initialTrackId||a.rtpSender.track.id;a.rtpSender._initialTrackId=m;var n="msid:"+(A?A.id:"-")+" "+m+`\r
`;c+="a="+n,c+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" "+n,a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" "+n,c+="a=ssrc-group:FID "+a.sendEncodingParameters[0].ssrc+" "+a.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return c+="a=ssrc:"+a.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+`\r
`,a.rtpSender&&a.sendEncodingParameters[0].rtx&&(c+="a=ssrc:"+a.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+`\r
`),c}function o(a,u){var P=!1;return a=JSON.parse(JSON.stringify(a)),a.filter(function(A){if(A&&(A.urls||A.url)){var w=A.urls||A.url;A.url&&!A.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var c=typeof w=="string";return c&&(w=[w]),w=w.filter(function(m){var n=m.indexOf("turn:")===0&&m.indexOf("transport=udp")!==-1&&m.indexOf("turn:[")===-1&&!P;return n?(P=!0,!0):m.indexOf("stun:")===0&&u>=14393&&m.indexOf("?transport=udp")===-1}),delete A.url,A.urls=c?w[0]:w,!!w.length}})}function s(a,u){var P={codecs:[],headerExtensions:[],fecMechanisms:[]},A=function(c,m){c=parseInt(c,10);for(var n=0;n<m.length;n++)if(m[n].payloadType===c||m[n].preferredPayloadType===c)return m[n]},w=function(c,m,n,e){var t=A(c.parameters.apt,n),b=A(m.parameters.apt,e);return t&&b&&t.name.toLowerCase()===b.name.toLowerCase()};return a.codecs.forEach(function(c){for(var m=0;m<u.codecs.length;m++){var n=u.codecs[m];if(c.name.toLowerCase()===n.name.toLowerCase()&&c.clockRate===n.clockRate){if(c.name.toLowerCase()==="rtx"&&c.parameters&&n.parameters.apt&&!w(c,n,a.codecs,u.codecs))continue;n=JSON.parse(JSON.stringify(n)),n.numChannels=Math.min(c.numChannels,n.numChannels),P.codecs.push(n),n.rtcpFeedback=n.rtcpFeedback.filter(function(e){for(var t=0;t<c.rtcpFeedback.length;t++)if(c.rtcpFeedback[t].type===e.type&&c.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),a.headerExtensions.forEach(function(c){for(var m=0;m<u.headerExtensions.length;m++){var n=u.headerExtensions[m];if(c.uri===n.uri){P.headerExtensions.push(n);break}}}),P}function d(a,u,P){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[u][a].indexOf(P)!==-1}function h(a,u){var P=a.getRemoteCandidates().find(function(A){return u.foundation===A.foundation&&u.ip===A.ip&&u.port===A.port&&u.priority===A.priority&&u.protocol===A.protocol&&u.type===A.type});return P||a.addRemoteCandidate(u),!P}function v(a,u){var P=new Error(u);return P.name=a,P}return Mr=function(a,u){function P(n,e){e.addTrack(n),e.dispatchEvent(new a.MediaStreamTrackEvent("addtrack",{track:n}))}function A(n,e){e.removeTrack(n),e.dispatchEvent(new a.MediaStreamTrackEvent("removetrack",{track:n}))}function w(n,e,t,b){var C=new Event("track");C.track=e,C.receiver=t,C.transceiver={receiver:t},C.streams=b,a.setTimeout(function(){n._dispatchEvent("track",C)})}var c=function(n){var e=this,t=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(C){e[C]=t[C].bind(t)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle=n.bundlePolicy==="max-bundle",n.rtcpMuxPolicy==="negotiate")throw v("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all";break}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced";break}if(n.iceServers=o(n.iceServers||[],u),this._iceGatherers=[],n.iceCandidatePoolSize)for(var b=n.iceCandidatePoolSize;b>0;b--)this._iceGatherers.push(new a.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};c.prototype.onicecandidate=null,c.prototype.onaddstream=null,c.prototype.ontrack=null,c.prototype.onremovestream=null,c.prototype.onsignalingstatechange=null,c.prototype.oniceconnectionstatechange=null,c.prototype.onicegatheringstatechange=null,c.prototype.onnegotiationneeded=null,c.prototype.ondatachannel=null,c.prototype._dispatchEvent=function(n,e){this._isClosed||(this.dispatchEvent(e),typeof this["on"+n]=="function"&&this["on"+n](e))},c.prototype._emitGatheringStateChange=function(){var n=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",n)},c.prototype.getConfiguration=function(){return this._config},c.prototype.getLocalStreams=function(){return this.localStreams},c.prototype.getRemoteStreams=function(){return this.remoteStreams},c.prototype._createTransceiver=function(n){var e=this.transceivers.length>0,t={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:n,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&e)t.iceTransport=this.transceivers[0].iceTransport,t.dtlsTransport=this.transceivers[0].dtlsTransport;else{var b=this._createIceAndDtlsTransports();t.iceTransport=b.iceTransport,t.dtlsTransport=b.dtlsTransport}return this.transceivers.push(t),t},c.prototype.addTrack=function(n,e){if(this._isClosed)throw v("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var t=this.transceivers.find(function(f){return f.track===n});if(t)throw v("InvalidAccessError","Track already exists.");for(var b,C=0;C<this.transceivers.length;C++)!this.transceivers[C].track&&this.transceivers[C].kind===n.kind&&(b=this.transceivers[C]);return b||(b=this._createTransceiver(n.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(e)===-1&&this.localStreams.push(e),b.track=n,b.stream=e,b.rtpSender=new a.RTCRtpSender(n,b.dtlsTransport),b.rtpSender},c.prototype.addStream=function(n){var e=this;if(u>=15025)n.getTracks().forEach(function(b){e.addTrack(b,n)});else{var t=n.clone();n.getTracks().forEach(function(b,C){var f=t.getTracks()[C];b.addEventListener("enabled",function(r){f.enabled=r.enabled})}),t.getTracks().forEach(function(b){e.addTrack(b,t)})}},c.prototype.removeTrack=function(n){if(this._isClosed)throw v("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(n instanceof a.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find(function(C){return C.rtpSender===n});if(!e)throw v("InvalidAccessError","Sender was not created by this connection.");var t=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null;var b=this.transceivers.map(function(C){return C.stream});b.indexOf(t)===-1&&this.localStreams.indexOf(t)>-1&&this.localStreams.splice(this.localStreams.indexOf(t),1),this._maybeFireNegotiationNeeded()},c.prototype.removeStream=function(n){var e=this;n.getTracks().forEach(function(t){var b=e.getSenders().find(function(C){return C.track===t});b&&e.removeTrack(b)})},c.prototype.getSenders=function(){return this.transceivers.filter(function(n){return!!n.rtpSender}).map(function(n){return n.rtpSender})},c.prototype.getReceivers=function(){return this.transceivers.filter(function(n){return!!n.rtpReceiver}).map(function(n){return n.rtpReceiver})},c.prototype._createIceGatherer=function(n,e){var t=this;if(e&&n>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var b=new a.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(b,"state",{value:"new",writable:!0}),this.transceivers[n].bufferedCandidateEvents=[],this.transceivers[n].bufferCandidates=function(C){var f=!C.candidate||Object.keys(C.candidate).length===0;b.state=f?"completed":"gathering",t.transceivers[n].bufferedCandidateEvents!==null&&t.transceivers[n].bufferedCandidateEvents.push(C)},b.addEventListener("localcandidate",this.transceivers[n].bufferCandidates),b},c.prototype._gather=function(n,e){var t=this,b=this.transceivers[e].iceGatherer;if(!b.onlocalcandidate){var C=this.transceivers[e].bufferedCandidateEvents;this.transceivers[e].bufferedCandidateEvents=null,b.removeEventListener("localcandidate",this.transceivers[e].bufferCandidates),b.onlocalcandidate=function(f){if(!(t.usingBundle&&e>0)){var r=new Event("icecandidate");r.candidate={sdpMid:n,sdpMLineIndex:e};var i=f.candidate,_=!i||Object.keys(i).length===0;if(_)(b.state==="new"||b.state==="gathering")&&(b.state="completed");else{b.state==="new"&&(b.state="gathering"),i.component=1;var S=l.writeCandidate(i);r.candidate=Object.assign(r.candidate,l.parseCandidate(S)),r.candidate.candidate=S}var p=l.getMediaSections(t.localDescription.sdp);_?p[r.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:p[r.candidate.sdpMLineIndex]+="a="+r.candidate.candidate+`\r
`,t.localDescription.sdp=l.getDescription(t.localDescription.sdp)+p.join("");var I=t.transceivers.every(function(D){return D.iceGatherer&&D.iceGatherer.state==="completed"});t.iceGatheringState!=="gathering"&&(t.iceGatheringState="gathering",t._emitGatheringStateChange()),_||t._dispatchEvent("icecandidate",r),I&&(t._dispatchEvent("icecandidate",new Event("icecandidate")),t.iceGatheringState="complete",t._emitGatheringStateChange())}},a.setTimeout(function(){C.forEach(function(f){b.onlocalcandidate(f)})},0)}},c.prototype._createIceAndDtlsTransports=function(){var n=this,e=new a.RTCIceTransport(null);e.onicestatechange=function(){n._updateConnectionState()};var t=new a.RTCDtlsTransport(e);return t.ondtlsstatechange=function(){n._updateConnectionState()},t.onerror=function(){Object.defineProperty(t,"state",{value:"failed",writable:!0}),n._updateConnectionState()},{iceTransport:e,dtlsTransport:t}},c.prototype._disposeIceAndDtlsTransports=function(n){var e=this.transceivers[n].iceGatherer;e&&(delete e.onlocalcandidate,delete this.transceivers[n].iceGatherer);var t=this.transceivers[n].iceTransport;t&&(delete t.onicestatechange,delete this.transceivers[n].iceTransport);var b=this.transceivers[n].dtlsTransport;b&&(delete b.ondtlsstatechange,delete b.onerror,delete this.transceivers[n].dtlsTransport)},c.prototype._transceive=function(n,e,t){var b=s(n.localCapabilities,n.remoteCapabilities);e&&n.rtpSender&&(b.encodings=n.sendEncodingParameters,b.rtcp={cname:l.localCName,compound:n.rtcpParameters.compound},n.recvEncodingParameters.length&&(b.rtcp.ssrc=n.recvEncodingParameters[0].ssrc),n.rtpSender.send(b)),t&&n.rtpReceiver&&b.codecs.length>0&&(n.kind==="video"&&n.recvEncodingParameters&&u<15019&&n.recvEncodingParameters.forEach(function(C){delete C.rtx}),n.recvEncodingParameters.length?b.encodings=n.recvEncodingParameters:b.encodings=[{}],b.rtcp={compound:n.rtcpParameters.compound},n.rtcpParameters.cname&&(b.rtcp.cname=n.rtcpParameters.cname),n.sendEncodingParameters.length&&(b.rtcp.ssrc=n.sendEncodingParameters[0].ssrc),n.rtpReceiver.receive(b))},c.prototype.setLocalDescription=function(n){var e=this;if(["offer","answer"].indexOf(n.type)===-1)return Promise.reject(v("TypeError",'Unsupported type "'+n.type+'"'));if(!d("setLocalDescription",n.type,e.signalingState)||e._isClosed)return Promise.reject(v("InvalidStateError","Can not set local "+n.type+" in state "+e.signalingState));var t,b;if(n.type==="offer")t=l.splitSections(n.sdp),b=t.shift(),t.forEach(function(f,r){var i=l.parseRtpParameters(f);e.transceivers[r].localCapabilities=i}),e.transceivers.forEach(function(f,r){e._gather(f.mid,r)});else if(n.type==="answer"){t=l.splitSections(e.remoteDescription.sdp),b=t.shift();var C=l.matchPrefix(b,"a=ice-lite").length>0;t.forEach(function(f,r){var i=e.transceivers[r],_=i.iceGatherer,S=i.iceTransport,p=i.dtlsTransport,I=i.localCapabilities,D=i.remoteCapabilities,E=l.isRejected(f)&&l.matchPrefix(f,"a=bundle-only").length===0;if(!E&&!i.isDatachannel){var T=l.getIceParameters(f,b),M=l.getDtlsParameters(f,b);C&&(M.role="server"),(!e.usingBundle||r===0)&&(e._gather(i.mid,r),S.state==="new"&&S.start(_,T,C?"controlling":"controlled"),p.state==="new"&&p.start(M));var g=s(I,D);e._transceive(i,g.codecs.length>0,!1)}})}return e.localDescription={type:n.type,sdp:n.sdp},n.type==="offer"?e._updateSignalingState("have-local-offer"):e._updateSignalingState("stable"),Promise.resolve()},c.prototype.setRemoteDescription=function(n){var e=this;if(["offer","answer"].indexOf(n.type)===-1)return Promise.reject(v("TypeError",'Unsupported type "'+n.type+'"'));if(!d("setRemoteDescription",n.type,e.signalingState)||e._isClosed)return Promise.reject(v("InvalidStateError","Can not set remote "+n.type+" in state "+e.signalingState));var t={};e.remoteStreams.forEach(function(S){t[S.id]=S});var b=[],C=l.splitSections(n.sdp),f=C.shift(),r=l.matchPrefix(f,"a=ice-lite").length>0,i=l.matchPrefix(f,"a=group:BUNDLE ").length>0;e.usingBundle=i;var _=l.matchPrefix(f,"a=ice-options:")[0];return _?e.canTrickleIceCandidates=_.substr(14).split(" ").indexOf("trickle")>=0:e.canTrickleIceCandidates=!1,C.forEach(function(S,p){var I=l.splitLines(S),D=l.getKind(S),E=l.isRejected(S)&&l.matchPrefix(S,"a=bundle-only").length===0,T=I[0].substr(2).split(" ")[2],M=l.getDirection(S,f),g=l.parseMsid(S),$=l.getMid(S)||l.generateIdentifier();if(D==="application"&&T==="DTLS/SCTP"){e.transceivers[p]={mid:$,isDatachannel:!0};return}var N,R,O,F,B,q,x,j,L,W=l.parseRtpParameters(S),H,Y;E||(H=l.getIceParameters(S,f),Y=l.getDtlsParameters(S,f),Y.role="client"),x=l.parseRtpEncodingParameters(S);var J=l.parseRtcpParameters(S),K=l.matchPrefix(S,"a=end-of-candidates",f).length>0,z=l.matchPrefix(S,"a=candidate:").map(function(te){return l.parseCandidate(te)}).filter(function(te){return te.component===1});if((n.type==="offer"||n.type==="answer")&&!E&&i&&p>0&&e.transceivers[p]&&(e._disposeIceAndDtlsTransports(p),e.transceivers[p].iceGatherer=e.transceivers[0].iceGatherer,e.transceivers[p].iceTransport=e.transceivers[0].iceTransport,e.transceivers[p].dtlsTransport=e.transceivers[0].dtlsTransport,e.transceivers[p].rtpSender&&e.transceivers[p].rtpSender.setTransport(e.transceivers[0].dtlsTransport),e.transceivers[p].rtpReceiver&&e.transceivers[p].rtpReceiver.setTransport(e.transceivers[0].dtlsTransport)),n.type==="offer"&&!E){N=e.transceivers[p]||e._createTransceiver(D),N.mid=$,N.iceGatherer||(N.iceGatherer=e._createIceGatherer(p,i)),z.length&&N.iceTransport.state==="new"&&(K&&(!i||p===0)?N.iceTransport.setRemoteCandidates(z):z.forEach(function(te){h(N.iceTransport,te)})),j=a.RTCRtpReceiver.getCapabilities(D),u<15019&&(j.codecs=j.codecs.filter(function(te){return te.name!=="rtx"})),q=N.sendEncodingParameters||[{ssrc:(2*p+2)*1001}];var Z=!1;if(M==="sendrecv"||M==="sendonly"){if(Z=!N.rtpReceiver,B=N.rtpReceiver||new a.RTCRtpReceiver(N.dtlsTransport,D),Z){var Q;L=B.track,g&&g.stream==="-"||(g?(t[g.stream]||(t[g.stream]=new a.MediaStream,Object.defineProperty(t[g.stream],"id",{get:function(){return g.stream}})),Object.defineProperty(L,"id",{get:function(){return g.track}}),Q=t[g.stream]):(t.default||(t.default=new a.MediaStream),Q=t.default)),Q&&(P(L,Q),N.associatedRemoteMediaStreams.push(Q)),b.push([L,B,Q])}}else N.rtpReceiver&&N.rtpReceiver.track&&(N.associatedRemoteMediaStreams.forEach(function(te){var ae=te.getTracks().find(function(le){return le.id===N.rtpReceiver.track.id});ae&&A(ae,te)}),N.associatedRemoteMediaStreams=[]);N.localCapabilities=j,N.remoteCapabilities=W,N.rtpReceiver=B,N.rtcpParameters=J,N.sendEncodingParameters=q,N.recvEncodingParameters=x,e._transceive(e.transceivers[p],!1,Z)}else n.type==="answer"&&!E&&(N=e.transceivers[p],R=N.iceGatherer,O=N.iceTransport,F=N.dtlsTransport,B=N.rtpReceiver,q=N.sendEncodingParameters,j=N.localCapabilities,e.transceivers[p].recvEncodingParameters=x,e.transceivers[p].remoteCapabilities=W,e.transceivers[p].rtcpParameters=J,z.length&&O.state==="new"&&((r||K)&&(!i||p===0)?O.setRemoteCandidates(z):z.forEach(function(te){h(N.iceTransport,te)})),(!i||p===0)&&(O.state==="new"&&O.start(R,H,"controlling"),F.state==="new"&&F.start(Y)),e._transceive(N,M==="sendrecv"||M==="recvonly",M==="sendrecv"||M==="sendonly"),B&&(M==="sendrecv"||M==="sendonly")?(L=B.track,g?(t[g.stream]||(t[g.stream]=new a.MediaStream),P(L,t[g.stream]),b.push([L,B,t[g.stream]])):(t.default||(t.default=new a.MediaStream),P(L,t.default),b.push([L,B,t.default]))):delete N.rtpReceiver)}),e._dtlsRole===void 0&&(e._dtlsRole=n.type==="offer"?"active":"passive"),e.remoteDescription={type:n.type,sdp:n.sdp},n.type==="offer"?e._updateSignalingState("have-remote-offer"):e._updateSignalingState("stable"),Object.keys(t).forEach(function(S){var p=t[S];if(p.getTracks().length){if(e.remoteStreams.indexOf(p)===-1){e.remoteStreams.push(p);var I=new Event("addstream");I.stream=p,a.setTimeout(function(){e._dispatchEvent("addstream",I)})}b.forEach(function(D){var E=D[0],T=D[1];p.id===D[2].id&&w(e,E,T,[p])})}}),b.forEach(function(S){S[2]||w(e,S[0],S[1],[])}),a.setTimeout(function(){e&&e.transceivers&&e.transceivers.forEach(function(S){S.iceTransport&&S.iceTransport.state==="new"&&S.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),S.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},c.prototype.close=function(){this.transceivers.forEach(function(n){n.iceTransport&&n.iceTransport.stop(),n.dtlsTransport&&n.dtlsTransport.stop(),n.rtpSender&&n.rtpSender.stop(),n.rtpReceiver&&n.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},c.prototype._updateSignalingState=function(n){this.signalingState=n;var e=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",e)},c.prototype._maybeFireNegotiationNeeded=function(){var n=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,a.setTimeout(function(){if(n.needNegotiation){n.needNegotiation=!1;var e=new Event("negotiationneeded");n._dispatchEvent("negotiationneeded",e)}},0))},c.prototype._updateConnectionState=function(){var n,e={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(b){e[b.iceTransport.state]++,e[b.dtlsTransport.state]++}),e.connected+=e.completed,n="new",e.failed>0?n="failed":e.connecting>0||e.checking>0?n="connecting":e.disconnected>0?n="disconnected":e.new>0?n="new":(e.connected>0||e.completed>0)&&(n="connected"),n!==this.iceConnectionState){this.iceConnectionState=n;var t=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",t)}},c.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(v("InvalidStateError","Can not call createOffer after close"));var e=n.transceivers.filter(function(r){return r.kind==="audio"}).length,t=n.transceivers.filter(function(r){return r.kind==="video"}).length,b=arguments[0];if(b){if(b.mandatory||b.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");b.offerToReceiveAudio!==void 0&&(b.offerToReceiveAudio===!0?e=1:b.offerToReceiveAudio===!1?e=0:e=b.offerToReceiveAudio),b.offerToReceiveVideo!==void 0&&(b.offerToReceiveVideo===!0?t=1:b.offerToReceiveVideo===!1?t=0:t=b.offerToReceiveVideo)}for(n.transceivers.forEach(function(r){r.kind==="audio"?(e--,e<0&&(r.wantReceive=!1)):r.kind==="video"&&(t--,t<0&&(r.wantReceive=!1))});e>0||t>0;)e>0&&(n._createTransceiver("audio"),e--),t>0&&(n._createTransceiver("video"),t--);var C=l.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(r,i){var _=r.track,S=r.kind,p=r.mid||l.generateIdentifier();r.mid=p,r.iceGatherer||(r.iceGatherer=n._createIceGatherer(i,n.usingBundle));var I=a.RTCRtpSender.getCapabilities(S);u<15019&&(I.codecs=I.codecs.filter(function(E){return E.name!=="rtx"})),I.codecs.forEach(function(E){E.name==="H264"&&E.parameters["level-asymmetry-allowed"]===void 0&&(E.parameters["level-asymmetry-allowed"]="1"),r.remoteCapabilities&&r.remoteCapabilities.codecs&&r.remoteCapabilities.codecs.forEach(function(T){E.name.toLowerCase()===T.name.toLowerCase()&&E.clockRate===T.clockRate&&(E.preferredPayloadType=T.payloadType)})}),I.headerExtensions.forEach(function(E){var T=r.remoteCapabilities&&r.remoteCapabilities.headerExtensions||[];T.forEach(function(M){E.uri===M.uri&&(E.id=M.id)})});var D=r.sendEncodingParameters||[{ssrc:(2*i+1)*1001}];_&&u>=15019&&S==="video"&&!D[0].rtx&&(D[0].rtx={ssrc:D[0].ssrc+1}),r.wantReceive&&(r.rtpReceiver=new a.RTCRtpReceiver(r.dtlsTransport,S)),r.localCapabilities=I,r.sendEncodingParameters=D}),n._config.bundlePolicy!=="max-compat"&&(C+="a=group:BUNDLE "+n.transceivers.map(function(r){return r.mid}).join(" ")+`\r
`),C+=`a=ice-options:trickle\r
`,n.transceivers.forEach(function(r,i){C+=y(r,r.localCapabilities,"offer",r.stream,n._dtlsRole),C+=`a=rtcp-rsize\r
`,r.iceGatherer&&n.iceGatheringState!=="new"&&(i===0||!n.usingBundle)&&(r.iceGatherer.getLocalCandidates().forEach(function(_){_.component=1,C+="a="+l.writeCandidate(_)+`\r
`}),r.iceGatherer.state==="completed"&&(C+=`a=end-of-candidates\r
`))});var f=new a.RTCSessionDescription({type:"offer",sdp:C});return Promise.resolve(f)},c.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(v("InvalidStateError","Can not call createAnswer after close"));var e=l.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(e+="a=group:BUNDLE "+n.transceivers.map(function(C){return C.mid}).join(" ")+`\r
`);var t=l.getMediaSections(n.remoteDescription.sdp).length;n.transceivers.forEach(function(C,f){if(!(f+1>t)){if(C.isDatachannel){e+=`m=application 0 DTLS/SCTP 5000\r
c=IN IP4 0.0.0.0\r
a=mid:`+C.mid+`\r
`;return}if(C.stream){var r;C.kind==="audio"?r=C.stream.getAudioTracks()[0]:C.kind==="video"&&(r=C.stream.getVideoTracks()[0]),r&&u>=15019&&C.kind==="video"&&!C.sendEncodingParameters[0].rtx&&(C.sendEncodingParameters[0].rtx={ssrc:C.sendEncodingParameters[0].ssrc+1})}var i=s(C.localCapabilities,C.remoteCapabilities),_=i.codecs.filter(function(S){return S.name.toLowerCase()==="rtx"}).length;!_&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,e+=y(C,i,"answer",C.stream,n._dtlsRole),C.rtcpParameters&&C.rtcpParameters.reducedSize&&(e+=`a=rtcp-rsize\r
`)}});var b=new a.RTCSessionDescription({type:"answer",sdp:e});return Promise.resolve(b)},c.prototype.addIceCandidate=function(n){var e=this,t;return n&&!(n.sdpMLineIndex!==void 0||n.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(b,C){if(e.remoteDescription)if(!n||n.candidate==="")for(var f=0;f<e.transceivers.length&&!(!e.transceivers[f].isDatachannel&&(e.transceivers[f].iceTransport.addRemoteCandidate({}),t=l.getMediaSections(e.remoteDescription.sdp),t[f]+=`a=end-of-candidates\r
`,e.remoteDescription.sdp=l.getDescription(e.remoteDescription.sdp)+t.join(""),e.usingBundle));f++);else{var r=n.sdpMLineIndex;if(n.sdpMid){for(var i=0;i<e.transceivers.length;i++)if(e.transceivers[i].mid===n.sdpMid){r=i;break}}var _=e.transceivers[r];if(_){if(_.isDatachannel)return b();var S=Object.keys(n.candidate).length>0?l.parseCandidate(n.candidate):{};if(S.protocol==="tcp"&&(S.port===0||S.port===9)||S.component&&S.component!==1)return b();if((r===0||r>0&&_.iceTransport!==e.transceivers[0].iceTransport)&&!h(_.iceTransport,S))return C(v("OperationError","Can not add ICE candidate"));var p=n.candidate.trim();p.indexOf("a=")===0&&(p=p.substr(2)),t=l.getMediaSections(e.remoteDescription.sdp),t[r]+="a="+(S.type?p:"end-of-candidates")+`\r
`,e.remoteDescription.sdp=t.join("")}else return C(v("OperationError","Can not add ICE candidate"))}else return C(v("InvalidStateError","Can not add ICE candidate without a remote description"));b()})},c.prototype.getStats=function(){var n=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(b){t[b]&&n.push(t[b].getStats())})});var e=function(t){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};return new Promise(function(t){var b=new Map;Promise.all(n).then(function(C){C.forEach(function(f){Object.keys(f).forEach(function(r){f[r].type=e(f[r]),b.set(r,f[r])})}),t(b)})})};var m=["createOffer","createAnswer"];return m.forEach(function(n){var e=c.prototype[n];c.prototype[n]=function(){var t=arguments;return typeof t[0]=="function"||typeof t[1]=="function"?e.apply(this,[arguments[2]]).then(function(b){typeof t[0]=="function"&&t[0].apply(null,[b])},function(b){typeof t[1]=="function"&&t[1].apply(null,[b])}):e.apply(this,arguments)}}),m=["setLocalDescription","setRemoteDescription","addIceCandidate"],m.forEach(function(n){var e=c.prototype[n];c.prototype[n]=function(){var t=arguments;return typeof t[1]=="function"||typeof t[2]=="function"?e.apply(this,arguments).then(function(){typeof t[1]=="function"&&t[1].apply(null)},function(b){typeof t[2]=="function"&&t[2].apply(null,[b])}):e.apply(this,arguments)}}),["getStats"].forEach(function(n){var e=c.prototype[n];c.prototype[n]=function(){var t=arguments;return typeof t[1]=="function"?e.apply(this,arguments).then(function(){typeof t[1]=="function"&&t[1].apply(null)}):e.apply(this,arguments)}}),c},Mr}var Lr,Zi;function Fr(){if(Zi)return Lr;Zi=1;var l=function(){function t(b,C){var f=[],r=!0,i=!1,_=void 0;try{for(var S=b[Symbol.iterator](),p;!(r=(p=S.next()).done)&&(f.push(p.value),!(C&&f.length===C));r=!0);}catch(I){i=!0,_=I}finally{try{!r&&S.return&&S.return()}finally{if(i)throw _}}return f}return function(b,C){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return t(b,C);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=ke(),o={0:"PCMU",8:"PCMA"},s=111,d=51e4,h=6e3;function v(t){var b=/a=rtpmap:(\d+) (\S+)/m.exec(t)||[null,"",""],C=l(b,3),f=C[1],r=C[2],i=new RegExp("a=fmtp:"+f+" (\\S+)","m"),_=i.exec(t)||[null,""],S=l(_,2),p=S[1];return{codecName:r,codecParams:p}}function a(t){return y.isChrome(window,window.navigator)?t.split(`
`).filter(function(b){return b.indexOf("a=ice-lite")===-1}).join(`
`):t}function u(t,b){if(typeof b!="number"||b<h||b>d)return t;var C=/a=rtpmap:(\d+) opus/m.exec(t),f=C&&C.length?C[1]:s,r=new RegExp("a=fmtp:"+f),i=t.split(`
`).map(function(_){return r.test(_)?_+(";maxaveragebitrate="+b):_});return i.join(`
`)}function P(t,b){var C=A(t),f=t.split(`\r
m=`)[0];return[f].concat(C.map(function(r){if(!/^m=(audio|video)/.test(r))return r;var i=r.match(/^m=(audio|video)/)[1],_=w(r),S=c(_,b),p=m(S,r),I=_.get("pcma")||[],D=_.get("pcmu")||[],E=i==="audio"?new Set(I.concat(D)):new Set;return E.has(S[0])?p.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):p})).join(`\r
`)}function A(t,b,C){return t.replace(/\r\n\r\n$/,`\r
`).split(`\r
m=`).slice(1).map(function(f){return"m="+f}).filter(function(f){var r=new RegExp("m=.*","gm"),i=new RegExp("a=.*","gm");return r.test(f)&&i.test(f)})}function w(t){return Array.from(n(t)).reduce(function(b,C){var f=C[0],r=C[1],i=b.get(r)||[];return b.set(r,i.concat(f))},new Map)}function c(t,b){b=b.map(function(i){return i.toLowerCase()});var C=y.flatMap(b,function(i){return t.get(i)||[]}),f=y.difference(Array.from(t.keys()),b),r=y.flatMap(f,function(i){return t.get(i)});return C.concat(r)}function m(t,b){var C=b.split(`\r
`),f=C[0],r=C.slice(1);return f=f.replace(/([0-9]+\s?)+$/,t.join(" ")),[f].concat(r).join(`\r
`)}function n(t){return e(t).reduce(function(b,C){var f=new RegExp("a=rtpmap:"+C+" ([^/]+)"),r=t.match(f),i=r?r[1].toLowerCase():o[C]?o[C].toLowerCase():"";return b.set(C,i)},new Map)}function e(t){var b=t.split(`\r
`)[0],C=b.match(/([0-9]+)/g);return C?C.slice(1).map(function(f){return parseInt(f,10)}):[]}return Lr={getPreferredCodecInfo:v,setCodecPreferences:P,setIceAggressiveNomination:a,setMaxAverageBitrate:u},Lr}var Nr,eo;function to(){if(eo)return Nr;eo=1;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},y=Ua(),o=Me().default,s=Fr(),d=s.setCodecPreferences,h=s.setMaxAverageBitrate,v=ke();function a(w){if(typeof window>"u"){this.log.info("No RTCPeerConnection implementation available. The window object was not found.");return}w&&w.RTCPeerConnection?this.RTCPeerConnection=w.RTCPeerConnection:v.isLegacyEdge()?this.RTCPeerConnection=new y(typeof window<"u"?window:He):typeof window.RTCPeerConnection=="function"?this.RTCPeerConnection=window.RTCPeerConnection:typeof window.webkitRTCPeerConnection=="function"?this.RTCPeerConnection=webkitRTCPeerConnection:typeof window.mozRTCPeerConnection=="function"?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log.info("No RTCPeerConnection implementation available")}a.prototype.create=function(w,c){this.log=o.getInstance(),this.pc=new this.RTCPeerConnection(c,w)},a.prototype.createModernConstraints=function(w){if(typeof w>"u")return null;var c=Object.assign({},w);return typeof webkitRTCPeerConnection<"u"&&!v.isLegacyEdge()?(c.mandatory={},typeof w.audio<"u"&&(c.mandatory.OfferToReceiveAudio=w.audio),typeof w.video<"u"&&(c.mandatory.OfferToReceiveVideo=w.video)):(typeof w.audio<"u"&&(c.offerToReceiveAudio=w.audio),typeof w.video<"u"&&(c.offerToReceiveVideo=w.video)),delete c.audio,delete c.video,c},a.prototype.createOffer=function(w,c,m,n,e){var t=this;return m=this.createModernConstraints(m),P(this.pc.createOffer,this.pc)(m).then(function(b){if(!t.pc)return Promise.resolve();var C=h(b.sdp,w);return A(t.pc.setLocalDescription,t.pc)(new RTCSessionDescription({type:"offer",sdp:d(C,c)}))}).then(n,e)},a.prototype.createAnswer=function(w,c,m,n,e){var t=this;return m=this.createModernConstraints(m),P(this.pc.createAnswer,this.pc)(m).then(function(b){if(!t.pc)return Promise.resolve();var C=h(b.sdp,w);return A(t.pc.setLocalDescription,t.pc)(new RTCSessionDescription({type:"answer",sdp:d(C,c)}))}).then(n,e)},a.prototype.processSDP=function(w,c,m,n,e,t){var b=this;m=d(m,c);var C=new RTCSessionDescription({sdp:m,type:"offer"});return A(this.pc.setRemoteDescription,this.pc)(C).then(function(){b.createAnswer(w,c,n,e,t)})},a.prototype.getSDP=function(){return this.pc.localDescription.sdp},a.prototype.processAnswer=function(w,c,m,n){return this.pc?(c=d(c,w),A(this.pc.setRemoteDescription,this.pc)(new RTCSessionDescription({sdp:c,type:"answer"})).then(m,n)):Promise.resolve()},a.test=function(){if((typeof navigator>"u"?"undefined":l(navigator))==="object"){var w=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(v.isLegacyEdge(navigator))return!1;if(w&&typeof window.RTCPeerConnection=="function")return!0;if(w&&typeof window.webkitRTCPeerConnection=="function")return!0;if(w&&typeof window.mozRTCPeerConnection=="function"){try{var c=new window.mozRTCPeerConnection;if(typeof c.getLocalStreams!="function")return!1}catch{return!1}return!0}else if(typeof RTCIceGatherer<"u")return!0}return!1};function u(w,c,m,n){return function(){var e=Array.prototype.slice.call(arguments);return new Promise(function(t){var b=w.apply(c,e);if(!n){t(b);return}if((typeof b>"u"?"undefined":l(b))==="object"&&typeof b.then=="function")t(b);else throw new Error}).catch(function(){return new Promise(function(t,b){w.apply(c,m?[t,b].concat(e):e.concat([t,b]))})})}}function P(w,c){return u(w,c,!0,!0)}function A(w,c){return u(w,c,!1,!1)}return Nr=a,Nr}var Ur,ro;function qa(){if(ro)return Ur;ro=1;var l=he(),y=l.InvalidArgumentError,o=l.MediaErrors,s=l.NotSupportedError,d=l.SignalingErrors,h=Me().default,v=ke(),a=to(),u=Fr(),P=u.setIceAggressiveNomination,A=15e3,w="none",c="timeout",m="new",n=50;function e(r,i,_,S){if(!r||!i||!_)throw new y("Audiohelper, pstream and getUserMedia are required arguments");if(!(this instanceof e))return new e(r,i,_,S);function p(){}this.onaudio=p,this.onopen=p,this.onerror=p,this.onclose=p,this.ondisconnected=p,this.onfailed=p,this.onconnected=p,this.onreconnected=p,this.onsignalingstatechange=p,this.ondtlstransportstatechange=p,this.onicegatheringfailure=p,this.onicegatheringstatechange=p,this.oniceconnectionstatechange=p,this.onpcconnectionstatechange=p,this.onicecandidate=p,this.onselectedcandidatepairchange=p,this.onvolume=p,this.version=null,this.pstream=i,this.stream=null,this.sinkIds=new Set(["default"]),this.outputs=new Map,this.status="connecting",this.callSid=null,this.isMuted=!1,this.getUserMedia=_;var I=typeof window<"u"&&(window.AudioContext||window.webkitAudioContext);return this._isSinkSupported=!!I&&typeof HTMLAudioElement<"u"&&HTMLAudioElement.prototype.setSinkId,this._audioContext=I&&r._audioContext,this._hasIceCandidates=!1,this._hasIceGatheringFailures=!1,this._iceGatheringTimeoutId=null,this._masterAudio=null,this._masterAudioDeviceId=null,this._mediaStreamSource=null,this._dtmfSender=null,this._dtmfSenderUnsupported=!1,this._callEvents=[],this._nextTimeToPublish=Date.now(),this._onAnswerOrRinging=p,this._onHangup=p,this._remoteStream=null,this._shouldManageStream=!0,this._iceState=m,this._isUnifiedPlan=S.isUnifiedPlan,this.options=S=S||{},this.navigator=S.navigator||(typeof navigator<"u"?navigator:null),this.util=S.util||v,this.codecPreferences=S.codecPreferences,this._log=h.getInstance(),this}e.prototype.uri=function(){return this._uri},e.prototype.openWithConstraints=function(r){return this.getUserMedia({audio:r}).then(this._setInputTracksFromStream.bind(this,!1))},e.prototype.setInputTracksFromStream=function(r){var i=this;return this._setInputTracksFromStream(!0,r).then(function(){i._shouldManageStream=!1})},e.prototype._createAnalyser=function(r,i){i=Object.assign({fftSize:32,smoothingTimeConstant:.3},i);var _=r.createAnalyser();for(var S in i)_[S]=i[S];return _},e.prototype._setVolumeHandler=function(r){this.onvolume=r},e.prototype._startPollingVolume=function(){if(!(!this._audioContext||!this.stream||!this._remoteStream)){var r=this._audioContext,i=this._inputAnalyser=this._createAnalyser(r),_=i.frequencyBinCount,S=new Uint8Array(_);this._inputAnalyser2=this._createAnalyser(r,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0});var p=this._outputAnalyser=this._createAnalyser(r),I=p.frequencyBinCount,D=new Uint8Array(I);this._outputAnalyser2=this._createAnalyser(r,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0}),this._updateInputStreamSource(this.stream),this._updateOutputStreamSource(this._remoteStream);var E=this;setTimeout(function T(){if(E._audioContext){if(E.status==="closed"){E._inputAnalyser.disconnect(),E._outputAnalyser.disconnect(),E._inputAnalyser2.disconnect(),E._outputAnalyser2.disconnect();return}}else return;E._inputAnalyser.getByteFrequencyData(S);var M=E.util.average(S);E._inputAnalyser2.getByteFrequencyData(S);var g=E.util.average(S);E._outputAnalyser.getByteFrequencyData(D);var $=E.util.average(D);E._outputAnalyser2.getByteFrequencyData(D);var N=E.util.average(D);E.onvolume(M/255,$/255,g,N),setTimeout(T,n)},n)}},e.prototype._stopStream=function(i){if(this._shouldManageStream)if(typeof MediaStreamTrack.prototype.stop=="function"){var _=typeof i.getAudioTracks=="function"?i.getAudioTracks():i.audioTracks;_.forEach(function(S){S.stop()})}else i.stop()},e.prototype._updateInputStreamSource=function(r){this._inputStreamSource&&this._inputStreamSource.disconnect();try{this._inputStreamSource=this._audioContext.createMediaStreamSource(r),this._inputStreamSource.connect(this._inputAnalyser),this._inputStreamSource.connect(this._inputAnalyser2)}catch(i){this._log.warn("Unable to update input MediaStreamSource",i),this._inputStreamSource=null}},e.prototype._updateOutputStreamSource=function(r){this._outputStreamSource&&this._outputStreamSource.disconnect();try{this._outputStreamSource=this._audioContext.createMediaStreamSource(r),this._outputStreamSource.connect(this._outputAnalyser),this._outputStreamSource.connect(this._outputAnalyser2)}catch(i){this._log.warn("Unable to update output MediaStreamSource",i),this._outputStreamSource=null}},e.prototype._setInputTracksFromStream=function(r,i){return this._isUnifiedPlan?this._setInputTracksForUnifiedPlan(r,i):this._setInputTracksForPlanB(r,i)},e.prototype._setInputTracksForPlanB=function(r,i){var _=this;if(!i)return Promise.reject(new y("Can not set input stream to null while in a call"));if(!i.getAudioTracks().length)return Promise.reject(new y("Supplied input stream has no audio tracks"));var S=this.stream;return S?(this._stopStream(S),C(this.version.pc,S),S.getAudioTracks().forEach(S.removeTrack,S),i.getAudioTracks().forEach(S.addTrack,S),t(this.version.pc,i),this._updateInputStreamSource(this.stream)):this.stream=r?b(i):i,this.mute(this.isMuted),this.version?new Promise(function(p,I){_.version.createOffer(_.options.maxAverageBitrate,_.codecPreferences,{audio:!0},function(){_.version.processAnswer(_.codecPreferences,_._answerSdp,function(){p(_.stream)},I)},I)}):Promise.resolve(this.stream)},e.prototype._setInputTracksForUnifiedPlan=function(r,i){var _=this;if(!i)return Promise.reject(new y("Can not set input stream to null while in a call"));if(!i.getAudioTracks().length)return Promise.reject(new y("Supplied input stream has no audio tracks"));var S=this.stream,p=function(){return _.mute(_.isMuted),Promise.resolve(_.stream)};if(!S)this.stream=r?b(i):i;else return this._shouldManageStream&&this._stopStream(S),this._sender||(this._sender=this.version.pc.getSenders()[0]),this._sender.replaceTrack(i.getAudioTracks()[0]).then(function(){return _._updateInputStreamSource(i),p()});return p()},e.prototype._onInputDevicesChanged=function(){if(this.stream){var r=this.stream.getAudioTracks().every(function(i){return i.readyState==="ended"});r&&this._shouldManageStream&&this.openWithConstraints(!0)}},e.prototype._onIceGatheringFailure=function(r){this._hasIceGatheringFailures=!0,this.onicegatheringfailure(r)},e.prototype._onMediaConnectionStateChange=function(r){var i=this._iceState;if(!(i===r||r!=="connected"&&r!=="disconnected"&&r!=="failed")){this._iceState=r;var _=void 0;switch(r){case"connected":i==="disconnected"||i==="failed"?(_="ICE liveliness check succeeded. Connection with Twilio restored",this._log.info(_),this.onreconnected(_)):(_="Media connection established.",this._log.info(_),this.onconnected(_)),this._stopIceGatheringTimeout(),this._hasIceGatheringFailures=!1;break;case"disconnected":_="ICE liveliness check failed. May be having trouble connecting to Twilio",this._log.info(_),this.ondisconnected(_);break;case"failed":_="Connection with Twilio was interrupted.",this._log.info(_),this.onfailed(_);break}}},e.prototype._setSinkIds=function(r){return this._isSinkSupported?(this.sinkIds=new Set(r.forEach?r:[r]),this.version?this._updateAudioOutputs():Promise.resolve()):Promise.reject(new s("Audio output selection is not supported by this browser"))},e.prototype._startIceGatheringTimeout=function(){var i=this;this._stopIceGatheringTimeout(),this._iceGatheringTimeoutId=setTimeout(function(){i._onIceGatheringFailure(c)},A)},e.prototype._stopIceGatheringTimeout=function(){clearInterval(this._iceGatheringTimeoutId)},e.prototype._updateAudioOutputs=function(){var i=Array.from(this.sinkIds).filter(function(I){return!this.outputs.has(I)},this),_=Array.from(this.outputs.keys()).filter(function(I){return!this.sinkIds.has(I)},this),S=this,p=i.map(this._createAudioOutput,this);return Promise.all(p).then(function(){return Promise.all(_.map(S._removeAudioOutput,S))})},e.prototype._createAudio=function(i){var _=new Audio(i);return this.onaudio(_),_},e.prototype._createAudioOutput=function(i){var _=null;this._mediaStreamSource&&(_=this._audioContext.createMediaStreamDestination(),this._mediaStreamSource.connect(_));var S=this._createAudio();f(S,_&&_.stream?_.stream:this.pcStream);var p=this;return S.setSinkId(i).then(function(){return S.play()}).then(function(){p.outputs.set(i,{audio:S,dest:_})})},e.prototype._removeAudioOutputs=function(){return this._masterAudio&&typeof this._masterAudioDeviceId<"u"&&(this._disableOutput(this,this._masterAudioDeviceId),this.outputs.delete(this._masterAudioDeviceId),this._masterAudioDeviceId=null,this._masterAudio.paused||this._masterAudio.pause(),typeof this._masterAudio.srcObject<"u"?this._masterAudio.srcObject=null:this._masterAudio.src="",this._masterAudio=null),Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)},e.prototype._disableOutput=function(i,_){var S=i.outputs.get(_);S&&(S.audio&&(S.audio.pause(),S.audio.src=""),S.dest&&S.dest.disconnect())},e.prototype._reassignMasterOutput=function(i,_){var S=i.outputs.get(_);i.outputs.delete(_);var p=this,I=Array.from(i.outputs.keys())[0]||"default";return S.audio.setSinkId(I).then(function(){p._disableOutput(i,I),i.outputs.set(I,S),i._masterAudioDeviceId=I}).catch(function(){i.outputs.set(_,S),p._log.info("Could not reassign master output. Attempted to roll back.")})},e.prototype._removeAudioOutput=function(i){return this._masterAudioDeviceId===i?this._reassignMasterOutput(this,i):(this._disableOutput(this,i),this.outputs.delete(i),Promise.resolve())},e.prototype._onAddTrack=function(i,_){var S=i._masterAudio=this._createAudio();f(S,_),S.play();var p=Array.from(i.outputs.keys())[0]||"default";i._masterAudioDeviceId=p,i.outputs.set(p,{audio:S});try{i._mediaStreamSource=i._audioContext.createMediaStreamSource(_)}catch(I){this._log.warn("Unable to create a MediaStreamSource from onAddTrack",I),this._mediaStreamSource=null}i.pcStream=_,i._updateAudioOutputs()},e.prototype._fallbackOnAddTrack=function(i,_){var S=document&&document.createElement("audio");S.autoplay=!0,f(S,_)||i._log.info("Error attaching stream to element."),i.outputs.set("default",{audio:S})},e.prototype._setEncodingParameters=function(r){if(!(!r||!this._sender||typeof this._sender.getParameters!="function"||typeof this._sender.setParameters!="function")){var i=this._sender.getParameters();!i.priority&&!(i.encodings&&i.encodings.length)||(i.priority="high",i.encodings&&i.encodings.length&&i.encodings.forEach(function(_){_.priority="high",_.networkPriority="high"}),this._sender.setParameters(i))}},e.prototype._setupPeerConnection=function(r,i){var _=this,S=this,p=new(this.options.rtcpcFactory||a)({RTCPeerConnection:this.options.RTCPeerConnection});p.create(r,i),t(p.pc,this.stream);var I="ontrack"in p.pc?"ontrack":"onaddstream";return p.pc[I]=function(D){var E=S._remoteStream=D.stream||D.streams[0];typeof p.pc.getSenders=="function"&&(_._sender=p.pc.getSenders()[0]),S._isSinkSupported?S._onAddTrack(S,E):S._fallbackOnAddTrack(S,E),S._startPollingVolume()},p},e.prototype._maybeSetIceAggressiveNomination=function(r){return this.options.forceAggressiveIceNomination?P(r):r},e.prototype._setupChannel=function(){var r=this,i=this.version.pc;this.version.pc.onopen=function(){r.status="open",r.onopen()},this.version.pc.onstatechange=function(){r.version.pc&&r.version.pc.readyState==="stable"&&(r.status="open",r.onopen())},this.version.pc.onsignalingstatechange=function(){var _=i.signalingState;r._log.info('signalingState is "'+_+'"'),r.version.pc&&r.version.pc.signalingState==="stable"&&(r.status="open",r.onopen()),r.onsignalingstatechange(i.signalingState)},i.onconnectionstatechange=function(_){var S=i.connectionState;if(!S&&_&&_.target){var p=_.target;S=p.connectionState||p.connectionState_,r._log.info("pc.connectionState not detected. Using target PC. State="+S)}S?r._log.info('pc.connectionState is "'+S+'"'):r._log.warn('onconnectionstatechange detected but state is "'+S+'"'),r.onpcconnectionstatechange(S),r._onMediaConnectionStateChange(S)},i.onicecandidate=function(_){var S=_.candidate;S&&(r._hasIceCandidates=!0,r.onicecandidate(S),r._setupRTCIceTransportListener()),r._log.info("ICE Candidate: "+JSON.stringify(S))},i.onicegatheringstatechange=function(){var _=i.iceGatheringState;_==="gathering"?r._startIceGatheringTimeout():_==="complete"&&(r._stopIceGatheringTimeout(),r._hasIceCandidates||r._onIceGatheringFailure(w),r._hasIceCandidates&&r._hasIceGatheringFailures&&r._startIceGatheringTimeout()),r._log.info('pc.iceGatheringState is "'+i.iceGatheringState+'"'),r.onicegatheringstatechange(_)},i.oniceconnectionstatechange=function(){r._log.info('pc.iceConnectionState is "'+i.iceConnectionState+'"'),r.oniceconnectionstatechange(i.iceConnectionState),r._onMediaConnectionStateChange(i.iceConnectionState)}},e.prototype._initializeMediaStream=function(r,i){return this.status==="open"?!1:this.pstream.status==="disconnected"?(this.onerror({info:{code:31e3,message:"Cannot establish connection. Client is disconnected",twilioError:new d.ConnectionDisconnected}}),this.close(),!1):(this.version=this._setupPeerConnection(r,i),this._setupChannel(),!0)},e.prototype._removeReconnectionListeners=function(){this.pstream&&(this.pstream.removeListener("answer",this._onAnswerOrRinging),this.pstream.removeListener("hangup",this._onHangup))},e.prototype._setupRTCDtlsTransportListener=function(){var r=this,i=this.getRTCDtlsTransport();if(!(!i||i.onstatechange)){var _=function(){r._log.info('dtlsTransportState is "'+i.state+'"'),r.ondtlstransportstatechange(i.state)};_(),i.onstatechange=_}},e.prototype._setupRTCIceTransportListener=function(){var r=this,i=this._getRTCIceTransport();!i||i.onselectedcandidatepairchange||(i.onselectedcandidatepairchange=function(){return r.onselectedcandidatepairchange(i.getSelectedCandidatePair())})},e.prototype.iceRestart=function(){var r=this;this.options.enableIceRestart&&(this._log.info("Attempting to restart ICE..."),this._hasIceCandidates=!1,this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{iceRestart:!0}).then(function(){r._removeReconnectionListeners(),r._onAnswerOrRinging=function(i){if(r._removeReconnectionListeners(),!i.sdp||r.version.pc.signalingState!=="have-local-offer"){var _="Invalid state or param during ICE Restart:"+("hasSdp:"+!!i.sdp+", signalingState:"+r.version.pc.signalingState);r._log.info(_);return}var S=r._maybeSetIceAggressiveNomination(i.sdp);r._answerSdp=S,r.status!=="closed"&&r.version.processAnswer(r.codecPreferences,S,null,function(p){var I=p&&p.message?p.message:p;r._log.info("Failed to process answer during ICE Restart. Error: "+I)})},r._onHangup=function(){r._log.info("Received hangup during ICE Restart"),r._removeReconnectionListeners()},r.pstream.on("answer",r._onAnswerOrRinging),r.pstream.on("hangup",r._onHangup),r.pstream.reinvite(r.version.getSDP(),r.callSid)}).catch(function(i){var _=i&&i.message?i.message:i;r._log.info("Failed to createOffer during ICE Restart. Error: "+_),r.onfailed(_)}))},e.prototype.makeOutgoingCall=function(r,i,_,S,p,I){var D=this;if(!this._initializeMediaStream(S,p))return;var E=this;this.callSid=_;function T(){E.options&&E._setEncodingParameters(E.options.dscp),I(E.version.pc)}function M(N){var R=N.message||N;E.onerror({info:{code:31e3,message:"Error processing answer: "+R,twilioError:new o.ClientRemoteDescFailed}})}this._onAnswerOrRinging=function(N){if(N.sdp){var R=D._maybeSetIceAggressiveNomination(N.sdp);E._answerSdp=R,E.status!=="closed"&&E.version.processAnswer(D.codecPreferences,R,T,M),E.pstream.removeListener("answer",E._onAnswerOrRinging),E.pstream.removeListener("ringing",E._onAnswerOrRinging)}},this.pstream.on("answer",this._onAnswerOrRinging),this.pstream.on("ringing",this._onAnswerOrRinging);function g(){E.status!=="closed"&&(E.pstream.invite(E.version.getSDP(),E.callSid,E.options.preflight,i),E._setupRTCDtlsTransportListener())}function $(N){var R=N.message||N;E.onerror({info:{code:31e3,message:"Error creating the offer: "+R,twilioError:new o.ClientLocalDescFailed}})}this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{audio:!0},g,$)},e.prototype.answerIncomingCall=function(r,i,_,S,p){if(!this._initializeMediaStream(_,S))return;i=this._maybeSetIceAggressiveNomination(i),this._answerSdp=i.replace(/^a=setup:actpass$/gm,"a=setup:passive"),this.callSid=r;var I=this;function D(){I.status!=="closed"&&(I.pstream.answer(I.version.getSDP(),r),I.options&&I._setEncodingParameters(I.options.dscp),p(I.version.pc),I._setupRTCDtlsTransportListener())}function E(T){var M=T.message||T;I.onerror({info:{code:31e3,message:"Error creating the answer: "+M,twilioError:new o.ClientRemoteDescFailed}})}this.version.processSDP(this.options.maxAverageBitrate,this.codecPreferences,i,{audio:!0},D,E)},e.prototype.close=function(){this.version&&this.version.pc&&(this.version.pc.signalingState!=="closed"&&this.version.pc.close(),this.version.pc=null),this.stream&&(this.mute(!1),this._stopStream(this.stream)),this.stream=null,this._removeReconnectionListeners(),this._stopIceGatheringTimeout(),Promise.all(this._removeAudioOutputs()).catch(function(){}),this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._inputAnalyser&&this._inputAnalyser.disconnect(),this._outputAnalyser&&this._outputAnalyser.disconnect(),this._inputAnalyser2&&this._inputAnalyser2.disconnect(),this._outputAnalyser2&&this._outputAnalyser2.disconnect(),this.status="closed",this.onclose()},e.prototype.reject=function(r){this.callSid=r},e.prototype.ignore=function(r){this.callSid=r},e.prototype.mute=function(r){if(this.isMuted=r,!!this.stream)if(this._sender&&this._sender.track)this._sender.track.enabled=!r;else{var i=typeof this.stream.getAudioTracks=="function"?this.stream.getAudioTracks():this.stream.audioTracks;i.forEach(function(_){_.enabled=!r})}},e.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var i=this,_=this.version.pc;if(!_)return this._log.info("No RTCPeerConnection available to call createDTMFSender on"),null;if(typeof _.getSenders=="function"&&(typeof RTCDTMFSender=="function"||typeof RTCDtmfSender=="function")){var S=_.getSenders().find(function(I){return I.dtmf});if(S)return this._log.info("Using RTCRtpSender#dtmf"),this._dtmfSender=S.dtmf,this._dtmfSender}if(typeof _.createDTMFSender=="function"&&typeof _.getLocalStreams=="function"){var p=_.getLocalStreams().map(function(I){var D=i._getAudioTracks(I);return D&&D[0]})[0];return p?(this._log.info("Creating RTCDTMFSender"),this._dtmfSender=_.createDTMFSender(p),this._dtmfSender):(this._log.info("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),null)}return this._log.info("RTCPeerConnection does not support RTCDTMFSender"),this._dtmfSenderUnsupported=!0,null},e.prototype.getRTCDtlsTransport=function(){var i=this.version&&this.version.pc&&typeof this.version.pc.getSenders=="function"&&this.version.pc.getSenders()[0];return i&&i.transport||null},e.prototype._canStopMediaStreamTrack=function(){return typeof MediaStreamTrack.prototype.stop=="function"},e.prototype._getAudioTracks=function(r){return typeof r.getAudioTracks=="function"?r.getAudioTracks():r.audioTracks},e.prototype._getRTCIceTransport=function(){var i=this.getRTCDtlsTransport();return i&&i.iceTransport||null},e.protocol=function(){return a.test()?new a:null}();function t(r,i){typeof r.addTrack=="function"?i.getAudioTracks().forEach(function(_){r.addTrack(_,i)}):r.addStream(i)}function b(r){var i=typeof MediaStream<"u"?new MediaStream:new webkitMediaStream;return r.getAudioTracks().forEach(i.addTrack,i),i}function C(r,i){typeof r.removeTrack=="function"?r.getSenders().forEach(function(_){r.removeTrack(_)}):r.removeStream(i)}function f(r,i){if(typeof r.srcObject<"u")r.srcObject=i;else if(typeof r.mozSrcObject<"u")r.mozSrcObject=i;else if(typeof r.src<"u"){var _=r.options.window||window;r.src=(_.URL||_.webkitURL).createObjectURL(i)}else return!1;return!0}return e.enabled=a.test(),Ur=e,Ur}var qr,no;function io(){if(no)return qr;no=1;var l=qa(),y=to(),o=y.test;function s(){return o()}function d(){return typeof RTCIceGatherer<"u"?"ORTC":"WebRTC"}return qr={enabled:s,getMediaEngine:d,PeerConnection:l},qr}var Br,oo;function Ba(){if(oo)return Br;oo=1;var l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},y=he().NotSupportedError,o=ke();function s(d,h){return h=h||{},h.util=h.util||o,h.navigator=h.navigator||(typeof navigator<"u"?navigator:null),new Promise(function(v,a){if(!h.navigator)throw new y("getUserMedia is not supported");switch("function"){case l(h.navigator.mediaDevices&&h.navigator.mediaDevices.getUserMedia):return v(h.navigator.mediaDevices.getUserMedia(d));case l(h.navigator.webkitGetUserMedia):return h.navigator.webkitGetUserMedia(d,v,a);case l(h.navigator.mozGetUserMedia):return h.navigator.mozGetUserMedia(d,v,a);case l(h.navigator.getUserMedia):return h.navigator.getUserMedia(d,v,a);default:throw new y("getUserMedia is not supported")}}).catch(function(v){throw h.util.isFirefox()&&v.name==="NotReadableError"?new y(`Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.
Related Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324`):v})}return Br=s,Br}var Oe={},lt={},ao;function Ga(){if(ao)return lt;ao=1,Object.defineProperty(lt,"__esModule",{value:!0});var l=function(){function y(){var o=this;this._promise=new Promise(function(s,d){o._resolve=s,o._reject=d})}return Object.defineProperty(y.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),y.prototype.reject=function(o){this._reject(o)},y.prototype.resolve=function(o){this._resolve(o)},y}();return lt.default=l,lt}var so;function Wa(){if(so)return Oe;so=1;var l=Oe&&Oe.__awaiter||function(d,h,v,a){function u(P){return P instanceof v?P:new v(function(A){A(P)})}return new(v||(v=Promise))(function(P,A){function w(n){try{m(a.next(n))}catch(e){A(e)}}function c(n){try{m(a.throw(n))}catch(e){A(e)}}function m(n){n.done?P(n.value):u(n.value).then(w,c)}m((a=a.apply(d,h||[])).next())})},y=Oe&&Oe.__generator||function(d,h){var v={label:0,sent:function(){if(P[0]&1)throw P[1];return P[1]},trys:[],ops:[]},a,u,P,A;return A={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(A[Symbol.iterator]=function(){return this}),A;function w(m){return function(n){return c([m,n])}}function c(m){if(a)throw new TypeError("Generator is already executing.");for(;v;)try{if(a=1,u&&(P=m[0]&2?u.return:m[0]?u.throw||((P=u.return)&&P.call(u),0):u.next)&&!(P=P.call(u,m[1])).done)return P;switch(u=0,P&&(m=[m[0]&2,P.value]),m[0]){case 0:case 1:P=m;break;case 4:return v.label++,{value:m[1],done:!1};case 5:v.label++,u=m[1],m=[0];continue;case 7:m=v.ops.pop(),v.trys.pop();continue;default:if(P=v.trys,!(P=P.length>0&&P[P.length-1])&&(m[0]===6||m[0]===2)){v=0;continue}if(m[0]===3&&(!P||m[1]>P[0]&&m[1]<P[3])){v.label=m[1];break}if(m[0]===6&&v.label<P[1]){v.label=P[1],P=m;break}if(P&&v.label<P[2]){v.label=P[2],v.ops.push(m);break}P[2]&&v.ops.pop(),v.trys.pop();continue}m=h.call(d,v)}catch(n){m=[6,n],u=0}finally{a=P=0}if(m[0]&5)throw m[1];return{value:m[0]?m[1]:void 0,done:!0}}};Object.defineProperty(Oe,"__esModule",{value:!0});var o=Ga(),s=function(){function d(){this._operations=[]}return d.prototype.enqueue=function(h){var v=!!this._operations.length,a=new o.default;return this._operations.push({deferred:a,callback:h}),v||this._processQueue(),a.promise},d.prototype._processQueue=function(){return l(this,void 0,void 0,function(){var h,v,a,u,P,A,w;return y(this,function(c){switch(c.label){case 0:if(!this._operations.length)return[3,5];h=this._operations[0],v=h.deferred,a=h.callback,u=void 0,P=void 0,A=void 0,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,a()];case 2:return u=c.sent(),A=!0,[3,4];case 3:return w=c.sent(),P=w,[3,4];case 4:return this._operations.shift(),A?v.resolve(u):v.reject(P),[3,0];case 5:return[2]}})})},d}();return Oe.AsyncQueue=s,Oe}var ft={},Gr={exports:{}},uo;function Va(){return uo||(uo=1,function(l){(function(y){var o=Object.prototype,s=o.hasOwnProperty,d,h=typeof Symbol=="function"?Symbol:{},v=h.iterator||"@@iterator",a=h.asyncIterator||"@@asyncIterator",u=h.toStringTag||"@@toStringTag",P=y.regeneratorRuntime;if(P){l.exports=P;return}P=y.regeneratorRuntime=l.exports;function A(R,O,F,B){var q=O&&O.prototype instanceof b?O:b,x=Object.create(q.prototype),j=new g(B||[]);return x._invoke=D(R,F,j),x}P.wrap=A;function w(R,O,F){try{return{type:"normal",arg:R.call(O,F)}}catch(B){return{type:"throw",arg:B}}}var c="suspendedStart",m="suspendedYield",n="executing",e="completed",t={};function b(){}function C(){}function f(){}var r={};r[v]=function(){return this};var i=Object.getPrototypeOf,_=i&&i(i($([])));_&&_!==o&&s.call(_,v)&&(r=_);var S=f.prototype=b.prototype=Object.create(r);C.prototype=S.constructor=f,f.constructor=C,f[u]=C.displayName="GeneratorFunction";function p(R){["next","throw","return"].forEach(function(O){R[O]=function(F){return this._invoke(O,F)}})}P.isGeneratorFunction=function(R){var O=typeof R=="function"&&R.constructor;return O?O===C||(O.displayName||O.name)==="GeneratorFunction":!1},P.mark=function(R){return Object.setPrototypeOf?Object.setPrototypeOf(R,f):(R.__proto__=f,u in R||(R[u]="GeneratorFunction")),R.prototype=Object.create(S),R},P.awrap=function(R){return{__await:R}};function I(R){function O(q,x,j,L){var W=w(R[q],R,x);if(W.type==="throw")L(W.arg);else{var H=W.arg,Y=H.value;return Y&&typeof Y=="object"&&s.call(Y,"__await")?Promise.resolve(Y.__await).then(function(J){O("next",J,j,L)},function(J){O("throw",J,j,L)}):Promise.resolve(Y).then(function(J){H.value=J,j(H)},L)}}var F;function B(q,x){function j(){return new Promise(function(L,W){O(q,x,L,W)})}return F=F?F.then(j,j):j()}this._invoke=B}p(I.prototype),I.prototype[a]=function(){return this},P.AsyncIterator=I,P.async=function(R,O,F,B){var q=new I(A(R,O,F,B));return P.isGeneratorFunction(O)?q:q.next().then(function(x){return x.done?x.value:q.next()})};function D(R,O,F){var B=c;return function(x,j){if(B===n)throw new Error("Generator is already running");if(B===e){if(x==="throw")throw j;return N()}for(F.method=x,F.arg=j;;){var L=F.delegate;if(L){var W=E(L,F);if(W){if(W===t)continue;return W}}if(F.method==="next")F.sent=F._sent=F.arg;else if(F.method==="throw"){if(B===c)throw B=e,F.arg;F.dispatchException(F.arg)}else F.method==="return"&&F.abrupt("return",F.arg);B=n;var H=w(R,O,F);if(H.type==="normal"){if(B=F.done?e:m,H.arg===t)continue;return{value:H.arg,done:F.done}}else H.type==="throw"&&(B=e,F.method="throw",F.arg=H.arg)}}}function E(R,O){var F=R.iterator[O.method];if(F===d){if(O.delegate=null,O.method==="throw"){if(R.iterator.return&&(O.method="return",O.arg=d,E(R,O),O.method==="throw"))return t;O.method="throw",O.arg=new TypeError("The iterator does not provide a 'throw' method")}return t}var B=w(F,R.iterator,O.arg);if(B.type==="throw")return O.method="throw",O.arg=B.arg,O.delegate=null,t;var q=B.arg;if(!q)return O.method="throw",O.arg=new TypeError("iterator result is not an object"),O.delegate=null,t;if(q.done)O[R.resultName]=q.value,O.next=R.nextLoc,O.method!=="return"&&(O.method="next",O.arg=d);else return q;return O.delegate=null,t}p(S),S[u]="Generator",S[v]=function(){return this},S.toString=function(){return"[object Generator]"};function T(R){var O={tryLoc:R[0]};1 in R&&(O.catchLoc=R[1]),2 in R&&(O.finallyLoc=R[2],O.afterLoc=R[3]),this.tryEntries.push(O)}function M(R){var O=R.completion||{};O.type="normal",delete O.arg,R.completion=O}function g(R){this.tryEntries=[{tryLoc:"root"}],R.forEach(T,this),this.reset(!0)}P.keys=function(R){var O=[];for(var F in R)O.push(F);return O.reverse(),function B(){for(;O.length;){var q=O.pop();if(q in R)return B.value=q,B.done=!1,B}return B.done=!0,B}};function $(R){if(R){var O=R[v];if(O)return O.call(R);if(typeof R.next=="function")return R;if(!isNaN(R.length)){var F=-1,B=function q(){for(;++F<R.length;)if(s.call(R,F))return q.value=R[F],q.done=!1,q;return q.value=d,q.done=!0,q};return B.next=B}}return{next:N}}P.values=$;function N(){return{value:d,done:!0}}g.prototype={constructor:g,reset:function(R){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(M),!R)for(var O in this)O.charAt(0)==="t"&&s.call(this,O)&&!isNaN(+O.slice(1))&&(this[O]=d)},stop:function(){this.done=!0;var R=this.tryEntries[0],O=R.completion;if(O.type==="throw")throw O.arg;return this.rval},dispatchException:function(R){if(this.done)throw R;var O=this;function F(W,H){return x.type="throw",x.arg=R,O.next=W,H&&(O.method="next",O.arg=d),!!H}for(var B=this.tryEntries.length-1;B>=0;--B){var q=this.tryEntries[B],x=q.completion;if(q.tryLoc==="root")return F("end");if(q.tryLoc<=this.prev){var j=s.call(q,"catchLoc"),L=s.call(q,"finallyLoc");if(j&&L){if(this.prev<q.catchLoc)return F(q.catchLoc,!0);if(this.prev<q.finallyLoc)return F(q.finallyLoc)}else if(j){if(this.prev<q.catchLoc)return F(q.catchLoc,!0)}else if(L){if(this.prev<q.finallyLoc)return F(q.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(R,O){for(var F=this.tryEntries.length-1;F>=0;--F){var B=this.tryEntries[F];if(B.tryLoc<=this.prev&&s.call(B,"finallyLoc")&&this.prev<B.finallyLoc){var q=B;break}}q&&(R==="break"||R==="continue")&&q.tryLoc<=O&&O<=q.finallyLoc&&(q=null);var x=q?q.completion:{};return x.type=R,x.arg=O,q?(this.method="next",this.next=q.finallyLoc,t):this.complete(x)},complete:function(R,O){if(R.type==="throw")throw R.arg;return R.type==="break"||R.type==="continue"?this.next=R.arg:R.type==="return"?(this.rval=this.arg=R.arg,this.method="return",this.next="end"):R.type==="normal"&&O&&(this.next=O),t},finish:function(R){for(var O=this.tryEntries.length-1;O>=0;--O){var F=this.tryEntries[O];if(F.finallyLoc===R)return this.complete(F.completion,F.afterLoc),M(F),t}},catch:function(R){for(var O=this.tryEntries.length-1;O>=0;--O){var F=this.tryEntries[O];if(F.tryLoc===R){var B=F.completion;if(B.type==="throw"){var q=B.arg;M(F)}return q}}throw new Error("illegal catch attempt")},delegateYield:function(R,O,F){return this.delegate={iterator:$(R),resultName:O,nextLoc:F},this.method==="next"&&(this.arg=d),t}}})(function(){return this}()||Function("return this")())}(Gr)),Gr.exports}var Wr,co;function Ha(){if(co)return Wr;co=1;var l=function(){return this}()||Function("return this")(),y=l.regeneratorRuntime&&Object.getOwnPropertyNames(l).indexOf("regeneratorRuntime")>=0,o=y&&l.regeneratorRuntime;if(l.regeneratorRuntime=void 0,Wr=Va(),y)l.regeneratorRuntime=o;else try{delete l.regeneratorRuntime}catch{l.regeneratorRuntime=void 0}return Wr}var Vr,lo;function za(){return lo||(lo=1,Vr=Ha()),Vr}var dt={},fo;function $a(){if(fo)return dt;fo=1;var l=function(){function s(d,h){for(var v=0;v<h.length;v++){var a=h[v];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}return function(d,h,v){return h&&s(d.prototype,h),v&&s(d,v),d}}();function y(s,d){if(!(s instanceof d))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(dt,"__esModule",{value:!0});var o=function(){function s(){var d=this;y(this,s),this.promise=new Promise(function(h,v){d._resolve=h,d._reject=v})}return l(s,[{key:"reject",get:function(){return this._reject}},{key:"resolve",get:function(){return this._resolve}}]),s}();return dt.default=o,dt}var pt={},po;function Ja(){if(po)return pt;po=1;var l=function(){function d(h,v){for(var a=0;a<v.length;a++){var u=v[a];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(h,u.key,u)}}return function(h,v,a){return v&&d(h.prototype,v),a&&d(h,a),h}}();function y(d,h){if(!(d instanceof h))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(pt,"__esModule",{value:!0});var o=me(),s=function(){function d(){y(this,d),this._eventEmitter=new o.EventEmitter}return l(d,[{key:"addEventListener",value:function(v,a){return this._eventEmitter.addListener(v,a)}},{key:"dispatchEvent",value:function(v){for(var a,u=arguments.length,P=Array(u>1?u-1:0),A=1;A<u;A++)P[A-1]=arguments[A];return(a=this._eventEmitter).emit.apply(a,[v].concat(P))}},{key:"removeEventListener",value:function(v,a){return this._eventEmitter.removeListener(v,a)}}]),d}();return pt.default=s,pt}var ho;function Ya(){if(ho)return ft;ho=1;var l=za(),y=s(l),o=function(){function c(m,n){for(var e=0;e<n.length;e++){var t=n[e];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(m,t.key,t)}}return function(m,n,e){return n&&c(m.prototype,n),e&&c(m,e),m}}();function s(c){return c&&c.__esModule?c:{default:c}}function d(c,m){if(!(c instanceof m))throw new TypeError("Cannot call a class as a function")}function h(c,m){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return m&&(typeof m=="object"||typeof m=="function")?m:c}function v(c,m){if(typeof m!="function"&&m!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof m);c.prototype=Object.create(m&&m.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),m&&(Object.setPrototypeOf?Object.setPrototypeOf(c,m):c.__proto__=m)}var a=function(c,m,n,e){return new(n||(n=Promise))(function(t,b){function C(i){try{r(e.next(i))}catch(_){b(_)}}function f(i){try{r(e.throw(i))}catch(_){b(_)}}function r(i){i.done?t(i.value):new n(function(_){_(i.value)}).then(C,f)}r((e=e.apply(c,m||[])).next())})};Object.defineProperty(ft,"__esModule",{value:!0});var u=$a(),P=Ja(),A=function(c){v(m,c);function m(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};d(this,m);var b=h(this,(m.__proto__||Object.getPrototypeOf(m)).call(this));return b._audioNode=null,b._pendingPlayDeferreds=[],b._loop=!1,b._src="",b._sinkId="default",typeof e!="string"&&(t=e),b._audioContext=n,b._audioElement=new(t.AudioFactory||Audio),b._bufferPromise=b._createPlayDeferred().promise,b._destination=b._audioContext.destination,b._gainNode=b._audioContext.createGain(),b._gainNode.connect(b._destination),b._XMLHttpRequest=t.XMLHttpRequestFactory||XMLHttpRequest,b.addEventListener("canplaythrough",function(){b._resolvePlayDeferreds()}),typeof e=="string"&&(b.src=e),b}return o(m,[{key:"load",value:function(){this._load(this._src)}},{key:"pause",value:function(){this.paused||(this._audioElement.pause(),this._audioNode.stop(),this._audioNode.disconnect(this._gainNode),this._audioNode=null,this._rejectPlayDeferreds(new Error("The play() request was interrupted by a call to pause().")))}},{key:"play",value:function(){return a(this,void 0,void 0,y.default.mark(function e(){var t=this,b;return y.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.paused){f.next=6;break}return f.next=3,this._bufferPromise;case 3:if(this.paused){f.next=5;break}return f.abrupt("return");case 5:throw new Error("The play() request was interrupted by a call to pause().");case 6:return this._audioNode=this._audioContext.createBufferSource(),this._audioNode.loop=this.loop,this._audioNode.addEventListener("ended",function(){t._audioNode&&t._audioNode.loop||t.dispatchEvent("ended")}),f.next=11,this._bufferPromise;case 11:if(b=f.sent,!this.paused){f.next=14;break}throw new Error("The play() request was interrupted by a call to pause().");case 14:if(this._audioNode.buffer=b,this._audioNode.connect(this._gainNode),this._audioNode.start(),!this._audioElement.srcObject){f.next=19;break}return f.abrupt("return",this._audioElement.play());case 19:case"end":return f.stop()}},e,this)}))}},{key:"setSinkId",value:function(e){return a(this,void 0,void 0,y.default.mark(function t(){return y.default.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(typeof this._audioElement.setSinkId=="function"){C.next=2;break}throw new Error("This browser does not support setSinkId.");case 2:if(e!==this.sinkId){C.next=4;break}return C.abrupt("return");case 4:if(e!=="default"){C.next=11;break}return this.paused||this._gainNode.disconnect(this._destination),this._audioElement.srcObject=null,this._destination=this._audioContext.destination,this._gainNode.connect(this._destination),this._sinkId=e,C.abrupt("return");case 11:return C.next=13,this._audioElement.setSinkId(e);case 13:if(!this._audioElement.srcObject){C.next=15;break}return C.abrupt("return");case 15:this._gainNode.disconnect(this._audioContext.destination),this._destination=this._audioContext.createMediaStreamDestination(),this._audioElement.srcObject=this._destination.stream,this._sinkId=e,this._gainNode.connect(this._destination);case 20:case"end":return C.stop()}},t,this)}))}},{key:"_createPlayDeferred",value:function(){var e=new u.default;return this._pendingPlayDeferreds.push(e),e}},{key:"_load",value:function(e){var t=this;this._src&&this._src!==e&&this.pause(),this._src=e,this._bufferPromise=new Promise(function(b,C){return a(t,void 0,void 0,y.default.mark(function f(){var r;return y.default.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(e){_.next=2;break}return _.abrupt("return",this._createPlayDeferred().promise);case 2:return _.next=4,w(this._audioContext,this._XMLHttpRequest,e);case 4:r=_.sent,this.dispatchEvent("canplaythrough"),b(r);case 7:case"end":return _.stop()}},f,this)}))})}},{key:"_rejectPlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(b){var C=b.reject;return C(e)})}},{key:"_resolvePlayDeferreds",value:function(e){var t=this._pendingPlayDeferreds;t.splice(0,t.length).forEach(function(b){var C=b.resolve;return C(e)})}},{key:"destination",get:function(){return this._destination}},{key:"loop",get:function(){return this._loop},set:function(e){if(!e&&this.loop&&!this.paused){var t=function C(){b._audioNode.removeEventListener("ended",C),b.pause()},b=this;this._audioNode.addEventListener("ended",t)}this._loop=e}},{key:"muted",get:function(){return this._gainNode.gain.value===0},set:function(e){this._gainNode.gain.value=e?0:1}},{key:"paused",get:function(){return this._audioNode===null}},{key:"src",get:function(){return this._src},set:function(e){this._load(e)}},{key:"srcObject",get:function(){return this._audioElement.srcObject},set:function(e){this._audioElement.srcObject=e}},{key:"sinkId",get:function(){return this._sinkId}}]),m}(P.default);ft.default=A;function w(c,m,n){return a(this,void 0,void 0,y.default.mark(function e(){var t,b;return y.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return t=new m,t.open("GET",n,!0),t.responseType="arraybuffer",f.next=5,new Promise(function(r){t.addEventListener("load",r),t.send()});case 5:return b=f.sent,f.prev=6,f.abrupt("return",c.decodeAudioData(b.target.response));case 10:return f.prev=10,f.t0=f.catch(6),f.abrupt("return",new Promise(function(r){c.decodeAudioData(b.target.response,r)}));case 13:case"end":return f.stop()}},e,this,[[6,10]])}))}return ft}var Hr,vo;function Ka(){if(vo)return Hr;vo=1;var l=Ya();return Hr=l.default,Hr}var zr,mo;function Xa(){if(mo)return zr;mo=1;var l=Wa().AsyncQueue,y=Ka(),o=he().InvalidArgumentError;function s(h,v,a){if(!(this instanceof s))return new s(h,v,a);if(!h||!v)throw new o("name and url are required arguments");a=Object.assign({AudioFactory:typeof Audio<"u"?Audio:null,maxDuration:0,shouldLoop:!1},a),a.AudioPlayer=a.audioContext?y.bind(y,a.audioContext):a.AudioFactory,Object.defineProperties(this,{_activeEls:{value:new Map},_Audio:{value:a.AudioPlayer},_isSinkSupported:{value:a.AudioFactory!==null&&typeof a.AudioFactory.prototype.setSinkId=="function"},_maxDuration:{value:a.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_operations:{value:new l},_playPromise:{value:null,writable:!0},_shouldLoop:{value:a.shouldLoop},_sinkIds:{value:["default"]},isPlaying:{enumerable:!0,get:function(){return!!this._playPromise}},name:{enumerable:!0,value:h},url:{enumerable:!0,value:v}}),this._Audio&&this._play(!0,!1)}function d(h){h&&(h.pause(),h.src="",h.srcObject=null,h.load())}return s.prototype._playAudioElement=function(v,a,u){var P=this,A=this._activeEls.get(v);if(!A)throw new o('sinkId: "'+v+`" doesn't have an audio element`);return A.muted=!!a,A.loop=!!u,A.play().then(function(){return A}).catch(function(w){throw d(A),P._activeEls.delete(v),w})},s.prototype._play=function(v,a){this.isPlaying&&this._stop(),this._maxDuration>0&&(this._maxDurationTimeout=setTimeout(this._stop.bind(this),this._maxDuration)),a=typeof a=="boolean"?a:this._shouldLoop;var u=this,P=this._playPromise=Promise.all(this._sinkIds.map(function(w){if(!u._Audio)return Promise.resolve();var c=u._activeEls.get(w);return c?u._playAudioElement(w,v,a):(c=new u._Audio(u.url),typeof c.setAttribute=="function"&&c.setAttribute("crossorigin","anonymous"),new Promise(function(m){c.addEventListener("canplaythrough",m)}).then(function(){return(u._isSinkSupported?c.setSinkId(w):Promise.resolve()).then(function(){return u._activeEls.set(w,c),u._playPromise?u._playAudioElement(w,v,a):Promise.resolve()})}))}));return P},s.prototype._stop=function(){var v=this;this._activeEls.forEach(function(a,u){v._sinkIds.includes(u)?(a.pause(),a.currentTime=0):(d(a),v._activeEls.delete(u))}),clearTimeout(this._maxDurationTimeout),this._playPromise=null,this._maxDurationTimeout=null},s.prototype.setSinkIds=function(v){this._isSinkSupported&&(v=v.forEach?v:[v],[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(v)))},s.prototype.stop=function(){var v=this;this._operations.enqueue(function(){return v._stop(),Promise.resolve()})},s.prototype.play=function(){var v=this;return this._operations.enqueue(function(){return v._play()})},zr=s,zr}var go;function $r(){if(go)return we;go=1;var l=we&&we.__extends||function(){var S=function(p,I){return S=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,E){D.__proto__=E}||function(D,E){for(var T in E)E.hasOwnProperty(T)&&(D[T]=E[T])},S(p,I)};return function(p,I){S(p,I);function D(){this.constructor=p}p.prototype=I===null?Object.create(I):(D.prototype=I.prototype,new D)}}(),y=we&&we.__assign||function(){return y=Object.assign||function(S){for(var p,I=1,D=arguments.length;I<D;I++){p=arguments[I];for(var E in p)Object.prototype.hasOwnProperty.call(p,E)&&(S[E]=p[E])}return S},y.apply(this,arguments)},o=we&&we.__spreadArrays||function(){for(var S=0,p=0,I=arguments.length;p<I;p++)S+=arguments[p].length;for(var D=Array(S),E=0,p=0;p<I;p++)for(var T=arguments[p],M=0,g=T.length;M<g;M++,E++)D[E]=T[M];return D};Object.defineProperty(we,"__esModule",{value:!0});var s=me(),d=Vo(),h=Yr(),v=Ho(),a=he(),u=Me(),P=_n(),A=$o(),w=ke(),c=Ue(),m=Oa(),n=Ki(),e=io(),t=Ba(),b=Xa(),C=3e4,f=2e3,r=!1,i=!1,_=function(S){l(p,S);function p(I,D){var E,T=S.call(this)||this;if(T.audio=null,T.connections=[],T.isInitialized=!1,T.sounds={},T.token=null,T._activeConnection=null,T._chunderURIs=[],T._connectionInputStream=null,T._connectionSinkIds=["default"],T._edge=null,T._enabledSounds=(E={},E[p.SoundName.Disconnect]=!0,E[p.SoundName.Incoming]=!0,E[p.SoundName.Outgoing]=!0,E),T._log=u.default.getInstance(),T._publisher=null,T._region=null,T._status=p.Status.Offline,T.mediaPresence={audio:!0},T.options={allowIncomingWhileBusy:!1,audioConstraints:!0,closeProtection:!1,codecPreferences:[h.default.Codec.PCMU,h.default.Codec.Opus],connectionFactory:h.default,debug:!1,dscp:!0,enableIceRestart:!1,eventgw:"eventgw.twilio.com",forceAggressiveIceNomination:!1,iceServers:[],noRegister:!1,pStreamFactory:n,preflight:!1,rtcConstraints:{},soundFactory:b,sounds:{},warnings:!0},T.regTimer=null,T.soundcache=new Map,T.stream=null,T.destroy=function(){T._disconnectAll(),T._stopRegistrationTimer(),T.audio&&T.audio._unbind(),T.stream&&(T.stream.destroy(),T.stream=null),T._networkInformation&&typeof T._networkInformation.removeEventListener=="function"&&T._networkInformation.removeEventListener("change",T._publishNetworkChange),typeof window<"u"&&window.removeEventListener&&(window.removeEventListener("beforeunload",T._confirmClose),window.removeEventListener("unload",T.destroy),window.removeEventListener("pagehide",T.destroy)),s.EventEmitter.prototype.removeAllListeners.call(T)},T._confirmClose=function(N){if(!T._activeConnection)return"";var R=T.options.closeProtection||!1,O=typeof R!="string"?"A call is currently in-progress. Leaving or reloading this page will end the call.":R;return(N||window.event).returnValue=O,O},T._createDefaultPayload=function(N){var R={aggressive_nomination:T.options.forceAggressiveIceNomination,browser_extension:T._isBrowserExtension,dscp:!!T.options.dscp,ice_restart_enabled:T.options.enableIceRestart,platform:e.getMediaEngine(),sdk_version:c.RELEASE_VERSION};function O(B,q){q&&(R[B]=q)}if(N){var F=N.parameters.CallSid;O("call_sid",/^TJ/.test(F)?void 0:F),O("temp_call_sid",N.outboundConnectionId),O("audio_codec",N.codec),R.direction=N.direction}return O("gateway",T.stream&&T.stream.gateway),O("selected_region",T.options.region),O("region",T.stream&&T.stream.region),R},T._disconnectAll=function(){var N=T.connections.splice(0);N.forEach(function(R){return R.disconnect()}),T._activeConnection&&T._activeConnection.disconnect()},T._onGetUserMedia=function(){var N;(N=T.audio)===null||N===void 0||N._updateAvailableDevices().catch(function(R){T._log.warn("Unable to updateAvailableDevices after getUserMedia call",R)})},T._onSignalingClose=function(){T.stream=null},T._onSignalingConnected=function(N){var R=A.getRegionShortcode(N.region);T._edge=A.regionToEdge[R]||N.region,T._region=R||N.region,T._sendPresence()},T._onSignalingError=function(N){if(N.error){var R=y({},N.error),O=N.callsid;O&&(R.connection=T._findConnection(O)),R.code===31201?R.twilioError=new a.AuthorizationErrors.AuthenticationFailed:R.code===31204?R.twilioError=new a.AuthorizationErrors.AccessTokenInvalid:R.code===31205?(T._stopRegistrationTimer(),R.twilioError=new a.AuthorizationErrors.AccessTokenExpired):R.twilioError||(R.twilioError=new a.GeneralErrors.UnknownError),T._log.info("Received error: ",R),T.emit("error",R)}},T._onSignalingInvite=function(N){var R=!!T._activeConnection;if(R&&!T.options.allowIncomingWhileBusy){T._log.info("Device busy; ignoring incoming invite");return}if(!N.callsid||!N.sdp){T.emit("error",{message:"Malformed invite from gateway",twilioError:new a.ClientErrors.BadRequest});return}var O=N.parameters||{};O.CallSid=O.CallSid||N.callsid;var F=Object.assign({},w.queryToJson(O.Params)),B=T._makeConnection(F,{callParameters:O,offerSdp:N.sdp});T.connections.push(B),B.once("accept",function(){T.soundcache.get(p.SoundName.Incoming).stop(),T._publishNetworkChange()});var q=T._enabledSounds.incoming&&!R?function(){return T.soundcache.get(p.SoundName.Incoming).play()}:function(){return Promise.resolve()};T._showIncomingConnection(B,q)},T._onSignalingOffline=function(){T._log.info("Stream is offline"),T._status=p.Status.Offline,T._edge=null,T._region=null,T.emit("offline",T)},T._onSignalingReady=function(){T._log.info("Stream is ready"),T._status=p.Status.Ready,T.emit("ready",T)},T._publishNetworkChange=function(){T._activeConnection&&T._networkInformation&&T._publisher.info("network-information","network-change",{connection_type:T._networkInformation.type,downlink:T._networkInformation.downlink,downlinkMax:T._networkInformation.downlinkMax,effective_type:T._networkInformation.effectiveType,rtt:T._networkInformation.rtt},T._activeConnection)},T._updateInputStream=function(N){var R=T._activeConnection;return R&&!N?Promise.reject(new a.InvalidStateError("Cannot unset input device while a call is in progress.")):(T._connectionInputStream=N,R?R._setInputTracksFromStream(N):Promise.resolve())},T._updateSinkIds=function(N,R){var O=N==="ringtone"?T._updateRingtoneSinkIds(R):T._updateSpeakerSinkIds(R);return O.then(function(){T._publisher.info("audio",N+"-devices-set",{audio_device_ids:R},T._activeConnection)},function(F){throw T._publisher.error("audio",N+"-devices-set-failed",{audio_device_ids:R,message:F.message},T._activeConnection),F})},window){var M=window,g=M.msBrowser||M.browser||M.chrome;T._isBrowserExtension=!!g&&!!g.runtime&&!!g.runtime.id||!!M.safari&&!!M.safari.extension}if(T._isBrowserExtension&&T._log.info("Running as browser extension."),navigator){var $=navigator;T._networkInformation=$.connection||$.mozConnection||$.webkitConnection}if(I)T.setup(I,D);else if(D)throw new a.InvalidArgumentError("Cannot construct a Device with options but without a token");return T}return Object.defineProperty(p,"audioContext",{get:function(){return p._audioContext},enumerable:!0,configurable:!0}),Object.defineProperty(p,"extension",{get:function(){var I=typeof document<"u"?document.createElement("audio"):{canPlayType:!1},D;try{D=I.canPlayType&&!!I.canPlayType("audio/mpeg").replace(/no/,"")}catch{D=!1}var E;try{E=I.canPlayType&&!!I.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch{E=!1}return E&&!D?"ogg":"mp3"},enumerable:!0,configurable:!0}),Object.defineProperty(p,"isSupported",{get:function(){return e.enabled()},enumerable:!0,configurable:!0}),Object.defineProperty(p,"packageName",{get:function(){return c.PACKAGE_NAME},enumerable:!0,configurable:!0}),p.runPreflight=function(I,D){return new P.PreflightTest(I,y({audioContext:p._getOrCreateAudioContext()},D))},p.toString=function(){return"[Twilio.Device class]"},Object.defineProperty(p,"version",{get:function(){return c.RELEASE_VERSION},enumerable:!0,configurable:!0}),p._getOrCreateAudioContext=function(){return p._audioContext||(typeof AudioContext<"u"?p._audioContext=new AudioContext:typeof webkitAudioContext<"u"&&(p._audioContext=new webkitAudioContext)),p._audioContext},p.prototype.activeConnection=function(){return this.isInitialized?this._activeConnection||this.connections[0]:null},p.prototype.cancel=function(I){return this._addHandler(p.EventName.Cancel,I)},p.prototype.connect=function(I,D,E){if(typeof I=="function")return this._addHandler(p.EventName.Connect,I),null;if(this._throwUnlessSetup("connect"),this._activeConnection)throw new a.InvalidStateError("A Connection is already active");var T=I||{};D=D||this.options&&this.options.audioConstraints||{},E=E||this.options.rtcConfiguration;var M=this._activeConnection=this._makeConnection(T,{rtcConfiguration:E});return this.connections.splice(0).forEach(function(g){return g.ignore()}),this.soundcache.get(p.SoundName.Incoming).stop(),M.accept(D),this._publishNetworkChange(),M},p.prototype.disconnect=function(I){return this._addHandler(p.EventName.Disconnect,I)},p.prototype.disconnectAll=function(){this._throwUnlessSetup("disconnectAll"),this._disconnectAll()},Object.defineProperty(p.prototype,"edge",{get:function(){return this._edge},enumerable:!0,configurable:!0}),p.prototype.error=function(I){return this._addHandler(p.EventName.Error,I)},p.prototype.incoming=function(I){return this._addHandler(p.EventName.Incoming,I)},p.prototype.offline=function(I){return this._addHandler(p.EventName.Offline,I)},p.prototype.ready=function(I){return this._addHandler(p.EventName.Ready,I)},p.prototype.region=function(){return this._log.warn("`Device.region` is deprecated and will be removed in the next major release. Please use `Device.edge` instead."),this._throwUnlessSetup("region"),typeof this._region=="string"?this._region:"offline"},p.prototype.registerPresence=function(){return this._throwUnlessSetup("registerPresence"),this.mediaPresence.audio=!0,this._sendPresence(),this},p.prototype.removeListener=function(I,D){return s.EventEmitter.prototype.removeListener.call(this,I,D),this},p.prototype.setup=function(I,D){var E=this;if(D===void 0&&(D={}),w.isLegacyEdge())throw new a.NotSupportedError("Microsoft Edge Legacy (https://support.microsoft.com/en-us/help/4533505/what-is-microsoft-edge-legacy) is deprecated and will not be able to connect to Twilio to make or receive calls after September 1st, 2020. Please see this documentation for a list of supported browsers https://www.twilio.com/docs/voice/client/javascript#supported-browsers");if(!p.isSupported&&!D.ignoreBrowserSupport)throw window&&window.location&&window.location.protocol==="http:"?new a.NotSupportedError("twilio.js wasn't able to find WebRTC browser support.           This is most likely because this page is served over http rather than https,           which does not support WebRTC in many browsers. Please load this page over https and           try again."):new a.NotSupportedError("twilio.js 1.3+ SDKs require WebRTC browser support.         For more information, see <https://www.twilio.com/docs/api/client/twilio-js>.         If you have any questions about this announcement, please contact         Twilio Support at <help@twilio.com>.");if(!I)throw new a.InvalidArgumentError("Token is required for Device.setup()");if(Object.assign(this.options,D),this._log.setDefaultLevel(this.options.debug?u.default.levels.DEBUG:this.options.warnings?u.default.levels.WARN:u.default.levels.SILENT),this._chunderURIs=this.options.chunderw?["wss://"+this.options.chunderw+"/signal"]:A.getChunderURIs(this.options.edge,this.options.region,this._log.warn.bind(this._log)).map(function(q){return"wss://"+q+"/signal"}),typeof p._isUnifiedPlanDefault>"u"&&(p._isUnifiedPlanDefault=typeof window<"u"&&typeof RTCPeerConnection<"u"&&typeof RTCRtpTransceiver<"u"?w.isUnifiedPlanDefault(window,window.navigator,RTCPeerConnection,RTCRtpTransceiver):!1),p._getOrCreateAudioContext(),p._audioContext&&D.fakeLocalDTMF?p._dialtonePlayer||(p._dialtonePlayer=new v.default(p._audioContext)):p._dialtonePlayer&&(p._dialtonePlayer.cleanup(),delete p._dialtonePlayer),this.isInitialized)return this._log.info("Found existing Device; using new token but ignoring options"),this.updateToken(I),this;this.isInitialized=!0,this.options.dscp&&(this.options.rtcConstraints.optional=[{googDscp:!0}]);var T=function(q,x){return i||(E._log.warn("Device.sounds is deprecated and will be removed in the next breaking release. Please use the new functionality available on Device.audio."),i=!0),typeof x<"u"&&(E._enabledSounds[q]=x),E._enabledSounds[q]};[p.SoundName.Disconnect,p.SoundName.Incoming,p.SoundName.Outgoing].forEach(function(q){E.sounds[q]=T.bind(null,q)});for(var M={disconnect:{filename:"disconnect",maxDuration:3e3},dtmf0:{filename:"dtmf-0",maxDuration:1e3},dtmf1:{filename:"dtmf-1",maxDuration:1e3},dtmf2:{filename:"dtmf-2",maxDuration:1e3},dtmf3:{filename:"dtmf-3",maxDuration:1e3},dtmf4:{filename:"dtmf-4",maxDuration:1e3},dtmf5:{filename:"dtmf-5",maxDuration:1e3},dtmf6:{filename:"dtmf-6",maxDuration:1e3},dtmf7:{filename:"dtmf-7",maxDuration:1e3},dtmf8:{filename:"dtmf-8",maxDuration:1e3},dtmf9:{filename:"dtmf-9",maxDuration:1e3},dtmfh:{filename:"dtmf-hash",maxDuration:1e3},dtmfs:{filename:"dtmf-star",maxDuration:1e3},incoming:{filename:"incoming",shouldLoop:!0},outgoing:{filename:"outgoing",maxDuration:3e3}},g=0,$=Object.keys(M);g<$.length;g++){var N=$[g],R=M[N],O=c.SOUNDS_BASE_URL+"/"+R.filename+"."+p.extension+("?cache="+c.RELEASE_VERSION),F=this.options.sounds&&this.options.sounds[N]||O,B=new this.options.soundFactory(N,F,{audioContext:this.options.disableAudioContextSounds?null:p.audioContext,maxDuration:R.maxDuration,shouldLoop:R.shouldLoop});this.soundcache.set(N,B)}return this._publisher=(this.options.Publisher||m)("twilio-js-sdk",I,{defaultPayload:this._createDefaultPayload,host:this.options.eventgw,metadata:{app_name:this.options.appName,app_version:this.options.appVersion}}),this.options.publishEvents===!1?this._publisher.disable():this._publisher.on("error",function(q){E._log.warn("Cannot connect to insights.",q)}),this._networkInformation&&typeof this._networkInformation.addEventListener=="function"&&this._networkInformation.addEventListener("change",this._publishNetworkChange),this.audio=new(this.options.AudioHelper||d.default)(this._updateSinkIds,this._updateInputStream,this.options.getUserMedia||t,{audioContext:p.audioContext,enabledSounds:this._enabledSounds,enumerateDevices:this.options.enumerateDevices}),this.audio.on("deviceChange",function(q){var x=E._activeConnection,j=q.map(function(L){return L.deviceId});E._publisher.info("audio","device-change",{lost_active_device_ids:j},x),x&&x.mediaStream._onInputDevicesChanged()}),this.mediaPresence.audio=!this.options.noRegister,this.updateToken(I),typeof window<"u"&&window.addEventListener&&(window.addEventListener("unload",this.destroy),window.addEventListener("pagehide",this.destroy),this.options.closeProtection&&window.addEventListener("beforeunload",this._confirmClose)),this.on(p.EventName.Error,function(){E.listenerCount("error")>1||E._log.info("Uncaught error event suppressed.")}),this},p.prototype.status=function(){return this._throwUnlessSetup("status"),this._activeConnection?p.Status.Busy:this._status},p.prototype.toString=function(){return"[Twilio.Device instance]"},p.prototype.unregisterPresence=function(){return this._throwUnlessSetup("unregisterPresence"),this.mediaPresence.audio=!1,this._sendPresence(),this},p.prototype.updateToken=function(I){this._throwUnlessSetup("updateToken"),this.token=I,this.register(I)},p.prototype._addHandler=function(I,D){return r||(this._log.warn("Device callback handlers (connect, error, offline, incoming, cancel, ready, disconnect)         have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: device.on('"+I+"', handler)"),r=!0),this.addListener(I,D),this},p.prototype._asyncEmit=function(I){for(var D=this,E=[],T=1;T<arguments.length;T++)E[T-1]=arguments[T];setTimeout(function(){return D.emit.apply(D,o([I],E))})},p.prototype._findConnection=function(I){return this.connections.find(function(D){return D.parameters.CallSid===I||D.outboundConnectionId===I})||null},p.prototype._makeConnection=function(I,D){var E=this;if(typeof p._isUnifiedPlanDefault>"u")throw new a.InvalidStateError("Device has not been initialized.");var T={audioHelper:this.audio,getUserMedia:this.options.getUserMedia||t,isUnifiedPlanDefault:p._isUnifiedPlanDefault,pstream:this.stream,publisher:this._publisher,soundcache:this.soundcache};D=Object.assign({MediaStream:this.options.MediaStream||this.options.mediaStreamFactory||e.PeerConnection,RTCPeerConnection:this.options.RTCPeerConnection,audioConstraints:this.options.audioConstraints,beforeAccept:function(g){!E._activeConnection||E._activeConnection===g||(E._activeConnection.disconnect(),E._removeConnection(E._activeConnection))},codecPreferences:this.options.codecPreferences,dialtonePlayer:p._dialtonePlayer,dscp:this.options.dscp,enableIceRestart:this.options.enableIceRestart,enableRingingState:this.options.enableRingingState,forceAggressiveIceNomination:this.options.forceAggressiveIceNomination,getInputStream:function(){return E.options.fileInputStream||E._connectionInputStream},getSinkIds:function(){return E._connectionSinkIds},maxAverageBitrate:this.options.maxAverageBitrate,onGetUserMedia:function(){return E._onGetUserMedia()},preflight:this.options.preflight,rtcConfiguration:this.options.rtcConfiguration||{iceServers:this.options.iceServers},rtcConstraints:this.options.rtcConstraints,shouldPlayDisconnect:function(){return E._enabledSounds.disconnect},twimlParams:I},D);var M=new this.options.connectionFactory(T,D);return this._publisher.info("settings","init",{RTCPeerConnection:!!this.options.RTCPeerConnection,enumerateDevices:!!this.options.enumerateDevices,getUserMedia:!!this.options.getUserMedia},M),M.once("accept",function(){E._removeConnection(M),E._activeConnection=M,E.audio&&E.audio._maybeStartPollingVolume(),M.direction===h.default.CallDirection.Outgoing&&E._enabledSounds.outgoing&&E.soundcache.get(p.SoundName.Outgoing).play();var g={edge:E._edge||E._region},$=E.options.edge;$&&(g.selected_edge=Array.isArray($)?$:[$]),E._publisher.info("settings","edge",g,M),E._asyncEmit("connect",M)}),M.addListener("error",function(g){M.status()==="closed"&&E._removeConnection(M),E.audio&&E.audio._maybeStopPollingVolume(),E._maybeStopIncomingSound(),E._asyncEmit("error",g)}),M.once("cancel",function(){E._log.info("Canceled: "+M.parameters.CallSid),E._removeConnection(M),E.audio&&E.audio._maybeStopPollingVolume(),E._maybeStopIncomingSound(),E._asyncEmit("cancel",M)}),M.once("disconnect",function(){E.audio&&E.audio._maybeStopPollingVolume(),E._removeConnection(M),E._asyncEmit("disconnect",M)}),M.once("reject",function(){E._log.info("Rejected: "+M.parameters.CallSid),E.audio&&E.audio._maybeStopPollingVolume(),E._removeConnection(M),E._maybeStopIncomingSound()}),M.once("transportClose",function(){M.status()===h.default.State.Pending&&(E.audio&&E.audio._maybeStopPollingVolume(),E._removeConnection(M),E._maybeStopIncomingSound())}),M},p.prototype._maybeStopIncomingSound=function(){this.connections.length||this.soundcache.get(p.SoundName.Incoming).stop()},p.prototype._removeConnection=function(I){this._activeConnection===I&&(this._activeConnection=null);for(var D=this.connections.length-1;D>=0;D--)I===this.connections[D]&&this.connections.splice(D,1)},p.prototype._sendPresence=function(){this.stream&&(this.stream.register({audio:this.mediaPresence.audio}),this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer())},p.prototype._setupStream=function(I){this._log.info("Setting up VSP"),this.stream=this.options.pStreamFactory(I,this._chunderURIs,{backoffMaxMs:this.options.backoffMaxMs}),this.stream.addListener("close",this._onSignalingClose),this.stream.addListener("connected",this._onSignalingConnected),this.stream.addListener("error",this._onSignalingError),this.stream.addListener("invite",this._onSignalingInvite),this.stream.addListener("offline",this._onSignalingOffline),this.stream.addListener("ready",this._onSignalingReady)},p.prototype._showIncomingConnection=function(I,D){var E=this,T;return Promise.race([D(),new Promise(function(M,g){T=setTimeout(function(){var $="Playing incoming ringtone took too long; it might not play. Continuing execution...";g(new Error($))},f)})]).catch(function(M){E._log.info(M.message)}).then(function(){clearTimeout(T),E.emit("incoming",I)})},p.prototype._startRegistrationTimer=function(){var I=this;this._stopRegistrationTimer(),this.regTimer=setTimeout(function(){I._sendPresence()},C)},p.prototype._stopRegistrationTimer=function(){this.regTimer&&clearTimeout(this.regTimer)},p.prototype._throwUnlessSetup=function(I){if(!this.isInitialized)throw new a.InvalidStateError("Call Device.setup() before "+I)},p.prototype._updateRingtoneSinkIds=function(I){return Promise.resolve(this.soundcache.get(p.SoundName.Incoming).setSinkIds(I))},p.prototype._updateSpeakerSinkIds=function(I){Array.from(this.soundcache.entries()).filter(function(E){return E[0]!==p.SoundName.Incoming}).forEach(function(E){return E[1].setSinkIds(I)}),this._connectionSinkIds=I;var D=this._activeConnection;return D?D._setSinkIds(I):Promise.resolve()},p.prototype.register=function(I){this.stream?(this.stream.setToken(I),this._publisher.setToken(I)):this._setupStream(I)},p}(s.EventEmitter);return function(S){(function(p){p.Cancel="cancel",p.Connect="connect",p.Disconnect="disconnect",p.Error="error",p.Incoming="incoming",p.Offline="offline",p.Ready="ready"})(S.EventName||(S.EventName={})),function(p){p.Busy="busy",p.Offline="offline",p.Ready="ready"}(S.Status||(S.Status={})),function(p){p.Incoming="incoming",p.Outgoing="outgoing",p.Disconnect="disconnect",p.Dtmf0="dtmf0",p.Dtmf1="dtmf1",p.Dtmf2="dtmf2",p.Dtmf3="dtmf3",p.Dtmf4="dtmf4",p.Dtmf5="dtmf5",p.Dtmf6="dtmf6",p.Dtmf7="dtmf7",p.Dtmf8="dtmf8",p.Dtmf9="dtmf9",p.DtmfS="dtmfs",p.DtmfH="dtmfh"}(S.SoundName||(S.SoundName={}))}(_||(_={})),we.default=_,we}var ht={},yo;function Qa(){if(yo)return ht;yo=1,Object.defineProperty(ht,"__esModule",{value:!0});var l=function(){function y(o,s){s===void 0&&(s=!1),this.deleted=!1;var d,h=o.candidate.split("network-cost ");h[1]&&(d=parseInt(h[1],10)),this.candidateType=o.type,this.ip=o.ip||o.address,this.isRemote=s,this.networkCost=d,this.port=o.port,this.priority=o.priority,this.protocol=o.protocol,this.relatedAddress=o.relatedAddress,this.relatedPort=o.relatedPort,this.tcpType=o.tcpType,this.transportId=o.sdpMid}return y.prototype.toPayload=function(){return{candidate_type:this.candidateType,deleted:this.deleted,ip:this.ip,is_remote:this.isRemote,"network-cost":this.networkCost,port:this.port,priority:this.priority,protocol:this.protocol,related_address:this.relatedAddress,related_port:this.relatedPort,tcp_type:this.tcpType,transport_id:this.transportId}},y}();return ht.IceCandidate=l,ht}var Ee={},Jr,_o;function Za(){if(_o)return Jr;_o=1;var l={r0:94.768};function y(d,h,v){if(!s(d)||!s(h)||!s(v))return null;var a=o(d,h,v),u=1+.035*a+7e-6*a*(a-60)*(100-a),P=u>=1&&u<4.6;return P?u:null}function o(d,h,v){var a=d+h*2+10,u=0;switch(!0){case a<160:u=l.r0-a/40;break;case a<1e3:u=l.r0-(a-120)/10;break;case a>=1e3:u=l.r0-a/100;break}var P=.01;switch(!0){case v===-1:P=0,u=0;break;case v<=u/2.5:P=2.5;break;case(v>u/2.5&&v<100):P=.25;break}return u-=v*P,u}function s(d){return typeof d=="number"&&!isNaN(d)&&isFinite(d)&&d>=0}return Jr={calculate:y},Jr}var bo;function es(){if(bo)return Ee;bo=1;var l=Ee&&Ee.__extends||function(){var f=function(r,i){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,S){_.__proto__=S}||function(_,S){for(var p in S)S.hasOwnProperty(p)&&(_[p]=S[p])},f(r,i)};return function(r,i){f(r,i);function _(){this.constructor=r}r.prototype=i===null?Object.create(i):(_.prototype=i.prototype,new _)}}(),y=Ee&&Ee.__assign||function(){return y=Object.assign||function(f){for(var r,i=1,_=arguments.length;i<_;i++){r=arguments[i];for(var S in r)Object.prototype.hasOwnProperty.call(r,S)&&(f[S]=r[S])}return f},y.apply(this,arguments)},o=Ee&&Ee.__spreadArrays||function(){for(var f=0,r=0,i=arguments.length;r<i;r++)f+=arguments[r].length;for(var _=Array(f),S=0,r=0;r<i;r++)for(var p=arguments[r],I=0,D=p.length;I<D;I++,S++)_[S]=p[I];return _};Object.defineProperty(Ee,"__esModule",{value:!0});var s=me(),d=he(),h=ke(),v=gn().getRTCStats,a=Za(),u=5,P=0,A=3,w=1e3,c=5*1e3,m={audioInputLevel:{minStandardDeviation:327.67,sampleCount:10},audioOutputLevel:{minStandardDeviation:327.67,sampleCount:10},bytesReceived:{clearCount:2,min:1,raiseCount:3,sampleCount:3},bytesSent:{clearCount:2,min:1,raiseCount:3,sampleCount:3},jitter:{max:30},mos:{min:3},packetsLostFraction:[{max:1},{clearValue:1,maxAverage:3,sampleCount:7}],rtt:{max:400}};function n(f,r){return r.reduce(function(i,_){return i+=_>f?1:0},0)}function e(f,r){return r.reduce(function(i,_){return i+=_<f?1:0},0)}function t(f){if(f.length<=0)return null;var r=f.reduce(function(S,p){return S+p},0)/f.length,i=f.map(function(S){return Math.pow(S-r,2)}),_=Math.sqrt(i.reduce(function(S,p){return S+p},0)/i.length);return _}function b(f){return f.reduce(function(r,i){return o(r,i)},[])}var C=function(f){l(r,f);function r(i){var _=f.call(this)||this;_._activeWarnings=new Map,_._currentStreaks=new Map,_._inputVolumes=[],_._outputVolumes=[],_._sampleBuffer=[],_._supplementalSampleBuffers={audioInputLevel:[],audioOutputLevel:[]},_._warningsEnabled=!0,i=i||{},_._getRTCStats=i.getRTCStats||v,_._mos=i.Mos||a,_._peerConnection=i.peerConnection,_._thresholds=y(y({},m),i.thresholds);var S=Object.values(_._thresholds).map(function(p){return p.sampleCount}).filter(function(p){return!!p});return _._maxSampleCount=Math.max.apply(Math,o([u],S)),_._peerConnection&&_.enable(_._peerConnection),_}return r.prototype.addVolumes=function(i,_){this._inputVolumes.push(i),this._outputVolumes.push(_)},r.prototype.disable=function(){return clearInterval(this._sampleInterval),delete this._sampleInterval,this},r.prototype.disableWarnings=function(){return this._warningsEnabled&&this._activeWarnings.clear(),this._warningsEnabled=!1,this},r.prototype.enable=function(i){if(i){if(this._peerConnection&&i!==this._peerConnection)throw new d.InvalidArgumentError("Attempted to replace an existing PeerConnection in StatsMonitor.enable");this._peerConnection=i}if(!this._peerConnection)throw new d.InvalidArgumentError("Can not enable StatsMonitor without a PeerConnection");return this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),w),this},r.prototype.enableWarnings=function(){return this._warningsEnabled=!0,this},r.prototype.hasActiveWarning=function(i,_){var S=i+":"+_;return!!this._activeWarnings.get(S)},r.prototype._addSample=function(i){var _=this._sampleBuffer;_.push(i),_.length>this._maxSampleCount&&_.splice(0,_.length-this._maxSampleCount)},r.prototype._clearWarning=function(i,_,S){var p=i+":"+_,I=this._activeWarnings.get(p);!I||Date.now()-I.timeRaised<c||(this._activeWarnings.delete(p),this.emit("warning-cleared",y(y({},S),{name:i,threshold:{name:_,value:this._thresholds[i][_]}})))},r.prototype._createSample=function(i,_){var S=_&&_.totals.bytesSent||0,p=_&&_.totals.bytesReceived||0,I=_&&_.totals.packetsSent||0,D=_&&_.totals.packetsReceived||0,E=_&&_.totals.packetsLost||0,T=i.bytesSent-S,M=i.bytesReceived-p,g=i.packetsSent-I,$=i.packetsReceived-D,N=i.packetsLost-E,R=$+N,O=R>0?N/R*100:0,F=i.packetsReceived+i.packetsLost,B=F>0?i.packetsLost/F*100:100,q=typeof i.rtt=="number"||!_?i.rtt:_.rtt,x=this._inputVolumes.splice(0);this._supplementalSampleBuffers.audioInputLevel.push(x);var j=this._outputVolumes.splice(0);return this._supplementalSampleBuffers.audioOutputLevel.push(j),{audioInputLevel:Math.round(h.average(x)),audioOutputLevel:Math.round(h.average(j)),bytesReceived:M,bytesSent:T,codecName:i.codecName,jitter:i.jitter,mos:this._mos.calculate(q,i.jitter,_&&O),packetsLost:N,packetsLostFraction:O,packetsReceived:$,packetsSent:g,rtt:q,timestamp:i.timestamp,totals:{bytesReceived:i.bytesReceived,bytesSent:i.bytesSent,packetsLost:i.packetsLost,packetsLostFraction:B,packetsReceived:i.packetsReceived,packetsSent:i.packetsSent}}},r.prototype._fetchSample=function(){var i=this;this._getSample().then(function(_){i._addSample(_),i._raiseWarnings(),i.emit("sample",_)}).catch(function(_){i.disable(),i.emit("error",_)})},r.prototype._getSample=function(){var i=this;return this._getRTCStats(this._peerConnection).then(function(_){var S=null;return i._sampleBuffer.length&&(S=i._sampleBuffer[i._sampleBuffer.length-1]),i._createSample(_,S)})},r.prototype._raiseWarning=function(i,_,S){var p=i+":"+_;if(!this._activeWarnings.has(p)){this._activeWarnings.set(p,{timeRaised:Date.now()});var I=this._thresholds[i],D;if(Array.isArray(I)){var E=I.find(function(T){return _ in T});E&&(D=E[_])}else D=this._thresholds[i][_];this.emit("warning",y(y({},S),{name:i,threshold:{name:_,value:D}}))}},r.prototype._raiseWarnings=function(){var i=this;this._warningsEnabled&&Object.keys(this._thresholds).forEach(function(_){return i._raiseWarningsForStat(_)})},r.prototype._raiseWarningsForStat=function(i){var _=this,S=Array.isArray(this._thresholds[i])?this._thresholds[i]:[this._thresholds[i]];S.forEach(function(p){var I=_._sampleBuffer,D=p.clearCount||P,E=p.raiseCount||A,T=p.sampleCount||_._maxSampleCount,M=I.slice(-T),g=M.map(function(L){return L[i]}),$=g.some(function(L){return typeof L>"u"||L===null});if(!$){var N;if(typeof p.max=="number"&&(N=n(p.max,g),N>=E?_._raiseWarning(i,"max",{values:g,samples:M}):N<=D&&_._clearWarning(i,"max",{values:g,samples:M})),typeof p.min=="number"&&(N=e(p.min,g),N>=E?_._raiseWarning(i,"min",{values:g,samples:M}):N<=D&&_._clearWarning(i,"min",{values:g,samples:M})),typeof p.maxDuration=="number"&&I.length>1){M=I.slice(-2);var R=M[0][i],O=M[1][i],F=_._currentStreaks.get(i)||0,B=R===O?F+1:0;_._currentStreaks.set(i,B),B>=p.maxDuration?_._raiseWarning(i,"maxDuration",{value:B}):B===0&&_._clearWarning(i,"maxDuration",{value:F})}if(typeof p.minStandardDeviation=="number"){var q=_._supplementalSampleBuffers[i];if(!q||q.length<p.sampleCount)return;q.length>p.sampleCount&&q.splice(0,q.length-p.sampleCount);var x=b(q.slice(-T)),j=t(x);if(typeof j!="number")return;j<p.minStandardDeviation?_._raiseWarning(i,"minStandardDeviation",{value:j}):_._clearWarning(i,"minStandardDeviation",{value:j})}[["maxAverage",function(L,W){return L>W}],["minAverage",function(L,W){return L<W}]].forEach(function(L){var W=L[0],H=L[1];if(typeof p[W]=="number"&&g.length>=T){var Y=h.average(g);H(Y,p[W])?_._raiseWarning(i,W,{values:g,samples:M}):H(Y,p.clearValue||p[W])||_._clearWarning(i,W,{values:g,samples:M})}})}})},r}(s.EventEmitter);return Ee.default=C,Ee}var So;function Yr(){if(So)return Re;So=1;var l=Re&&Re.__extends||function(){var D=function(E,T){return D=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(M,g){M.__proto__=g}||function(M,g){for(var $ in g)g.hasOwnProperty($)&&(M[$]=g[$])},D(E,T)};return function(E,T){D(E,T);function M(){this.constructor=E}E.prototype=T===null?Object.create(T):(M.prototype=T.prototype,new M)}}(),y=Re&&Re.__assign||function(){return y=Object.assign||function(D){for(var E,T=1,M=arguments.length;T<M;T++){E=arguments[T];for(var g in E)Object.prototype.hasOwnProperty.call(E,g)&&(D[g]=E[g])}return D},y.apply(this,arguments)};Object.defineProperty(Re,"__esModule",{value:!0});var o=me(),s=$r(),d=he(),h=Me(),v=Qa(),a=es(),u=ke(),P=$i(),A=Ue(),w=io().PeerConnection,c=Fr().getPreferredCodecInfo,m={factor:1.1,initialDelay:1,maxDelay:3e4,randomisationFactor:.5},n=70,e=500,t=160,b=10,C=5e3,f={disconnect:!0,info:{code:31003,message:"Connection with Twilio was interrupted.",twilioError:new d.MediaErrors.ConnectionError}},r={packetsLostFraction:{max:"packet-loss",maxAverage:"packets-lost-fraction"}},i={audioInputLevel:"audio-input-level",audioOutputLevel:"audio-output-level",bytesReceived:"bytes-received",bytesSent:"bytes-sent",jitter:"jitter",mos:"mos",rtt:"rtt"},_={max:"high-",maxAverage:"high-",maxDuration:"constant-",min:"low-",minStandardDeviation:"constant-"},S=!1,p=function(D){l(E,D);function E(T,M){var g=D.call(this)||this;g.parameters={},g._inputVolumeStreak=0,g._isAnswered=!1,g._isCancelled=!1,g._latestInputVolume=0,g._latestOutputVolume=0,g._log=h.default.getInstance(),g._metricsSamples=[],g._outputVolumeStreak=0,g._soundcache=new Map,g._status=E.State.Pending,g.options={enableRingingState:!1,mediaStreamFactory:w,offerSdp:null,shouldPlayDisconnect:function(){return!0}},g.sendHangup=!0,g.toString=function(){return"[Twilio.Connection instance]"},g._emitWarning=function(R,O,F,B,q,x){var j=q?"-cleared":"-raised",L=R+"warning"+j;if(!(O==="constant-audio-input-level"&&g.isMuted())){var W=q?"info":"warning";O==="constant-audio-output-level"&&(W="info");var H={threshold:F};if(B&&(B instanceof Array?H.values=B.map(function(J){return typeof J=="number"?Math.round(J*100)/100:B}):H.value=B),g._publisher.post(W,L,O,{data:H},g),O!=="constant-audio-output-level"){var Y=q?"warning-cleared":"warning";g.emit(Y,O,x&&!q?x:null)}}},g._onAnswer=function(R){g._isAnswered||(g._setCallSid(R),g._isAnswered=!0,g._maybeTransitionToOpen())},g._onCancel=function(R){var O=R.callsid;g.parameters.CallSid===O&&(g._isCancelled=!0,g._publisher.info("connection","cancel",null,g),g._cleanupEventListeners(),g.mediaStream.close(),g._status=E.State.Closed,g.emit("cancel"),g.pstream.removeListener("cancel",g._onCancel))},g._onHangup=function(R){if(R.callsid&&(g.parameters.CallSid||g.outboundConnectionId)){if(R.callsid!==g.parameters.CallSid&&R.callsid!==g.outboundConnectionId)return}else if(R.callsid)return;if(g._log.info("Received HANGUP from gateway"),R.error){var O={code:R.error.code||31e3,connection:g,message:R.error.message||"Error sent from gateway in HANGUP",twilioError:new d.GeneralErrors.ConnectionError};g._log.error("Received an error from the gateway:",O),g.emit("error",O)}g.sendHangup=!1,g._publisher.info("connection","disconnected-by-remote",null,g),g._disconnect(null,!0),g._cleanupEventListeners()},g._onMediaFailure=function(R){var O=E.MediaFailure,F=O.ConnectionDisconnected,B=O.ConnectionFailed,q=O.IceGatheringFailed,x=O.LowBytes,j=R===B||R===q;if(!g.options.enableIceRestart&&j||!u.isChrome(window,window.navigator)&&R===B)return g.mediaStream.onerror(f);if(g.options.enableIceRestart){if(g._status===E.State.Reconnecting){if(j){if(Date.now()-g._mediaReconnectStartTime>m.maxDelay)return g._log.info("Exceeded max ICE retries"),g.mediaStream.onerror(f);g._mediaReconnectBackoff.backoff()}return}var L=g.mediaStream.version.pc,W=L&&L.iceConnectionState==="disconnected",H=g._monitor.hasActiveWarning("bytesSent","min")||g._monitor.hasActiveWarning("bytesReceived","min");if(R===x&&W||R===F&&H||j){var Y={code:53405,message:"Media connection failed.",twilioError:new d.MediaErrors.ConnectionError};g._log.warn("ICE Connection disconnected."),g._publisher.warn("connection","error",Y,g),g._publisher.info("connection","reconnecting",null,g),g._mediaReconnectStartTime=Date.now(),g._status=E.State.Reconnecting,g._mediaReconnectBackoff.reset(),g._mediaReconnectBackoff.backoff(),g.emit("reconnecting",Y)}}},g._onMediaReconnected=function(){g._status===E.State.Reconnecting&&(g._log.info("ICE Connection reestablished."),g._publisher.info("connection","reconnected",null,g),g._status=E.State.Open,g.emit("reconnected"))},g._onRinging=function(R){if(g._setCallSid(R),!(g._status!==E.State.Connecting&&g._status!==E.State.Ringing)){var O=!!R.sdp;g.options.enableRingingState?(g._status=E.State.Ringing,g._publisher.info("connection","outgoing-ringing",{hasEarlyMedia:O},g),g.emit("ringing",O)):O&&g._onAnswer(R)}},g._onRTCSample=function(R){var O=y(y({},R),{inputVolume:g._latestInputVolume,outputVolume:g._latestOutputVolume});g._codec=O.codecName,g._metricsSamples.push(O),g._metricsSamples.length>=b&&g._publishMetrics(),g.emit("sample",R)},g._onTransportClose=function(){g._log.error("Received transportClose from pstream"),g.emit("transportClose")},g._reemitWarning=function(R,O){var F=/^audio/.test(R.name)?"audio-level-":"network-quality-",B=_[R.threshold.name],q;R.name in r?q=r[R.name][R.threshold.name]:R.name in i&&(q=i[R.name]);var x=B+q;g._emitWarning(F,x,R.threshold.value,R.values||R.value,O,R)},g._reemitWarningCleared=function(R){g._reemitWarning(R,!0)},g._isUnifiedPlanDefault=T.isUnifiedPlanDefault,g._soundcache=T.soundcache,g.message=M&&M.twimlParams||{},g.customParameters=new Map(Object.entries(g.message).map(function(R){var O=R[0],F=R[1];return[O,String(F)]})),Object.assign(g.options,M),g.options.callParameters&&(g.parameters=g.options.callParameters),g._direction=g.parameters.CallSid?E.CallDirection.Incoming:E.CallDirection.Outgoing,g._direction===E.CallDirection.Incoming&&g.parameters?g.callerInfo=g.parameters.StirStatus?{isVerified:g.parameters.StirStatus==="TN-Validation-Passed-A"}:null:g.callerInfo=null,g._mediaReconnectBackoff=P.exponential(m),g._mediaReconnectBackoff.on("ready",function(){return g.mediaStream.iceRestart()}),g.outboundConnectionId=I();var $=g._publisher=T.publisher;g._direction===E.CallDirection.Incoming?$.info("connection","incoming",null,g):$.info("connection","outgoing",{preflight:g.options.preflight},g);var N=g._monitor=new(g.options.StatsMonitor||a.default);return N.on("sample",g._onRTCSample),N.disableWarnings(),setTimeout(function(){return N.enableWarnings()},C),N.on("warning",function(R,O){(R.name==="bytesSent"||R.name==="bytesReceived")&&g._onMediaFailure(E.MediaFailure.LowBytes),g._reemitWarning(R,O)}),N.on("warning-cleared",function(R){g._reemitWarningCleared(R)}),g.mediaStream=new(g.options.MediaStream||g.options.mediaStreamFactory)(T.audioHelper,T.pstream,T.getUserMedia,{RTCPeerConnection:g.options.RTCPeerConnection,codecPreferences:g.options.codecPreferences,dscp:g.options.dscp,enableIceRestart:g.options.enableIceRestart,forceAggressiveIceNomination:g.options.forceAggressiveIceNomination,isUnifiedPlan:g._isUnifiedPlanDefault,maxAverageBitrate:g.options.maxAverageBitrate,preflight:g.options.preflight}),g.on("volume",function(R,O){g._inputVolumeStreak=g._checkVolume(R,g._inputVolumeStreak,g._latestInputVolume,"input"),g._outputVolumeStreak=g._checkVolume(O,g._outputVolumeStreak,g._latestOutputVolume,"output"),g._latestInputVolume=R,g._latestOutputVolume=O}),g.mediaStream.onaudio=function(R){g._log.info("Remote audio created"),g.emit("audio",R)},g.mediaStream.onvolume=function(R,O,F,B){N.addVolumes(F/255*32767,B/255*32767),g.emit("volume",R,O)},g.mediaStream.ondtlstransportstatechange=function(R){var O=R==="failed"?"error":"debug";g._publisher.post(O,"dtls-transport-state",R,null,g)},g.mediaStream.onpcconnectionstatechange=function(R){var O="debug",F=g.mediaStream.getRTCDtlsTransport();R==="failed"&&(O=F&&F.state==="failed"?"error":"warning"),g._publisher.post(O,"pc-connection-state",R,null,g)},g.mediaStream.onicecandidate=function(R){var O=new v.IceCandidate(R).toPayload();g._publisher.debug("ice-candidate","ice-candidate",O,g)},g.mediaStream.onselectedcandidatepairchange=function(R){var O=new v.IceCandidate(R.local).toPayload(),F=new v.IceCandidate(R.remote,!0).toPayload();g._publisher.debug("ice-candidate","selected-ice-candidate-pair",{local_candidate:O,remote_candidate:F},g)},g.mediaStream.oniceconnectionstatechange=function(R){var O=R==="failed"?"error":"debug";g._publisher.post(O,"ice-connection-state",R,null,g)},g.mediaStream.onicegatheringfailure=function(R){g._publisher.warn("ice-gathering-state",R,null,g),g._onMediaFailure(E.MediaFailure.IceGatheringFailed)},g.mediaStream.onicegatheringstatechange=function(R){g._publisher.debug("ice-gathering-state",R,null,g)},g.mediaStream.onsignalingstatechange=function(R){g._publisher.debug("signaling-state",R,null,g)},g.mediaStream.ondisconnected=function(R){g._log.info(R),g._publisher.warn("network-quality-warning-raised","ice-connectivity-lost",{message:R},g),g.emit("warning","ice-connectivity-lost"),g._onMediaFailure(E.MediaFailure.ConnectionDisconnected)},g.mediaStream.onfailed=function(R){g._onMediaFailure(E.MediaFailure.ConnectionFailed)},g.mediaStream.onconnected=function(){g._status===E.State.Reconnecting&&g._onMediaReconnected()},g.mediaStream.onreconnected=function(R){g._log.info(R),g._publisher.info("network-quality-warning-cleared","ice-connectivity-lost",{message:R},g),g.emit("warning-cleared","ice-connectivity-lost"),g._onMediaReconnected()},g.mediaStream.onerror=function(R){R.disconnect===!0&&g._disconnect(R.info&&R.info.message);var O={code:R.info.code,connection:g,info:R.info,message:R.info.message||"Error with mediastream",twilioError:R.info.twilioError};g._log.error("Received an error from MediaStream:",R),g.emit("error",O)},g.mediaStream.onopen=function(){g._status===E.State.Open||g._status===E.State.Reconnecting||(g._status===E.State.Ringing||g._status===E.State.Connecting?(g.mute(!1),g._maybeTransitionToOpen()):g.mediaStream.close())},g.mediaStream.onclose=function(){g._status=E.State.Closed,g.options.shouldPlayDisconnect&&g.options.shouldPlayDisconnect()&&!g._isCancelled&&g._soundcache.get(s.default.SoundName.Disconnect).play(),N.disable(),g._publishMetrics(),g._isCancelled||g.emit("disconnect",g)},g.pstream=T.pstream,g.pstream.on("cancel",g._onCancel),g.pstream.on("ringing",g._onRinging),g.pstream.on("transportClose",g._onTransportClose),g.on("error",function(R){g._publisher.error("connection","error",{code:R.code,message:R.message},g),g.pstream&&g.pstream.status==="disconnected"&&g._cleanupEventListeners()}),g.on("disconnect",function(){g._cleanupEventListeners()}),g}return Object.defineProperty(E.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),Object.defineProperty(E.prototype,"codec",{get:function(){return this._codec},enumerable:!0,configurable:!0}),E.prototype._getRealCallSid=function(){return this._log.warn("_getRealCallSid is deprecated and will be removed in 2.0."),/^TJ/.test(this.parameters.CallSid)?null:this.parameters.CallSid},E.prototype._getTempCallSid=function(){return this._log.warn("_getTempCallSid is deprecated and will be removed in 2.0. 	                    Please use outboundConnectionId instead."),this.outboundConnectionId},E.prototype._setInputTracksFromStream=function(T){return this.mediaStream.setInputTracksFromStream(T)},E.prototype._setSinkIds=function(T){return this.mediaStream._setSinkIds(T)},E.prototype.accept=function(T,M){var g=this;if(typeof T=="function"){this._addHandler("accept",T);return}if(this._status===E.State.Pending){var $=T||this.options.audioConstraints;this._status=E.State.Connecting;var N=function(){if(g._status!==E.State.Connecting){g._cleanupEventListeners(),g.mediaStream.close();return}var F=function(x){var j=g._direction===E.CallDirection.Incoming?"accepted-by-local":"accepted-by-remote";g._publisher.info("connection",j,null,g);var L=c(g.mediaStream.version.getSDP()),W=L.codecName,H=L.codecParams;g._publisher.info("settings","codec",{codec_params:H,selected_codec:W},g),g._monitor.enable(x)},B=typeof g.options.getSinkIds=="function"&&g.options.getSinkIds();if(Array.isArray(B)&&g.mediaStream._setSinkIds(B).catch(function(){}),g.pstream.addListener("hangup",g._onHangup),M=M||g.options.rtcConfiguration,g._direction===E.CallDirection.Incoming)g._isAnswered=!0,g.mediaStream.answerIncomingCall(g.parameters.CallSid,g.options.offerSdp,g.options.rtcConstraints,M,F);else{var q=Array.from(g.customParameters.entries()).map(function(x){return encodeURIComponent(x[0])+"="+encodeURIComponent(x[1])}).join("&");g.pstream.once("answer",g._onAnswer.bind(g)),g.mediaStream.makeOutgoingCall(g.pstream.token,q,g.outboundConnectionId,g.options.rtcConstraints,M,F)}};this.options.beforeAccept&&this.options.beforeAccept(this);var R=typeof this.options.getInputStream=="function"&&this.options.getInputStream(),O=R?this.mediaStream.setInputTracksFromStream(R):this.mediaStream.openWithConstraints($);O.then(function(){g._publisher.info("get-user-media","succeeded",{data:{audioConstraints:$}},g),g.options.onGetUserMedia&&g.options.onGetUserMedia(),N()},function(F){var B,q;F.code===31208||["PermissionDeniedError","NotAllowedError"].indexOf(F.name)!==-1?(q=31208,B="User denied access to microphone, or the web browser did not allow microphone access at this address.",g._publisher.error("get-user-media","denied",{data:{audioConstraints:$,error:F}},g)):(q=31201,B="Error occurred while accessing microphone: "+F.name+(F.message?" ("+F.message+")":""),g._publisher.error("get-user-media","failed",{data:{audioConstraints:$,error:F}},g)),g._disconnect(),g.emit("error",{message:B,code:q})})}},E.prototype.cancel=function(T){this._log.warn(".cancel() is deprecated. Please use .ignore() instead."),T?this.ignore(T):this.ignore()},E.prototype.disconnect=function(T){if(typeof T=="function"){this._addHandler("disconnect",T);return}this._disconnect()},E.prototype.error=function(T){typeof T=="function"&&this._addHandler("error",T)},E.prototype.getLocalStream=function(){return this.mediaStream&&this.mediaStream.stream},E.prototype.getRemoteStream=function(){return this.mediaStream&&this.mediaStream._remoteStream},E.prototype.ignore=function(T){if(typeof T=="function"){this._addHandler("cancel",T);return}this._status===E.State.Pending&&(this._status=E.State.Closed,this.emit("cancel"),this.mediaStream.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this))},E.prototype.isMuted=function(){return this.mediaStream.isMuted},E.prototype.mute=function(T){if(T===void 0&&(T=!0),typeof T=="function"){this._addHandler("mute",T);return}var M=this.mediaStream.isMuted;this.mediaStream.mute(T);var g=this.mediaStream.isMuted;M!==g&&(this._publisher.info("connection",g?"muted":"unmuted",null,this),this.emit("mute",g,this))},E.prototype.postFeedback=function(T,M){if(typeof T>"u"||T===null)return this._postFeedbackDeclined();if(!Object.values(E.FeedbackScore).includes(T))throw new d.InvalidArgumentError("Feedback score must be one of: "+Object.values(E.FeedbackScore));if(typeof M<"u"&&M!==null&&!Object.values(E.FeedbackIssue).includes(M))throw new d.InvalidArgumentError("Feedback issue must be one of: "+Object.values(E.FeedbackIssue));return this._publisher.info("feedback","received",{issue_name:M,quality_score:T},this,!0)},E.prototype.reject=function(T){if(typeof T=="function"){this._addHandler("reject",T);return}this._status===E.State.Pending&&(this.pstream.reject(this.parameters.CallSid),this._status=E.State.Closed,this.emit("reject"),this.mediaStream.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",null,this))},E.prototype.sendDigits=function(T){if(T.match(/[^0-9*#w]/))throw new d.InvalidArgumentError("Illegal character passed into sendDigits");var M=[];T.split("").forEach(function(R){var O=R!=="w"?"dtmf"+R:"";O==="dtmf*"&&(O="dtmfs"),O==="dtmf#"&&(O="dtmfh"),M.push(O)}),function R(O,F){var B=M.shift();B&&(F?F.play(B):O.get(B).play()),M.length&&setTimeout(R.bind(null,O),200)}(this._soundcache,this.options.dialtonePlayer);var g=this.mediaStream.getOrCreateDTMFSender();function $(R){if(R.length){var O=R.shift();O&&O.length&&g.insertDTMF(O,t,n),setTimeout($.bind(null,R),e)}}if(g){if(!("canInsertDTMF"in g)||g.canInsertDTMF){this._log.info("Sending digits using RTCDTMFSender"),$(T.split("w"));return}this._log.info("RTCDTMFSender cannot insert DTMF")}if(this._log.info("Sending digits over PStream"),this.pstream!==null&&this.pstream.status!=="disconnected")this.pstream.dtmf(this.parameters.CallSid,T);else{var N={code:31e3,connection:this,message:"Could not send DTMF: Signaling channel is disconnected"};this.emit("error",N)}},E.prototype.status=function(){return this._status},E.prototype.unmute=function(){this._log.warn(".unmute() is deprecated. Please use .mute(false) to unmute a call instead."),this.mute(!1)},E.prototype.volume=function(T){(!window||!window.AudioContext&&!window.webkitAudioContext)&&this._log.warn("This browser does not support Connection.volume"),this._addHandler("volume",T)},E.prototype._addHandler=function(T,M){return S||(this._log.warn(`Connection callback handlers (accept, cancel, disconnect, error, ignore, mute, reject,
        volume) have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: connection.on('`+T+"', handler)"),S=!0),this.addListener(T,M),this},E.prototype._checkVolume=function(T,M,g,$){var N=M>=10,R=0;return g===T&&(R=M),R>=10?this._emitWarning("audio-level-","constant-audio-"+$+"-level",10,R,!1):N&&this._emitWarning("audio-level-","constant-audio-"+$+"-level",10,R,!0),R},E.prototype._cleanupEventListeners=function(){var T=this,M=function(){T.pstream&&(T.pstream.removeListener("answer",T._onAnswer),T.pstream.removeListener("cancel",T._onCancel),T.pstream.removeListener("hangup",T._onHangup),T.pstream.removeListener("ringing",T._onRinging),T.pstream.removeListener("transportClose",T._onTransportClose))};M(),setTimeout(M,0)},E.prototype._createMetricPayload=function(){var T={call_sid:this.parameters.CallSid,dscp:!!this.options.dscp,sdk_version:A.RELEASE_VERSION,selected_region:this.options.selectedRegion};return this.options.gateway&&(T.gateway=this.options.gateway),this.options.region&&(T.region=this.options.region),T.direction=this._direction,T},E.prototype._disconnect=function(T,M){if(T=typeof T=="string"?T:null,!(this._status!==E.State.Open&&this._status!==E.State.Connecting&&this._status!==E.State.Reconnecting&&this._status!==E.State.Ringing)){if(this._log.info("Disconnecting..."),this.pstream!==null&&this.pstream.status!=="disconnected"&&this.sendHangup){var g=this.parameters.CallSid||this.outboundConnectionId;g&&this.pstream.hangup(g,T)}this._cleanupEventListeners(),this.mediaStream.close(),M||this._publisher.info("connection","disconnected-by-local",null,this)}},E.prototype._maybeTransitionToOpen=function(){this.mediaStream&&this.mediaStream.status==="open"&&this._isAnswered&&(this._status=E.State.Open,this.emit("accept",this))},E.prototype._postFeedbackDeclined=function(){return this._publisher.info("feedback","received-none",null,this,!0)},E.prototype._publishMetrics=function(){var T=this;this._metricsSamples.length!==0&&this._publisher.postMetrics("quality-metrics-samples","metrics-sample",this._metricsSamples.splice(0),this._createMetricPayload(),this).catch(function(M){T._log.warn("Unable to post metrics to Insights. Received error:",M)})},E.prototype._setCallSid=function(T){var M=T.callsid;M&&(this.parameters.CallSid=M,this.mediaStream.callSid=M)},E.toString=function(){return"[Twilio.Connection class]"},E}(o.EventEmitter);(function(D){(function(E){E.Closed="closed",E.Connecting="connecting",E.Open="open",E.Pending="pending",E.Reconnecting="reconnecting",E.Ringing="ringing"})(D.State||(D.State={})),function(E){E.AudioLatency="audio-latency",E.ChoppyAudio="choppy-audio",E.DroppedCall="dropped-call",E.Echo="echo",E.NoisyCall="noisy-call",E.OneWayAudio="one-way-audio"}(D.FeedbackIssue||(D.FeedbackIssue={})),function(E){E[E.One=1]="One",E[E.Two=2]="Two",E[E.Three=3]="Three",E[E.Four=4]="Four",E[E.Five=5]="Five"}(D.FeedbackScore||(D.FeedbackScore={})),function(E){E.Incoming="INCOMING",E.Outgoing="OUTGOING"}(D.CallDirection||(D.CallDirection={})),function(E){E.Opus="opus",E.PCMU="pcmu"}(D.Codec||(D.Codec={})),function(E){E.None="none",E.Timeout="timeout"}(D.IceGatheringFailureReason||(D.IceGatheringFailureReason={})),function(E){E.ConnectionDisconnected="ConnectionDisconnected",E.ConnectionFailed="ConnectionFailed",E.IceGatheringFailed="IceGatheringFailed",E.LowBytes="LowBytes"}(D.MediaFailure||(D.MediaFailure={}))})(p||(p={}));function I(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(D){var E=Math.random()*16|0,T=D==="x"?E:E&3|8;return T.toString(16)})}return Re.default=p,Re}var wo;function ts(){if(wo)return je;wo=1,Object.defineProperty(je,"__esModule",{value:!0});var l=me(),y=Yr();je.Connection=y.default;var o=$r();je.Device=o.default;var s=_n();je.PreflightTest=s.PreflightTest;var d=Ki();je.PStream=d;var h;Object.defineProperty(o.default,"instance",{get:function(){return h},set:function(a){a===null&&(h=null)}}),o.default.destroy=function(){h&&h.destroy(),v()};function v(){h=new o.default,Object.getOwnPropertyNames(o.default.prototype).concat(Object.getOwnPropertyNames(l.EventEmitter.prototype)).filter(function(a){return typeof o.default.prototype[a]=="function"}).filter(function(a){return a!=="destroy"}).forEach(function(a){o.default[a]=o.default.prototype[a].bind(h)})}return v(),Object.getOwnPropertyNames(h).filter(function(a){return typeof o.default.prototype[a]!="function"}).forEach(function(a){Object.defineProperty(o.default,a,{get:function(){if(h)return h[a]},set:function(u){h&&(h[a]=u)}})}),je}var rs=ts();const ns=({token:l,phoneNumber:y,agentId:o})=>{const[s,d]=se.useState("connecting"),[h,v]=se.useState(null),[a,u]=se.useState(null),[P,A]=se.useState(null),[w,c]=se.useState(0),m=se.useRef(),[n,e]=se.useState(!1),t=f=>{if(!f)return"";let r=f.trim().replace(/\s+/g,"");return r.startsWith("+")||(r="+"+r.replace(/^\+/,"")),r};se.useEffect(()=>{const f=new rs.Device;return f.setup(l,{debug:!0}),f.on("ready",async()=>{if(u(f),d("ready"),y){const r=t(y);try{await fetch("/voice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({To:r,user_id:o})})}catch(i){console.error("[MinimalCall] /voice pre-call failed",i)}f.connect({To:r})}}),f.on("connect",r=>{v(r),d("on_call"),A(Date.now())}),f.on("disconnect",()=>{d("ready"),v(null),A(null),c(0),e(!1),window.close()}),()=>{f.destroy(),u(null),d("offline")}},[l,y,o]),se.useEffect(()=>{if(s==="on_call"&&P)return m.current=setInterval(()=>{c(Math.floor((Date.now()-P)/1e3))},1e3),()=>clearInterval(m.current);c(0),clearInterval(m.current)},[s,P]);const b=()=>{a.disconnectAll()},C=()=>{h&&(n?(h.mute(!1),e(!1)):(h.mute(!0),e(!0)))};return fe.jsxs("div",{className:"minimal-call-container",children:[fe.jsxs("div",{className:"call-status",children:[s==="connecting"&&"Connecting...",s==="ready"&&"Ready",s==="on_call"&&`On Call ${w}s`]}),fe.jsxs("div",{className:"call-controls",children:[fe.jsx("button",{onClick:C,className:`mute-button ${n?"muted":""}`,children:n?"Unmute":"Mute"}),fe.jsx("button",{onClick:b,className:"hangup-button",children:"End Call"})]})]})},Eo=({agentId:l,phoneNumber:y,onClose:o})=>{const[s,d]=se.useState(null),[h,v]=se.useState(null),[a,u]=se.useState(!1);return se.useEffect(()=>{(async()=>{try{const w=await(await fetch(`/voice/token?identity=${encodeURIComponent(l)}`)).json();if(!w.token)throw new Error("Failed to get token");d(w.token)}catch(A){v(A.message)}})()},[l]),fe.jsxs("div",{className:`call-widget ${a?"minimized":""}`,children:[fe.jsxs("div",{className:"call-widget-header",children:[fe.jsx("div",{className:"call-widget-title",children:a?"Active Call":"Call in Progress"}),fe.jsxs("div",{className:"call-widget-controls",children:[fe.jsx("button",{className:"call-widget-minimize",onClick:()=>u(!a),title:a?"Maximize":"Minimize",children:a?"":""}),fe.jsx("button",{className:"call-widget-close",onClick:o,title:"End Call",children:""})]})]}),!a&&fe.jsx("div",{className:"call-widget-content",children:h?fe.jsx("div",{className:"call-widget-error",children:h}):s?fe.jsx(ns,{token:s,phoneNumber:y,agentId:l}):fe.jsx("div",{className:"call-widget-loading",children:"Connecting..."})})]})};return window.initCallWidget=l=>{const{agentId:y,phoneNumber:o,containerId:s="call-widget-container"}=l;let d=document.getElementById(s);d||(d=document.createElement("div"),d.id=s,document.body.appendChild(d)),Fe.render(fe.jsx(Eo,{agentId:y,phoneNumber:o,onClose:()=>{Fe.unmountComponentAtNode(d),d.remove()}}),d)},Eo});
